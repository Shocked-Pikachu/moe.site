
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://shocked-pikachu.github.io/moe.site/courses/topics-quantitative-finance/black-scholes-1/">
      
      
        <link rel="prev" href="../stochastic-calculus/">
      
      
        <link rel="next" href="../black-scholes-2/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Lecture 3 The Black-Merton-Scholes Model and Beyond I - Moe's Site</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#lecture-3-the-black-merton-scholes-model-and-beyond-i" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="Moe&#39;s Site" class="md-header__button md-logo" aria-label="Moe's Site" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5zM6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Moe's Site
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Lecture 3 The Black-Merton-Scholes Model and Beyond I
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Shocked-Pikachu/moe.site" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Shocked-Pikachu/moe.site
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  主页

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
    
  
  课程

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../notes/" class="md-tabs__link">
          
  
  
    
  
  笔记

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../about/" class="md-tabs__link">
          
  
  
    
  
  关于

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Moe&#39;s Site" class="md-nav__button md-logo" aria-label="Moe's Site" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5zM6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5"/></svg>

    </a>
    Moe's Site
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Shocked-Pikachu/moe.site" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Shocked-Pikachu/moe.site
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    主页
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    课程
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            课程
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../electrodynamics/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    电动力学
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            电动力学
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../musical-modernism/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    现代主义音乐：挑战与挑衅
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            现代主义音乐：挑战与挑衅
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../modern-physics-lab/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    近代物理实验
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            近代物理实验
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../principles-of-economics/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    经济学原理（I）
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            经济学原理（I）
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles-of-economics/principles-economics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    经济学基本原理
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles-of-economics/gains-from-trade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    双赢的贸易
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles-of-economics/market-forces-supply-demand/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    供需的市场力量
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles-of-economics/elasticity-application/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    弹性及其应用
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles-of-economics/markets-government-policies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    市场与政策
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles-of-economics/market-efficiency/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    市场效率
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles-of-economics/externality-public-goods/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    外部性及公共品
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles-of-economics/consumer-theory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    消费者理论
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles-of-economics/producer-theory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    厂商理论
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles-of-economics/firms-competitive-markets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    竞争市场中的企业
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles-of-economics/monopoly/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    垄断
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles-of-economics/monopolistic-competition-markets-factors-production/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    垄断竞争及生产要素市场
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles-of-economics/oligopoly-game-theory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    寡头与博弈论
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles-of-economics/miscellany-frontiers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    杂及前沿
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../introduction-to-finance/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    金融学概论
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            金融学概论
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/time-value-money/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Allocating Resources Over Time
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/asset-classes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Asset Classes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/trading-margin-short-sale/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Trading, Margin and Short Sale
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/stock-market-indexes-funds/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Stock Market Indexes & Funds
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/historical-returns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Historical Returns on Risky Portfolios
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/introduction-portfolio-choice/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction to Portfolio Choice
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/constructing-portfolios/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Constructing Portfolios
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/optimal-risky-portfolios/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Optimal Risky Portfolios
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/markowitz-portfolio-selection-model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Markowitz Portfolio Selection Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/index-models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Index Models
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/capital-asset-pricing-model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Capital Asset Pricing Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/arbitrage-pricing-theory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Arbitrage Pricing Theory
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/bond-prices-yields/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bond Prices and Yields
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/term-structure-interest-rates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The Term Structure of Interest Rates
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/equity-valuation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Equity Valuation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/option-strategies-put-call-parity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Option Strategies and Put-Call Parity
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/option-pricing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Option Pricing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/futures/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Futures
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/structured-finance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Structured Finance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/financial-fragility/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Financial Fragility
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../financial-accounting/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    财务会计
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            财务会计
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-accounting/lecture-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-accounting/lecture-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-accounting/lecture-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 3
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-accounting/lecture-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 4
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-accounting/lecture-5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 5
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-accounting/lecture-6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 6
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-accounting/lecture-7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 7
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-accounting/lecture-8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 8
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-accounting/lecture-9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 9
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-accounting/lecture-10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 10
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-accounting/lecture-11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 11
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-accounting/lecture-12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 12
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-accounting/lecture-13/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 13
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-accounting/lecture-14/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 14
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_8" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    量化金融专题
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_8">
            <span class="md-nav__icon md-icon"></span>
            量化金融专题
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../financial-engineering-nutshell/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 1 Financial Engineering in a Nutshell
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stochastic-calculus/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 2 Crash Course on Stochastic Calculus
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Lecture 3 The Black-Merton-Scholes Model and Beyond I
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Lecture 3 The Black-Merton-Scholes Model and Beyond I
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#agenda" class="md-nav__link">
    <span class="md-ellipsis">
      Agenda
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black-merton-scholes" class="md-nav__link">
    <span class="md-ellipsis">
      Black-Merton-Scholes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-black-scholes-world" class="md-nav__link">
    <span class="md-ellipsis">
      The Black-Scholes world
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black-scholes-model" class="md-nav__link">
    <span class="md-ellipsis">
      Black-Scholes model
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Black-Scholes model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pricing-under-the-black-scholes-model" class="md-nav__link">
    <span class="md-ellipsis">
      Pricing under the Black-Scholes model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-the-change-of-call-price-is-given-by" class="md-nav__link">
    <span class="md-ellipsis">
      - The change of call price is given by
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-hence-the-infinitesimal-change-of-pi-at-time-t-is" class="md-nav__link">
    <span class="md-ellipsis">
      - Hence the infinitesimal change of \(\Pi\) at time \(t\) is
    </span>
  </a>
  
    <nav class="md-nav" aria-label="- Hence the infinitesimal change of \(\Pi\) at time \(t\) is">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note_1" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black-scholes-pde" class="md-nav__link">
    <span class="md-ellipsis">
      Black-Scholes PDE
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Black-Scholes PDE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note_2" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solving-black-scholes-pde" class="md-nav__link">
    <span class="md-ellipsis">
      Solving Black-Scholes PDE
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-black-scholes-formula" class="md-nav__link">
    <span class="md-ellipsis">
      The Black-Scholes formula
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The Black-Scholes formula">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note_3" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sensitivities-of-option-prices-in-black-scholes-model-the-greeks" class="md-nav__link">
    <span class="md-ellipsis">
      Sensitivities of option prices in Black-Scholes model - the Greeks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sensitivities of option prices in Black-Scholes model - the Greeks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note_4" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#subtlety-in-self-financing" class="md-nav__link">
    <span class="md-ellipsis">
      Subtlety in self-financing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#self-financing-with-traded-price" class="md-nav__link">
    <span class="md-ellipsis">
      Self-financing with traded price
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#delta-hedging" class="md-nav__link">
    <span class="md-ellipsis">
      Delta hedging
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Delta hedging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note_5" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#an-example-on-delta-hedge" class="md-nav__link">
    <span class="md-ellipsis">
      An example on delta hedge
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#an-exmaple-on-delta-gamma-hedge" class="md-nav__link">
    <span class="md-ellipsis">
      An exmaple on delta-gamma hedge
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dynamical-hedging" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamical hedging
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dynamical hedging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note_6" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#an-example-on-dynamical-hedging" class="md-nav__link">
    <span class="md-ellipsis">
      An example on dynamical hedging
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dynamic-hedge-in-practice" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic hedge in practice
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deep-hedging" class="md-nav__link">
    <span class="md-ellipsis">
      Deep hedging
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deep-hedging-in-a-nutshell" class="md-nav__link">
    <span class="md-ellipsis">
      Deep hedging in a nutshell
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notations" class="md-nav__link">
    <span class="md-ellipsis">
      Notations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#settings-in-cao-chen-hull-poulos" class="md-nav__link">
    <span class="md-ellipsis">
      Settings in Cao-Chen-Hull-Poulos
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#two-alternative-formulations" class="md-nav__link">
    <span class="md-ellipsis">
      Two alternative formulations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#accounting-pl-formulation" class="md-nav__link">
    <span class="md-ellipsis">
      Accounting P&amp;L formulation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cashflow-formulation" class="md-nav__link">
    <span class="md-ellipsis">
      Cashflow formulation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#accounting-pl-vs-cashflow" class="md-nav__link">
    <span class="md-ellipsis">
      Accounting P&amp;L vs cashflow
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#objective-functional-and-resulting-control-problem" class="md-nav__link">
    <span class="md-ellipsis">
      Objective functional and resulting control problem
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Objective functional and resulting control problem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note_7" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-of-deep-hedging-in-tensorflow" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation of Deep hedging in Tensorflow
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deep-hedging-implementation-with-ddpg-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      Deep-hedging implementation with DDPG Algorithm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-of-deep-hedging-vs-delta-hedging" class="md-nav__link">
    <span class="md-ellipsis">
      Performance of deep hedging vs delta hedging
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#one-month-option-weekly-hedging" class="md-nav__link">
    <span class="md-ellipsis">
      One-month option, weekly hedging
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-does-the-optimal-action-look-like" class="md-nav__link">
    <span class="md-ellipsis">
      What does the optimal action look like?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#one-month-option-tridaily-hedging" class="md-nav__link">
    <span class="md-ellipsis">
      One-month option, tridaily hedging
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-month-option-weekly-hedging" class="md-nav__link">
    <span class="md-ellipsis">
      3-month option, weekly hedging
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#concluding-remarks-on-deep-hedging" class="md-nav__link">
    <span class="md-ellipsis">
      Concluding remarks on deep hedging
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../black-scholes-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 4 The Black-Merton-Scholes Model and Beyond II
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../volatility/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 5 Volatility and Volatility-Linked Derivatives
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../variational-control-problems/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 6 Brief Introduction to Variational and Control Problems
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../optimal-execution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 7 Optimal Execution under Price Impact
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_9" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../general-relativity/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    广义相对论
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_9">
            <span class="md-nav__icon md-icon"></span>
            广义相对论
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_10" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../ai-basis/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    人工智能基础
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_10">
            <span class="md-nav__icon md-icon"></span>
            人工智能基础
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_11" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../industrial-organization-theory/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    产业组织理论
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_11" id="__nav_2_11_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_11">
            <span class="md-nav__icon md-icon"></span>
            产业组织理论
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../industrial-organization-theory/introduction-comp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    产业组织简介，完全竞争
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../industrial-organization-theory/monopoly/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    垄断
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../industrial-organization-theory/oligopoly/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    寡头
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../industrial-organization-theory/monocom/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    垄断竞争
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../industrial-organization-theory/price-discrimination/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    非线性定价与区别定价
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../industrial-organization-theory/tie-in-sale/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    捆绑销售
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../industrial-organization-theory/strategic-behavior/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    策略行为
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../industrial-organization-theory/durables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    耐用品
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../industrial-organization-theory/information/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    广告与信息
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../industrial-organization-theory/research-development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    研究与开发
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../industrial-organization-theory/horizontal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    水平合并
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../industrial-organization-theory/vertical/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    垂直合并
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../industrial-organization-theory/international-trade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    国际贸易
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_12" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../baroque-classical-style-music/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    17 与 18 世纪的欧洲艺术音乐：巴洛克与古典风格
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_12" id="__nav_2_12_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_12">
            <span class="md-nav__icon md-icon"></span>
            17 与 18 世纪的欧洲艺术音乐：巴洛克与古典风格
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../baroque-classical-style-music/end-renaissance-concept-baroque/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    “巴洛克”？从⽂艺复兴末期出发
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../baroque-classical-style-music/monteverdi-madrigals-operas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    歌剧的诞⽣：“从蒙特威尔第的牧歌到蒙特威尔第的歌剧”
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../baroque-classical-style-music/spectacle-power-pleasure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    法国抒情悲剧中的权⼒与愉悦：从吕利到拉莫
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../baroque-classical-style-music/baroque-keyboard-tradition/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    法国、意⼤利与北德的键盘音乐：L. 库普兰、弗雷斯科巴尔蒂、扬·皮泰尔索恩·斯韦林克、F. 库普兰、布克斯特胡德
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../baroque-classical-style-music/italian-concerto-style/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    意⼤利协奏曲风格与调性的兴起：科雷利与维瓦尔第
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../baroque-classical-style-music/handel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    亨德尔的意⼤利歌剧、英国神剧与器乐作品
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../baroque-classical-style-music/introduction-bach/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    巴赫的键盘音乐：键盘十二平均律、哥德堡变奏曲
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../baroque-classical-style-music/bach-dance-suite-concertos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    巴赫的协奏曲与组曲
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../baroque-classical-style-music/bach-cantatas-passions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    巴赫的声乐作品：康塔塔与受难曲
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../baroque-classical-style-music/early-classical-styles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    喜歌剧的兴起：佩格莱西与歌剧中的⼆维性格
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../baroque-classical-style-music/emergence-comic-operas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    奏鸣曲式：鍵盤奏鸣曲、早期交响乐与协奏曲
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../baroque-classical-style-music/enlightenment-mozart-operas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    莫扎特的喜歌剧：启蒙主义精神的体现
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../baroque-classical-style-music/haydn/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    有幽默感的海顿：弦乐四重奏与交响乐
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_13" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../financial-statement-analysis/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    财务报表分析
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_13" id="__nav_2_13_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_13">
            <span class="md-nav__icon md-icon"></span>
            财务报表分析
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-statement-analysis/lecture-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-statement-analysis/lecture-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-statement-analysis/lecture-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 3
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-statement-analysis/lecture-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 4
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-statement-analysis/lecture-5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 5
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-statement-analysis/lecture-6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 6
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-statement-analysis/lecture-7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 7
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-statement-analysis/lecture-8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 8
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-statement-analysis/lecture-9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 9
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-statement-analysis/lecture-10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 10
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-statement-analysis/lecture-11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 11
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-statement-analysis/lecture-12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 12
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_14" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../public-finance/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    公共财政学
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_14" id="__nav_2_14_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_14">
            <span class="md-nav__icon md-icon"></span>
            公共财政学
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../public-finance/intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    导言 公共财政的含义
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../public-finance/welfare-economics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    第一章 福利经济学
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../public-finance/market-failure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    第二章 市场失灵
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../public-finance/public-choice/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    第三章 公共选择理论
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../public-finance/cost-benefit-analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    第四章 成本收益分析
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../public-finance/public-expenditure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    第五章 公共支出概论
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../notes/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    笔记
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            笔记
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../notes/tensors-group-theory/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    张量和群论简介
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            张量和群论简介
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2_2" id="__nav_3_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    线性代数和张量
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_2">
            <span class="md-nav__icon md-icon"></span>
            线性代数和张量
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/tensors-group-theory/linear-algebra-tensors/vector-spaces/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    矢量空间
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/tensors-group-theory/linear-algebra-tensors/tensors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    张量
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_3" >
        
          
          <label class="md-nav__link" for="__nav_3_2_3" id="__nav_3_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    群论
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_3">
            <span class="md-nav__icon md-icon"></span>
            群论
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/tensors-group-theory/group-theory/groups-lie-algebras/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    群，李群和李代数
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/tensors-group-theory/group-theory/representation-theory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    群表示论基础
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../about/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    关于
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            关于
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#agenda" class="md-nav__link">
    <span class="md-ellipsis">
      Agenda
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black-merton-scholes" class="md-nav__link">
    <span class="md-ellipsis">
      Black-Merton-Scholes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-black-scholes-world" class="md-nav__link">
    <span class="md-ellipsis">
      The Black-Scholes world
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black-scholes-model" class="md-nav__link">
    <span class="md-ellipsis">
      Black-Scholes model
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Black-Scholes model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pricing-under-the-black-scholes-model" class="md-nav__link">
    <span class="md-ellipsis">
      Pricing under the Black-Scholes model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-the-change-of-call-price-is-given-by" class="md-nav__link">
    <span class="md-ellipsis">
      - The change of call price is given by
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-hence-the-infinitesimal-change-of-pi-at-time-t-is" class="md-nav__link">
    <span class="md-ellipsis">
      - Hence the infinitesimal change of \(\Pi\) at time \(t\) is
    </span>
  </a>
  
    <nav class="md-nav" aria-label="- Hence the infinitesimal change of \(\Pi\) at time \(t\) is">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note_1" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black-scholes-pde" class="md-nav__link">
    <span class="md-ellipsis">
      Black-Scholes PDE
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Black-Scholes PDE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note_2" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solving-black-scholes-pde" class="md-nav__link">
    <span class="md-ellipsis">
      Solving Black-Scholes PDE
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-black-scholes-formula" class="md-nav__link">
    <span class="md-ellipsis">
      The Black-Scholes formula
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The Black-Scholes formula">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note_3" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sensitivities-of-option-prices-in-black-scholes-model-the-greeks" class="md-nav__link">
    <span class="md-ellipsis">
      Sensitivities of option prices in Black-Scholes model - the Greeks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sensitivities of option prices in Black-Scholes model - the Greeks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note_4" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#subtlety-in-self-financing" class="md-nav__link">
    <span class="md-ellipsis">
      Subtlety in self-financing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#self-financing-with-traded-price" class="md-nav__link">
    <span class="md-ellipsis">
      Self-financing with traded price
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#delta-hedging" class="md-nav__link">
    <span class="md-ellipsis">
      Delta hedging
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Delta hedging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note_5" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#an-example-on-delta-hedge" class="md-nav__link">
    <span class="md-ellipsis">
      An example on delta hedge
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#an-exmaple-on-delta-gamma-hedge" class="md-nav__link">
    <span class="md-ellipsis">
      An exmaple on delta-gamma hedge
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dynamical-hedging" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamical hedging
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dynamical hedging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note_6" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#an-example-on-dynamical-hedging" class="md-nav__link">
    <span class="md-ellipsis">
      An example on dynamical hedging
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dynamic-hedge-in-practice" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic hedge in practice
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deep-hedging" class="md-nav__link">
    <span class="md-ellipsis">
      Deep hedging
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deep-hedging-in-a-nutshell" class="md-nav__link">
    <span class="md-ellipsis">
      Deep hedging in a nutshell
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notations" class="md-nav__link">
    <span class="md-ellipsis">
      Notations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#settings-in-cao-chen-hull-poulos" class="md-nav__link">
    <span class="md-ellipsis">
      Settings in Cao-Chen-Hull-Poulos
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#two-alternative-formulations" class="md-nav__link">
    <span class="md-ellipsis">
      Two alternative formulations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#accounting-pl-formulation" class="md-nav__link">
    <span class="md-ellipsis">
      Accounting P&amp;L formulation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cashflow-formulation" class="md-nav__link">
    <span class="md-ellipsis">
      Cashflow formulation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#accounting-pl-vs-cashflow" class="md-nav__link">
    <span class="md-ellipsis">
      Accounting P&amp;L vs cashflow
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#objective-functional-and-resulting-control-problem" class="md-nav__link">
    <span class="md-ellipsis">
      Objective functional and resulting control problem
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Objective functional and resulting control problem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note_7" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-of-deep-hedging-in-tensorflow" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation of Deep hedging in Tensorflow
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deep-hedging-implementation-with-ddpg-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      Deep-hedging implementation with DDPG Algorithm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-of-deep-hedging-vs-delta-hedging" class="md-nav__link">
    <span class="md-ellipsis">
      Performance of deep hedging vs delta hedging
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#one-month-option-weekly-hedging" class="md-nav__link">
    <span class="md-ellipsis">
      One-month option, weekly hedging
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-does-the-optimal-action-look-like" class="md-nav__link">
    <span class="md-ellipsis">
      What does the optimal action look like?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#one-month-option-tridaily-hedging" class="md-nav__link">
    <span class="md-ellipsis">
      One-month option, tridaily hedging
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-month-option-weekly-hedging" class="md-nav__link">
    <span class="md-ellipsis">
      3-month option, weekly hedging
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#concluding-remarks-on-deep-hedging" class="md-nav__link">
    <span class="md-ellipsis">
      Concluding remarks on deep hedging
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="lecture-3-the-black-merton-scholes-model-and-beyond-i">Lecture 3: The Black-Merton-Scholes Model and Beyond I<a class="headerlink" href="#lecture-3-the-black-merton-scholes-model-and-beyond-i" title="Permanent link">&para;</a></h1>
<div class="arithmatex">\[
\newcommand{\bea}{\begin{eqnarray}}
\newcommand{\eea}{\end{eqnarray}}
\newcommand{\supp}{\mathrm{supp}}
\newcommand{\cA}{\mathcal{A} }
\newcommand{\F}{\mathcal{F} }
\newcommand{\cF}{\mathcal{F} }
\newcommand{\E}{\mathbb{E} }
\newcommand{\Eof}[1]{\mathbb{E}\left[ #1 \right]}
\newcommand{\Etof}[1]{\mathbb{E}_t\left[ #1 \right]}
\newcommand{\Sdof}[1]{\mathbb{Sd}\left[ #1 \right]}
\def\Cov{{ \mbox{Cov} }}
\def\Var{{ \mbox{Var} }}
\newcommand{\1}{\mathbf{1} }
\newcommand{\p}{\partial}
\newcommand{\PP}{\mathbb{P} }
\newcommand{\Pof}[1]{\mathbb{P}\left[ #1 \right]}
\newcommand{\QQ}{\mathbb{Q} }
\newcommand{\R}{\mathbb{R} }
\newcommand{\DD}{\mathbb{D} }
\newcommand{\HH}{\mathbb{H} }
\newcommand{\spn}{\mathrm{span} }
\newcommand{\cov}{\mathrm{cov} }
\newcommand{\HS}{\mathcal{L}_{\mathrm{HS}} }
\newcommand{\Hess}{\mathrm{Hess} }
\newcommand{\trace}{\mathrm{trace} }
\newcommand{\LL}{\mathcal{L} }
\newcommand{\s}{\mathcal{S} }
\newcommand{\ee}{\mathcal{E} }
\newcommand{\ff}{\mathcal{F} }
\newcommand{\hh}{\mathcal{H} }
\newcommand{\bb}{\mathcal{B} }
\newcommand{\dd}{\mathcal{D} }
\newcommand{\g}{\mathcal{G} }
\newcommand{\half}{\frac{1}{2} }
\newcommand{\T}{\mathcal{T} }
\newcommand{\bit}{\begin{itemize}}
\newcommand{\eit}{\end{itemize}}
\newcommand{\beq}{\begin{equation}}
\newcommand{\eeq}{\end{equation}}
\newcommand{\tr}{\mbox{tr}}
\newcommand{\inn}[2]{\left\langle #1, #2 \right\rangle}
\newcommand{\bX}{\boldsymbol X}
\newcommand{\bm}{\boldsymbol m}
\newcommand{\bx}{\boldsymbol x}
\newcommand{\by}{\boldsymbol y}
\newcommand{\bmu}{\boldsymbol\mu}
\newcommand{\bxi}{\boldsymbol\xi}
\]</div>
<center>
<font size=5, color=blue> Tai-Ho Wang (王 太和)</font>
</center>
<center>
<img src="../../../assets/img//topics-quantitative-finance/baruch-logo.jpg" align = "center" width=450>
</center>

<h2 id="agenda">Agenda<a class="headerlink" href="#agenda" title="Permanent link">&para;</a></h2>
<ul>
<li>Black-Merton-Scholes model</li>
<li>Black-Merton-Scholes formula for call and put options</li>
<li>Greeks</li>
<li>Subtlety in self-financing</li>
<li>Delta and delta-gamma hedges</li>
<li>Dynamic hedging</li>
<li>Deep hedging</li>
</ul>
<h2 id="black-merton-scholes">Black-Merton-Scholes<a class="headerlink" href="#black-merton-scholes" title="Permanent link">&para;</a></h2>
<p>From the <a href="https://en.wikipedia.org/wiki/Black%E2%80%93Scholes_model">Wikipage</a>:</p>
<ul>
<li>
<p>The Black–Scholes or Black–Scholes–Merton model is a mathematical model for the dynamics of a financial market containing derivative investment instruments. From the partial differential equation in the model, known as the Black–Scholes equation, one can deduce the Black–Scholes formula, which gives a theoretical estimate of the price of European-style options and shows that the option has a unique price regardless of the <font color=red>risk of the security</font> and its expected return (instead replacing the security's expected return with the risk-neutral rate). The formula led to a boom in options trading and provided mathematical legitimacy to the activities of the Chicago Board Options Exchange and other options markets around the world. It is widely used, although often with adjustments and corrections, by options market participants.</p>
</li>
<li>
<p>The key idea behind the model is to hedge the option by buying and selling the underlying asset in just the right way and, as a consequence, to eliminate risk. This type of hedging is called "continuously revised delta hedging" and is the basis of more complicated hedging strategies such as those engaged in by investment banks and hedge funds. </p>
</li>
<li>
<p>The Black–Scholes formula has only one parameter that cannot be directly observed in the market: the average future volatility of the underlying asset, though it can be found from the price of other options. Since the option value (whether put or call) is increasing in this parameter, it can be inverted to produce a "volatility surface" (<font color=blue>implied volatility</font>) that is then used to calibrate other models (<font color=blue>(exotic) derivatives</font>), e.g. for OTC derivatives. </p>
</li>
</ul>
<h2 id="the-black-scholes-world">The Black-Scholes world<a class="headerlink" href="#the-black-scholes-world" title="Permanent link">&para;</a></h2>
<p>The Black–Scholes model assumes that the market consists of at least one risky asset, usually called the stock, and one riskless asset, usually called the money market, cash, or bond.</p>
<p>Assumptions on the assets:</p>
<ul>
<li>(riskless rate) The rate of return on the riskless asset is constant and thus called the risk-free interest rate.</li>
<li>(Brownian motion) The instantaneous log return of stock price is a Brownian motion with drift; and we will assume its drift and volatility are constant (if they are time-varying, we can deduce a suitably modified Black–Scholes formula quite simply, as long as the volatility is not random). As a result, the stock price follows a geometric Brownian motion. </li>
<li>The stock does not pay dividend.</li>
</ul>
<p>Assumptions on the market:</p>
<ul>
<li>There exists no arbitrage opportunity.</li>
<li>It is possible to borrow and lend any amount, even fractional, of cash at the riskless rate.</li>
<li>It is possible to buy and sell any amount, even fractional, of the stock, including short selling.</li>
<li>Frictionless market: the transactions do not incur any fees or costs.</li>
</ul>
<h2 id="black-scholes-model">Black-Scholes model<a class="headerlink" href="#black-scholes-model" title="Permanent link">&para;</a></h2>
<p>Assume the price of the underlying asset follows the stochastic differential equation</p>
<div class="arithmatex">\[
\frac{dS_t}{S_t} = \mu dt + \sigma dW_t,
\]</div>
<p>where</p>
<ul>
<li><span class="arithmatex">\(\mu\)</span>: (constant) expected return </li>
<li><span class="arithmatex">\(\sigma\)</span>: (constant) volatility </li>
<li><span class="arithmatex">\(W_t\)</span>: standard Brownian motion</li>
</ul>
<p>For each time <span class="arithmatex">\(t\)</span>, <span class="arithmatex">\(S_t\)</span> is lognormally distributed. More precisely,</p>
<div class="arithmatex">\[
S_t \sim S_0 \exp\left[\left(\mu - \frac{\sigma^2}{2}\right)t + \sigma \sqrt t Z \right]
\]</div>
<p>where <span class="arithmatex">\(Z\)</span> is a standard normal random variable.</p>
<h4 id="note">Note<a class="headerlink" href="#note" title="Permanent link">&para;</a></h4>
<p><span class="arithmatex">\(S_t\)</span> has the closed form expression</p>
<div class="arithmatex">\[
S_t = S_0 e^{\left(\mu - \frac{\sigma^2}2 \right) t+ \sigma W_t}
\]</div>
<p>and is also referred to as a <em>geometric Brownian motion</em>.</p>
<h2 id="pricing-under-the-black-scholes-model">Pricing under the Black-Scholes model<a class="headerlink" href="#pricing-under-the-black-scholes-model" title="Permanent link">&para;</a></h2>
<p>Assume the price of a call option <span class="arithmatex">\(C\)</span> is a (smooth enough) function of the calendar time <span class="arithmatex">\(t\)</span> and the underlying asset <span class="arithmatex">\(S\)</span>. Consider the portfolio <span class="arithmatex">\(\Pi\)</span> consisting of selling a call option and holding <span class="arithmatex">\(\Delta\)</span> shares of <span class="arithmatex">\(S\)</span>.</p>
<ul>
<li>
<p>The value of <span class="arithmatex">\(\Pi\)</span> at time <span class="arithmatex">\(t\)</span> is
$$
\Pi_t =  -C(t, S_t) + \Delta S_t
$$</p>
</li>
<li>
<p><font color=blue> Self-financing strategy </font></p>
</li>
</ul>
<div class="arithmatex">\[
d \Pi_t =  -dC_t + \Delta dS_t
\]</div>
<h2 id="-the-change-of-call-price-is-given-by">- The change of call price is given by<a class="headerlink" href="#-the-change-of-call-price-is-given-by" title="Permanent link">&para;</a></h2>
<div class="arithmatex">\[
\begin{eqnarray*}
dC(t,S_t) &amp;=&amp; C_t dt + C_S dS_t + \frac12 C_{SS} (dS_t)^2  \\
&amp;=&amp; C_S \sigma S dW_t + \left( C_t + \frac12 \sigma^2 S^2 C_{SS} + \mu S C_S \right) dt
\end{eqnarray*}
\]</div>
<h2 id="-hence-the-infinitesimal-change-of-pi-at-time-t-is">- Hence the infinitesimal change of <span class="arithmatex">\(\Pi\)</span> at time <span class="arithmatex">\(t\)</span> is<a class="headerlink" href="#-hence-the-infinitesimal-change-of-pi-at-time-t-is" title="Permanent link">&para;</a></h2>
<div class="arithmatex">\[
\begin{eqnarray*}
d \Pi_t &amp;=&amp; -dC_t + \Delta dS_t   \\
&amp;=&amp; -\left[ C_t + \frac12 \sigma^2 S^2 C_{SS} + \mu S (C_S - \Delta) \right] dt - \sigma S (C_S - \Delta) dW_t
\end{eqnarray*}
\]</div>
<h4 id="note_1">Note<a class="headerlink" href="#note_1" title="Permanent link">&para;</a></h4>
<p><span class="arithmatex">\((dS_t)^2 = \sigma^2 S_t^2 dt\)</span></p>
<ul>
<li>Let <span class="arithmatex">\(\Delta = C_S\)</span>, i.e., hold this amount <span class="arithmatex">\(C_S(t,S_t)\)</span> of underlying assets in the portfolio <span class="arithmatex">\(\Pi\)</span>. Then the infinitesimal change of <span class="arithmatex">\(\Pi\)</span> becomes</li>
</ul>
<div class="arithmatex">\[
\displaystyle d\Pi_t = -\left( C_t + \frac12 \sigma^2 S^2 C_{SS} \right) dt
\]</div>
<ul>
<li>On the other hand, with this choice of <span class="arithmatex">\(\Delta\)</span>, <span class="arithmatex">\(\Pi\)</span> is riskless (non-random) hence must be like cash in bank account (Arbitrage Pricing Theory), i.e.,</li>
</ul>
<div class="arithmatex">\[
d\Pi_t = r \Pi_t dt = r(-C + \Delta S)dt = r(-C + C_S S) dt,
\]</div>
<p>where <span class="arithmatex">\(r\)</span> is the interest rate.</p>
<h2 id="black-scholes-pde">Black-Scholes PDE<a class="headerlink" href="#black-scholes-pde" title="Permanent link">&para;</a></h2>
<p>We conclude that the price <span class="arithmatex">\(C\)</span> of a call option satisfies</p>
<div class="arithmatex">\[
\begin{eqnarray*}
   \frac{\p C}{\p t} + \frac{\sigma^2}{2}S^2\frac{\p^2 C}{\p S^2} + rS\frac{\p C}{\p S} - rC = 0,
   \mbox{ for } 0 &lt; S &lt; \infty, \quad 0 \leq t &lt; T
\end{eqnarray*}
\]</div>
<p>with terminal condition</p>
<div class="arithmatex">\[
C(T,S) = (S - K)^+
\]</div>
<p>and boundary conditions</p>
<div class="arithmatex">\[
\begin{eqnarray*}
   &amp;&amp; C(t,0) = 0  \\
   &amp;&amp; C(t,S) \sim S - K e^{-r(T-t)} \mbox{ as } S \to\infty \\
   &amp;&amp; \mbox{ or more specificly} \lim_{S\to\infty} \frac{C(t, S)}S = 1
\end{eqnarray*}
\]</div>
<h4 id="note_2">Note<a class="headerlink" href="#note_2" title="Permanent link">&para;</a></h4>
<p>The Black-Scholes pricing PDE does not depend on the drift <span class="arithmatex">\(\mu\)</span>. It only depends on the interest rate <span class="arithmatex">\(r\)</span>.</p>
<h2 id="solving-black-scholes-pde">Solving Black-Scholes PDE<a class="headerlink" href="#solving-black-scholes-pde" title="Permanent link">&para;</a></h2>
<div class="arithmatex">\[
\frac{\p C}{\p t} + \frac{\sigma^2}{2}S^2\frac{\p C^2}{\p S^2} + rS\frac{\p C}{\p S} - rC = 0
\]</div>
<ul>
<li><span class="arithmatex">\(\tau = T - t\)</span></li>
</ul>
<div class="arithmatex">\[
\frac{\p C}{\p \tau} = \frac{\sigma^2}{2}S^2\frac{\p C^2}{\p S^2} + rS\frac{\p C}{\p S} - rC
\]</div>
<ul>
<li>$ \xi = \ln S$</li>
</ul>
<div class="arithmatex">\[
\frac{\p C}{\p \tau} = \frac{\sigma^2}{2}\frac{\p C^2}{\p \xi^2} + \left( r -\frac{\sigma^2}{2} \right) \frac{\p C}{\p \xi} - rC
\]</div>
<ul>
<li><span class="arithmatex">\(c(\xi,\tau) = e^{r\tau}C(\xi,\tau)\)</span></li>
</ul>
<div class="arithmatex">\[
\frac{\p c}{\p \tau} = \frac{\sigma^2}{2}\frac{\p c^2}{\p \xi^2} + \left( r -\frac{\sigma^2}{2} \right) \frac{\p c}{\p \xi}
\]</div>
<ul>
<li>$x = \xi + \left( r - \frac{\sigma^2}{2} \right) \tau $</li>
</ul>
<div class="arithmatex">\[
\frac{\p c}{\p \tau} = \frac{\sigma^2}{2} \frac{\p^2 c}{\p x^2}
\]</div>
<p>In total, we have done the transformation</p>
<div class="arithmatex">\[
\begin{eqnarray*}
&amp;&amp; \tau = T - t  \\
&amp;&amp; x = \ln S + \left( r - \frac{\sigma^2}{2} \right) (T - t)  \\
&amp;&amp; c = e^{r(T-t)}C
\end{eqnarray*}
\]</div>
<p>which transforms Black-Scholes equation into heat equation.</p>
<h2 id="the-black-scholes-formula">The Black-Scholes formula<a class="headerlink" href="#the-black-scholes-formula" title="Permanent link">&para;</a></h2>
<ul>
<li>For call option</li>
</ul>
<div class="arithmatex">\[
C = S e^{-d\tau} N(d_1) - K e^{-r\tau} N(d_2)
\]</div>
<p>where <span class="arithmatex">\(\tau\)</span> is time to expiry, <span class="arithmatex">\(N(\cdot)\)</span> denotes the cdf for standard normal (<span class="arithmatex">\(N_2(d_2)\)</span> is the probability that the call option is in the money), and </p>
<div class="arithmatex">\[
d_1 = \frac{\log\left(\frac{Se^{-d\tau}}{Ke^{-r\tau}}\right)}{\sigma\sqrt\tau}+ \frac{\sigma\sqrt\tau}2, \qquad d_2 = d_1 - \sigma \sqrt\tau
\]</div>
<ul>
<li>For put option</li>
</ul>
<div class="arithmatex">\[
P = K e^{-r\tau} N(-d_2) - S e^{-d\tau} N(-d_1).
\]</div>
<p><span class="arithmatex">\(\tau = T - t\)</span></p>
<h3 id="note_3">Note<a class="headerlink" href="#note_3" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Put-call parity</p>
<div class="arithmatex">\[
C - P = S e^{-d\tau} - K e^{-r\tau}.
\]</div>
</li>
<li>
<p>Financial meaning of <span class="arithmatex">\(N(d_1)\)</span> and <span class="arithmatex">\(N(d_2)\)</span></p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">exp</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">sqrt</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">norm</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># generate samples from standard normal </span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span> <span class="c1"># cdf of standard normal</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span> <span class="c1"># pdf for standard normal</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span> <span class="c1"># quantile funciton</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>&lt;bound method rv_continuous.ppf of &lt;scipy.stats._continuous_distns.norm_gen object at 0x12112f2e0&gt;&gt;
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nb">print</span><span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="c1"># This is N(0) in our notation</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">((</span><span class="o">-</span><span class="mi">9</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>0.5





array([1.12858841e-19, 2.27501319e-02, 1.58655254e-01, 5.00000000e-01,
       8.41344746e-01, 9.77249868e-01, 9.98650102e-01, 9.99968329e-01,
       1.00000000e+00])
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1"># plot cdf and pdf for standard normal</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">201</span><span class="p">)</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="n">y</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Standard normal CDF and PDF&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="n">y</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;dashdot&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">);</span>
</code></pre></div>
<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-3/black-scholes-1_16_0.png" />
​    </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># Black-Scholes formulas</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="c1"># call</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="c1"># t is tau in the formula above</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">bs_call</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>    <span class="n">d1</span> <span class="o">=</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">s</span><span class="o">/</span><span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">d</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">sigma</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">))</span> <span class="o">+</span> <span class="n">sigma</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>    <span class="n">d2</span> <span class="o">=</span> <span class="n">d1</span> <span class="o">-</span> <span class="n">sigma</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>    <span class="n">c</span> <span class="o">=</span> <span class="n">s</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span> <span class="o">-</span> <span class="n">K</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>    <span class="n">delta</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>    <span class="n">gamma</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span><span class="o">/</span><span class="n">s</span><span class="o">/</span><span class="n">sigma</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">,</span> <span class="s1">&#39;delta&#39;</span><span class="p">:</span> <span class="n">delta</span><span class="p">,</span> <span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="n">gamma</span><span class="p">}</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="c1">#put</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="k">def</span><span class="w"> </span><span class="nf">bs_put</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>    <span class="n">d1</span> <span class="o">=</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">s</span><span class="o">/</span><span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">d</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">sigma</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">))</span> <span class="o">+</span> <span class="n">sigma</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>    <span class="n">d2</span> <span class="o">=</span> <span class="n">d1</span> <span class="o">-</span> <span class="n">sigma</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">K</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="o">-</span><span class="n">d2</span><span class="p">)</span> <span class="o">-</span> <span class="n">s</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="o">-</span><span class="n">d1</span><span class="p">)</span>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>    <span class="n">delta</span> <span class="o">=</span> <span class="o">-</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="o">-</span><span class="n">d1</span><span class="p">)</span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>    <span class="n">gamma</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span><span class="o">/</span><span class="n">s</span><span class="o">/</span><span class="n">sigma</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a>    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">,</span> <span class="s1">&#39;delta&#39;</span><span class="p">:</span> <span class="n">delta</span><span class="p">,</span> <span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="n">gamma</span><span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c1"># Call price is increasing with s, sigma, r;</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="c1"># Call price is decreasing with K.</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="nb">print</span><span class="p">(</span><span class="n">bs_call</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="nb">print</span><span class="p">(</span><span class="n">bs_call</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">102</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="nb">print</span><span class="p">(</span><span class="n">bs_call</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">.3</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mf">0.05</span><span class="p">))</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="nb">print</span><span class="p">(</span><span class="n">bs_call</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">.3</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;c&#39;: 11.923538474048499, &#39;delta&#39;: 0.5596176923702425, &#39;gamma&#39;: 0.013149311030262966}
{&#39;c&#39;: 13.068803286156744, &#39;delta&#39;: 0.5855095394527341, &#39;gamma&#39;: 0.012736690514019119}
{&#39;c&#39;: 14.231254785985826, &#39;delta&#39;: 0.6242517279060125, &#39;gamma&#39;: 0.012647764437231514}
{&#39;c&#39;: 17.0128799018497, &#39;delta&#39;: 0.6918854176337346, &#39;gamma&#39;: 0.011728453149086748}
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1"># option price as a function of the underlying</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="n">K</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.05</span> <span class="c1">#0.02</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="c1"># payoffs of call and put</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="n">payoff_c</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">s</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">)</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="n">payoff_p</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="n">s</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">k</span> <span class="o">&gt;</span> <span class="n">s</span><span class="p">)</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="c1"># some temp functions</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="n">tmpc</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">bs_call</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">r</span><span class="p">)[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="n">tmpp</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">bs_put</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">r</span><span class="p">)[</span><span class="s1">&#39;p&#39;</span><span class="p">]</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="n">tmp_payoff_c</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">payoff_c</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="n">tmp_payoff_p</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">payoff_p</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="c1"># plot</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">201</span><span class="p">)</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="n">y</span> <span class="o">=</span> <span class="n">tmpc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Black-Scholes&#39;</span><span class="p">)</span>
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="n">y</span> <span class="o">=</span> <span class="n">tmp_payoff_c</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;payoff&#39;</span><span class="p">)</span>
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$S$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;call price&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a><span class="n">y</span> <span class="o">=</span> <span class="n">tmpp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Black-Scholes&#39;</span><span class="p">)</span>
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a><span class="n">y</span> <span class="o">=</span> <span class="n">tmp_payoff_p</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;payoff&#39;</span><span class="p">)</span>
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$S$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;put price&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
<a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a>
<a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a><span class="c1"># Call option price is always higher than the payoff before maturity,</span>
<a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a><span class="c1"># so people would rather sell it than exercise it early.</span>
<a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a><span class="c1"># However, put option price maybe lower than the payoff,</span>
<a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a><span class="c1"># so sometimes it&#39;s better to exercise put option early.</span>
</code></pre></div>
<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-3/black-scholes-1_19_0.png" />
​    </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1"># option price as a function of strike</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="n">s</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mi">1</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="n">tmpc</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">bs_call</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">T</span><span class="p">)[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="n">tmpp</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">bs_put</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">T</span><span class="p">)[</span><span class="s1">&#39;p&#39;</span><span class="p">]</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="c1"># plot</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">201</span><span class="p">)</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="n">y</span> <span class="o">=</span> <span class="n">tmpc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Black-Scholes&#39;</span><span class="p">)</span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$K$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;call price&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="n">y</span> <span class="o">=</span> <span class="n">tmpp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Black-Scholes&#39;</span><span class="p">)</span>
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$K$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;put price&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">);</span>
</code></pre></div>
<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-3/black-scholes-1_20_0.png" />
​    </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1"># option price as a function of volatility</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="n">s</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">1</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="n">tmpc</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">bs_call</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">T</span><span class="p">)[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="n">tmpp</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">bs_put</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">T</span><span class="p">)[</span><span class="s1">&#39;p&#39;</span><span class="p">]</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="c1"># plot</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">201</span><span class="p">)</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="n">y</span> <span class="o">=</span> <span class="n">tmpc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Black-Scholes&#39;</span><span class="p">)</span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\sigma$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;call price&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="n">y</span> <span class="o">=</span> <span class="n">tmpp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Black-Scholes&#39;</span><span class="p">)</span>
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\sigma$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;put price&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">);</span>
</code></pre></div>
<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-3/black-scholes-1_21_0.png" />
​    </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1"># option price as a function of time to expiry</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="n">s</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mf">0.3</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="n">tmpc</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">bs_call</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">x</span><span class="p">)[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="n">tmpp</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">bs_put</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">x</span><span class="p">)[</span><span class="s1">&#39;p&#39;</span><span class="p">]</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="c1"># plot</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">201</span><span class="p">)</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="n">y</span> <span class="o">=</span> <span class="n">tmpc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Black-Scholes&#39;</span><span class="p">)</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time to expiry&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;call price&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="n">y</span> <span class="o">=</span> <span class="n">tmpp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Black-Scholes&#39;</span><span class="p">)</span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time to expiry&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;put price&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">);</span>
</code></pre></div>
<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-3/black-scholes-1_22_0.png" />
​    </p>
<h2 id="sensitivities-of-option-prices-in-black-scholes-model-the-greeks">Sensitivities of option prices in Black-Scholes model - the Greeks<a class="headerlink" href="#sensitivities-of-option-prices-in-black-scholes-model-the-greeks" title="Permanent link">&para;</a></h2>
<p>Assume the dividend rate <span class="arithmatex">\(d = 0\)</span>.</p>
<ul>
<li>
<p>For call:</p>
<ul>
<li><span class="arithmatex">\(\Delta_C = \frac{\p C}{\p S} = N(d_1)\)</span> (sensitivity with respect to the stock price)</li>
<li>Dual <span class="arithmatex">\(\Delta_C^K = \frac{\p C}{\p K} = -e^{-rT} N(d_2)\)</span> </li>
<li><span class="arithmatex">\(\Gamma = \frac{\p^2 C}{\p S^2} = \frac{n(d_1)}{S\sigma\sqrt T}\)</span> (second derivative with respect to the underlying)</li>
<li><span class="arithmatex">\(\Theta_C = \frac{\p C}{\p T} = \frac{S \sigma}{2\sqrt T} n(d_1) + r K e^{-rT} N(d_2)\)</span></li>
<li>$\nu \, (\mbox{vega}) = \frac{\p C}{\p \sigma} = S \sqrt T \, n(d_1) $ (sensitivity with respect to volatility)</li>
<li><span class="arithmatex">\(\rho_C = \frac{\p C}{\p r} = K T e^{-rT} N(d_2)\)</span></li>
</ul>
</li>
<li>
<p>For put:</p>
<ul>
<li><span class="arithmatex">\(\Delta_P = \frac{\p P}{\p S} = \Delta_C - 1 = -N(-d_1)\)</span></li>
<li>Dual <span class="arithmatex">\(\Delta_P^K = \frac{\p P}{\p K} = \Delta_C^K + e^{-r T} = e^{-rT} N(-d_2)\)</span> </li>
<li><span class="arithmatex">\(\Gamma = \frac{\p^2 P}{\p S^2} = \frac{\p^2 C}{\p S^2}\)</span></li>
<li><span class="arithmatex">\(\Theta_P = \frac{\p P}{\p T} = \Theta_C - r e^{-rT} K = \frac{S \sigma}{2\sqrt T} n(d_1) - r K e^{-rT} N(-d_2)\)</span></li>
<li><span class="arithmatex">\(\nu \, (\mbox{vega}) = \frac{\p P}{\p \sigma} = \frac{\p C}{\p \sigma} = S \sqrt T n(d_1)\)</span></li>
<li><span class="arithmatex">\(\rho_P = \frac{\p P}{\p r} = \rho_C - T e^{-rT} K = -K T e^{-rT} N(-d_2)\)</span></li>
</ul>
</li>
</ul>
<h4 id="note_4">Note<a class="headerlink" href="#note_4" title="Permanent link">&para;</a></h4>
<ul>
<li><span class="arithmatex">\(n(x) = N'(x)\)</span> is the pdf for standard normal.</li>
<li><span class="arithmatex">\(\Theta_C &gt; 0\)</span>, whereas <span class="arithmatex">\(\Theta_P\)</span> may be negative if <span class="arithmatex">\(r &gt; 0\)</span>.</li>
</ul>
<h2 id="subtlety-in-self-financing">Subtlety in self-financing<a class="headerlink" href="#subtlety-in-self-financing" title="Permanent link">&para;</a></h2>
<p>Assume that all the tradings are done at the mid price <span class="arithmatex">\(S_t\)</span>, i.e., no bid-ask spread and transaction cost. </p>
<p>In a discrete time setting, consider a portfolo consisting of holding <span class="arithmatex">\(H_t\)</span> shares of the underlying and <span class="arithmatex">\(K_t\)</span> dollars in the money/cash account at time <span class="arithmatex">\(t\)</span>, interest and dividend are assumed zero for simplicity. </p>
<p>The monetary value <span class="arithmatex">\(V_t\)</span> of the porffolio, <em>marked to market value at the mid price</em>, is thus given by <span class="arithmatex">\(V_t = H_tS_t + K_t\)</span> (before the price of the underlying changes from <span class="arithmatex">\(S_t\)</span> to <span class="arithmatex">\(S_{t+1}\)</span>). At this point, the investor may decide to change his portfolio before he observes the price change of the underlying from <span class="arithmatex">\(S_t\)</span> to <span class="arithmatex">\(S_{t+1}\)</span> or after the price change.  </p>
<ul>
<li><em>Before price change</em>. In this case, the self-financing condition reads 
$$
V_t = H_t S_t + K_t = H_{t+1} S_t + K_{t+1},
$$
where apparently <span class="arithmatex">\(K_{t+1} = K_t + (H_t - H_{t+1})\)</span><font color=blue><span class="arithmatex">\(S_t\)</span></font>. In other words, the investor simply moves his money from stock to money account (or the other way around) without pouring/withdrawing extra money/shares into/out of the portfolio. The value of the porfolio (after price change) at time <span class="arithmatex">\(t+1\)</span> is given by <span class="arithmatex">\(V_{t+1} = H_{t+1}S_{t+1} + K_{t+1}\)</span>. Hence, </li>
</ul>
<div class="arithmatex">\[
\begin{eqnarray*}
\Delta V_{t+1} &amp;=&amp; V_{t+1} - V_t \\
&amp;=&amp; H_{t+1}S_{t+1} + K_{t+1} - (H_t S_t + K_t) \\
&amp;=&amp; H_{t+1}S_{t+1} + K_{t+1} - (H_{t+1} S_t + K_{t+1}) \\
&amp;=&amp; H_{t+1} \Delta S_{t+1}.
\end{eqnarray*}
\]</div>
<p>If we write <span class="arithmatex">\(H_{t+1} = H_t + \Delta H_{t+1}\)</span>, then </p>
<div class="arithmatex">\[
\Delta V_{t+1} = H_t \Delta S_{t+1} + \Delta H_{t+1} \Delta S_{t+1}
\]</div>
<ul>
<li><em>After price change</em>. In this case, the self-financing condition becomes 
$$
V_{t+1} = H_t S_{t+1} + K_t = H_{t+1} S_{t+1} + K_{t+1},
$$
where <span class="arithmatex">\(K_{t+1} = K_t + (H_t - H_{t+1})\)</span><font color=blue><span class="arithmatex">\(S_{t+1}\)</span></font>. Hence, </li>
</ul>
<div class="arithmatex">\[
\begin{eqnarray*}
\Delta V_{t+1} &amp;=&amp; V_{t+1} - V_t \\
&amp;=&amp; H_{t+1}S_{t+1} + K_{t+1} - (H_t S_t + K_t) \\
&amp;=&amp; H_{t+1}S_{t+1} + K_t + (H_t - H_{t+1})S_{t+1} - (H_t S_t + K_t) \\
&amp;=&amp; H_t \Delta S_{t+1}.
\end{eqnarray*}
\]</div>
<p>The subtlety results from the investor's decision to rebalance his position before or after he observes the price change. Moreover, the discrepancy between the two increments of portfolio values is exactly the covariation between the holdings <span class="arithmatex">\(H_t\)</span> and the price <span class="arithmatex">\(S_t\)</span> of the underlying. In the continuous time limit, the discrepancy becomes insignificent should the covariation vanishes in the continuous time limit. In a recent paper by Carmona and Webster, the authors argued that, in the high frequency trading regime, empirically this covariation is statistically significant. As a result, the process of holdings <span class="arithmatex">\(H_t\)</span> cannot be of finite variation, counterintuitive to common knowledge.</p>
<h2 id="self-financing-with-traded-price">Self-financing with traded price<a class="headerlink" href="#self-financing-with-traded-price" title="Permanent link">&para;</a></h2>
<p>In reality, trading incurs transaction cost which consist of bid-ask spread, fees, and taxes. The self-financing conditions with transaction cost becomes </p>
<ul>
<li><em>Before price change</em>. 
  $$
  V_t = H_t S_t + K_t = H_{t+1} S_t + K_{t+1} ,
  $$
  where <span class="arithmatex">\(K_{t+1} = K_t + (H_t - H_{t+1})S_t - c_t\)</span> and <span class="arithmatex">\(c_t &gt; 0\)</span> denotes the transaction cost at time <span class="arithmatex">\(t\)</span>. Hence, the increment of <span class="arithmatex">\(V\)</span> at time <span class="arithmatex">\(t+1\)</span> </li>
</ul>
<div class="arithmatex">\[
  \begin{eqnarray*}
  \Delta V_{t+1} &amp;=&amp; V_{t+1} - V_t \\
  &amp;=&amp; H_{t+1}S_{t+1} + K_t + (H_t - H_{t+1})S_t - c_t - (H_t S_t + K_t) \\
  &amp;=&amp; H_{t+1} \Delta S_{t+1} - c_t \\
  &amp;=&amp; H_t \Delta S_{t+1} + \Delta H_{t+1} \Delta S_{t+1} - c_t.
  \end{eqnarray*}
\]</div>
<ul>
<li><em>After price change</em>. By the same token, in this case one can show that </li>
</ul>
<div class="arithmatex">\[
    \begin{eqnarray*}
    \Delta V_{t+1} = H_t \Delta S_{t+1} - c_{t+1},
    \end{eqnarray*} 
\]</div>
<p>where the transaction cost <span class="arithmatex">\(c_{t+1}\)</span> is incurred at time <span class="arithmatex">\(t+1\)</span>.</p>
<h2 id="delta-hedging">Delta hedging<a class="headerlink" href="#delta-hedging" title="Permanent link">&para;</a></h2>
<p>The portfolio used in deriving the Black-Scholes PDE is called <em>delta-hedging</em>.</p>
<h4 id="note_5">Note<a class="headerlink" href="#note_5" title="Permanent link">&para;</a></h4>
<p>Rebalancing of hedging porfolio is done <em>after</em> the price change.  </p>
<h3 id="an-example-on-delta-hedge">An example on delta hedge<a class="headerlink" href="#an-example-on-delta-hedge" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1"># Typically, the volatility of stocks is 20%-30%</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="n">r</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.3</span> 
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="n">s0</span><span class="p">,</span> <span class="n">K</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">252</span> <span class="c1"># one day </span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="n">t</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">4</span> <span class="c1"># a quarter of year, 3 month</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="c1"># unpack a dict by using the .values method for dict object</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="n">c</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">bs_call</span><span class="p">(</span><span class="n">s0</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;call price = </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">, delta = </span><span class="si">{</span><span class="n">delta</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> 
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="n">bs_call</span><span class="p">(</span><span class="n">s0</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>call price = 0.25002448066930727, delta = 0.28760290709660397





{&#39;c&#39;: 0.25002448066930727,
 &#39;delta&#39;: 0.28760290709660397,
 &#39;gamma&#39;: 0.2273127644037836}
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="nb">print</span><span class="p">(</span><span class="n">bs_call</span><span class="p">(</span><span class="n">s0</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">r</span><span class="p">))</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="nb">print</span><span class="p">(</span><span class="n">bs_call</span><span class="p">(</span><span class="n">s0</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;c&#39;: 0.25002448066930727, &#39;delta&#39;: 0.28760290709660397, &#39;gamma&#39;: 0.2273127644037836}
dict_values([0.25002448066930727, 0.28760290709660397, 0.2273127644037836])
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c1"># a range of underlying prices one day later</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="n">s</span> <span class="o">=</span> <span class="n">s0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="n">bs_call</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">t</span><span class="o">-</span><span class="n">dt</span><span class="p">,</span> <span class="n">r</span><span class="p">)[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="n">delta</span><span class="o">*</span><span class="n">s0</span> <span class="o">-</span> <span class="n">c</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>[ 9.   9.1  9.2  9.3  9.4  9.5  9.6  9.7  9.8  9.9 10.  10.1 10.2 10.3
 10.4 10.5 10.6 10.7 10.8 10.9 11. ]





2.6260045902967324
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">pnl_naked</span> <span class="o">=</span> <span class="n">c</span> <span class="o">-</span> <span class="n">bs_call</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">t</span><span class="o">-</span><span class="n">dt</span><span class="p">,</span> <span class="n">r</span><span class="p">)[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="n">pnl_delta</span> <span class="o">=</span> <span class="n">delta</span><span class="o">*</span><span class="n">s</span> <span class="o">-</span> <span class="n">bs_call</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">t</span><span class="o">-</span><span class="n">dt</span><span class="p">,</span> <span class="n">r</span><span class="p">)[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">delta</span><span class="o">*</span><span class="n">s0</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;naked&#39;</span><span class="p">:</span> <span class="n">pnl_naked</span><span class="p">,</span> <span class="s1">&#39;delta_hedged&#39;</span><span class="p">:</span> <span class="n">pnl_delta</span><span class="p">})</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>naked</th>
      <th>delta_hedged</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.189399</td>
      <td>-0.098204</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.178589</td>
      <td>-0.080254</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.166344</td>
      <td>-0.063738</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.152554</td>
      <td>-0.048768</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.137110</td>
      <td>-0.035452</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.119905</td>
      <td>-0.023896</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.100837</td>
      <td>-0.014204</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.079807</td>
      <td>-0.006474</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.056725</td>
      <td>-0.000796</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.031504</td>
      <td>0.002744</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.004069</td>
      <td>0.004069</td>
    </tr>
    <tr>
      <th>11</th>
      <td>-0.025650</td>
      <td>0.003111</td>
    </tr>
    <tr>
      <th>12</th>
      <td>-0.057711</td>
      <td>-0.000190</td>
    </tr>
    <tr>
      <th>13</th>
      <td>-0.092164</td>
      <td>-0.005883</td>
    </tr>
    <tr>
      <th>14</th>
      <td>-0.129050</td>
      <td>-0.014009</td>
    </tr>
    <tr>
      <th>15</th>
      <td>-0.168397</td>
      <td>-0.024596</td>
    </tr>
    <tr>
      <th>16</th>
      <td>-0.210225</td>
      <td>-0.037664</td>
    </tr>
    <tr>
      <th>17</th>
      <td>-0.254544</td>
      <td>-0.053222</td>
    </tr>
    <tr>
      <th>18</th>
      <td>-0.301352</td>
      <td>-0.071269</td>
    </tr>
    <tr>
      <th>19</th>
      <td>-0.350638</td>
      <td>-0.091795</td>
    </tr>
    <tr>
      <th>20</th>
      <td>-0.402383</td>
      <td>-0.114780</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c1"># plot</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">pnl_naked</span><span class="p">,</span> <span class="s1">&#39;o-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Naked call&#39;</span><span class="p">)</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">pnl_delta</span><span class="p">,</span> <span class="s1">&#39;o-.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Delta hedged&#39;</span><span class="p">)</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">xmax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">)</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;P&amp;L&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$s$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</code></pre></div>
<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-3/black-scholes-1_32_0.png" />
​    </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1"># zoom into the interval [9.5, 10.5]</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">pnl_naked</span><span class="p">,</span> <span class="s1">&#39;o-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Naked call&#39;</span><span class="p">)</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">pnl_delta</span><span class="p">,</span> <span class="s1">&#39;o-.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Delta hedged&#39;</span><span class="p">)</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">xmax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">)</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;P&amp;L&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$s$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">9.5</span><span class="p">,</span> <span class="mf">10.5</span><span class="p">)</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</code></pre></div>
<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-3/black-scholes-1_33_0.png" />
​    </p>
<h2 id="an-exmaple-on-delta-gamma-hedge">An exmaple on delta-gamma hedge<a class="headerlink" href="#an-exmaple-on-delta-gamma-hedge" title="Permanent link">&para;</a></h2>
<p><font color=blue> Note </font>
The gammas of the underlying and forward are zero. To construct a delta-gamma hedge portfolio we need to add into the portfolio an instrument that has nonzero gamma, say, call or put options (gamma of the underlying itself is zero!).</p>
<ul>
<li>
<p>Gamma neutral: <span class="arithmatex">\(-\Gamma_C +  x \Gamma_{C1} = 0  \Longrightarrow x = \frac{\Gamma_C}{\Gamma_{C1}}\)</span></p>
</li>
<li>
<p>Delta neutral: <span class="arithmatex">\(-\Delta_C + x \Delta_{C1} + y = 0 \Longrightarrow y = \Delta_C - x \Delta_{C1}\)</span></p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="n">r</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">s0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">10</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="n">dt</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">252</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">4</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="c1"># target call</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="n">c</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">bs_call</span><span class="p">(</span><span class="n">s0</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="c1"># call for hedging</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="n">K_hg</span> <span class="o">=</span> <span class="mi">14</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="n">c_hg</span><span class="p">,</span> <span class="n">delta_hg</span><span class="p">,</span> <span class="n">gamma_hg</span> <span class="o">=</span> <span class="n">bs_call</span><span class="p">(</span><span class="n">s0</span><span class="p">,</span> <span class="n">K_hg</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="c1"># 1 day later</span>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="n">s</span> <span class="o">=</span> <span class="n">s0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="n">cs</span> <span class="o">=</span> <span class="n">bs_call</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">t</span><span class="o">-</span><span class="n">dt</span><span class="p">,</span> <span class="n">r</span><span class="p">)[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="n">pnl_naked</span> <span class="o">=</span> <span class="n">c</span> <span class="o">-</span> <span class="n">cs</span>
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a><span class="n">pnl_delta</span> <span class="o">=</span> <span class="n">delta</span><span class="o">*</span><span class="n">s</span> <span class="o">-</span> <span class="n">cs</span> <span class="o">-</span> <span class="p">(</span><span class="n">delta</span><span class="o">*</span><span class="n">s0</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span>
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="n">delta_dg</span> <span class="o">=</span> <span class="n">delta</span> <span class="o">-</span> <span class="n">gamma</span><span class="o">/</span><span class="n">gamma_hg</span><span class="o">*</span><span class="n">delta_hg</span>
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a><span class="n">gamma_dg</span> <span class="o">=</span> <span class="n">gamma</span><span class="o">/</span><span class="n">gamma_hg</span>
<a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a><span class="n">pnl_dg</span> <span class="o">=</span> <span class="n">delta_dg</span><span class="o">*</span><span class="n">s</span> <span class="o">+</span> <span class="n">gamma_dg</span><span class="o">*</span><span class="n">bs_call</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">K_hg</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">t</span><span class="o">-</span><span class="n">dt</span><span class="p">,</span> <span class="n">r</span><span class="p">)[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">cs</span> <span class="o">-</span> <span class="p">(</span><span class="n">delta_dg</span><span class="o">*</span><span class="n">s0</span> <span class="o">+</span> <span class="n">gamma_dg</span><span class="o">*</span><span class="n">c_hg</span>  <span class="o">-</span> <span class="n">c</span><span class="p">)</span>
<a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a>
<a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a><span class="c1"># pandas.DataFrame for presentation</span>
<a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pnl_naked</span><span class="p">,</span> <span class="n">pnl_delta</span><span class="p">,</span> <span class="n">pnl_dg</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">())</span>
<a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;naked&#39;</span><span class="p">,</span> <span class="s1">&#39;delta hedged&#39;</span><span class="p">,</span> <span class="s1">&#39;delta-gamma hedged&#39;</span><span class="p">]</span>
<a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a><span class="n">df</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>naked</th>
      <th>delta hedged</th>
      <th>delta-gamma hedged</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.189399</td>
      <td>-0.098204</td>
      <td>-0.025266</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.178589</td>
      <td>-0.080254</td>
      <td>-0.018913</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.166344</td>
      <td>-0.063738</td>
      <td>-0.013499</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.152554</td>
      <td>-0.048768</td>
      <td>-0.009028</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.137110</td>
      <td>-0.035452</td>
      <td>-0.005487</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.119905</td>
      <td>-0.023896</td>
      <td>-0.002840</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.100837</td>
      <td>-0.014204</td>
      <td>-0.001027</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.079807</td>
      <td>-0.006474</td>
      <td>0.000038</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.056725</td>
      <td>-0.000796</td>
      <td>0.000471</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.031504</td>
      <td>0.002744</td>
      <td>0.000423</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.004069</td>
      <td>0.004069</td>
      <td>0.000075</td>
    </tr>
    <tr>
      <th>11</th>
      <td>-0.025650</td>
      <td>0.003111</td>
      <td>-0.000354</td>
    </tr>
    <tr>
      <th>12</th>
      <td>-0.057711</td>
      <td>-0.000190</td>
      <td>-0.000607</td>
    </tr>
    <tr>
      <th>13</th>
      <td>-0.092164</td>
      <td>-0.005883</td>
      <td>-0.000389</td>
    </tr>
    <tr>
      <th>14</th>
      <td>-0.129050</td>
      <td>-0.014009</td>
      <td>0.000633</td>
    </tr>
    <tr>
      <th>15</th>
      <td>-0.168397</td>
      <td>-0.024596</td>
      <td>0.002832</td>
    </tr>
    <tr>
      <th>16</th>
      <td>-0.210225</td>
      <td>-0.037664</td>
      <td>0.006620</td>
    </tr>
    <tr>
      <th>17</th>
      <td>-0.254544</td>
      <td>-0.053222</td>
      <td>0.012447</td>
    </tr>
    <tr>
      <th>18</th>
      <td>-0.301352</td>
      <td>-0.071269</td>
      <td>0.020799</td>
    </tr>
    <tr>
      <th>19</th>
      <td>-0.350638</td>
      <td>-0.091795</td>
      <td>0.032197</td>
    </tr>
    <tr>
      <th>20</th>
      <td>-0.402383</td>
      <td>-0.114780</td>
      <td>0.047194</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="c1"># plot</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">pnl_naked</span><span class="p">,</span> <span class="s1">&#39;o-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Naked call&#39;</span><span class="p">)</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">pnl_delta</span><span class="p">,</span> <span class="s1">&#39;o-.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Delta hedged&#39;</span><span class="p">)</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">pnl_dg</span><span class="p">,</span> <span class="s1">&#39;o-.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Delta Gamma hedged&#39;</span><span class="p">)</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">xmax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">)</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;P&amp;L&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$s$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</code></pre></div>
<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-3/black-scholes-1_37_0.png" />
​    </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1"># zoom into the interval [9.5, 10.5]</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">pnl_naked</span><span class="p">,</span> <span class="s1">&#39;o-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Naked call&#39;</span><span class="p">)</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">pnl_delta</span><span class="p">,</span> <span class="s1">&#39;o-.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Delta hedged&#39;</span><span class="p">)</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">pnl_dg</span><span class="p">,</span> <span class="s1">&#39;o-.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Delta Gamma hedged&#39;</span><span class="p">)</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">xmax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">)</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;P&amp;L&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$s$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">9.5</span><span class="p">,</span> <span class="mf">10.5</span><span class="p">)</span>
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</code></pre></div>
<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-3/black-scholes-1_38_0.png" />
​    </p>
<h2 id="dynamical-hedging">Dynamical hedging<a class="headerlink" href="#dynamical-hedging" title="Permanent link">&para;</a></h2>
<p>As market conditions evolve, to maintain the delta neutrality of the portfolio, ideally we should dynamically change the holdings in the porfolio. For example,  </p>
<h4 id="note_6">Note<a class="headerlink" href="#note_6" title="Permanent link">&para;</a></h4>
<ul>
<li>Rebalancing of hedging portfolio is done after observing the price change. </li>
</ul>
<h3 id="an-example-on-dynamical-hedging">An example on dynamical hedging<a class="headerlink" href="#an-example-on-dynamical-hedging" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c1"># parameters</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="n">r</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.3</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="n">s0</span><span class="p">,</span> <span class="n">K</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="n">dt</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">days_forward</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">252</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="mi">30</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="c1"># portfolio positions in cash, options, underlying</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="c1"># x : number of shares in underlying</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="c1"># y : dollars in cash</span>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="c1"># z : number of options</span>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="c1"># short 1000 calls</span>
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="n">z</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1000</span>
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a>
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="c1"># current price and delta of call</span>
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="n">c</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">bs_call</span><span class="p">(</span><span class="n">s0</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a>
<a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="c1"># construct a zero value and delta neutral portfolio</span>
<a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a><span class="n">x</span> <span class="o">=</span> <span class="n">delta</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">z</span><span class="p">)</span>
<a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a><span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">s0</span> <span class="o">+</span> <span class="n">z</span><span class="o">*</span><span class="n">c</span><span class="p">)</span>
<a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a><span class="n">port_value</span><span class="p">,</span> <span class="n">port_delta</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">s0</span> <span class="o">+</span> <span class="n">y</span> <span class="o">+</span> <span class="n">z</span><span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">z</span><span class="o">*</span><span class="n">delta</span>
<a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a><span class="n">s</span><span class="p">,</span> <span class="n">pnl_cum</span> <span class="o">=</span> <span class="n">s0</span><span class="p">,</span> <span class="mi">0</span>
<a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a>
<a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a><span class="c1"># pandas.DataFrame for presentation</span>
<a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">port_value</span><span class="p">,</span> <span class="n">port_delta</span><span class="p">,</span> <span class="n">pnl_cum</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">*</span><span class="n">delta</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-8.526513e-14</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>0.250024</td>
      <td>287.602907</td>
      <td>-2626.00459</td>
      <td>-287.602907</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1"># 1 day later</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="n">s_new</span> <span class="o">=</span> <span class="n">s0</span><span class="o">*</span><span class="n">exp</span><span class="p">((</span><span class="n">r</span> <span class="o">-</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span> <span class="o">+</span> <span class="n">sigma</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span><span class="o">*</span><span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">())</span> <span class="c1"># sample a new stock price</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="n">c_new</span><span class="p">,</span> <span class="n">delta_new</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">bs_call</span><span class="p">(</span><span class="n">s_new</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">t</span><span class="o">-</span><span class="n">i</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="c1"># portfolio value before rebalance </span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="n">port_value_new</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">s_new</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">i</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span> <span class="o">+</span> <span class="n">z</span><span class="o">*</span><span class="n">c_new</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="n">pnl_cum</span> <span class="o">=</span> <span class="n">pnl_cum</span> <span class="o">+</span> <span class="n">port_value_new</span> <span class="o">-</span> <span class="n">port_value</span>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="c1"># rebalance to delta neutral</span>
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="n">x_new</span> <span class="o">=</span> <span class="n">delta_new</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">z</span><span class="p">)</span>
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="n">y_new</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">i</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x_new</span><span class="p">)</span><span class="o">*</span><span class="n">s_new</span>
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="n">port_value</span> <span class="o">=</span> <span class="n">x_new</span><span class="o">*</span><span class="n">s_new</span> <span class="o">+</span> <span class="n">y_new</span> <span class="o">+</span> <span class="n">z</span><span class="o">*</span><span class="n">c_new</span>
<a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a><span class="n">port_delta</span> <span class="o">=</span> <span class="n">x_new</span> <span class="o">+</span> <span class="n">z</span><span class="o">*</span><span class="n">delta_new</span>
<a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a><span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">s_new</span><span class="p">,</span> <span class="n">c_new</span><span class="p">,</span> <span class="n">x_new</span><span class="p">,</span> <span class="n">delta_new</span><span class="p">,</span> <span class="n">y_new</span>
<a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a>
<a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a>
<a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a><span class="c1"># display the result</span>
<a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">port_value</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4.0087</td>
      <td>10.032909</td>
      <td>0.25548</td>
      <td>-2682.286489</td>
      <td>293.212636</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1"># Let&#39;s see how it works for 30 days forward</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="c1"># initialize data</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="n">port_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">days_forward</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="n">s</span> <span class="o">=</span> <span class="n">s0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">days_forward</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="n">calls</span> <span class="o">=</span> <span class="n">c</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">days_forward</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="n">deltas</span> <span class="o">=</span> <span class="n">delta</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">days_forward</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="n">shares</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">days_forward</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="n">cash</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">days_forward</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">days_forward</span><span class="p">):</span>    
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>    <span class="c1"># sample a stock price</span>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a>    <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">exp</span><span class="p">((</span><span class="n">r</span> <span class="o">-</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span> <span class="o">+</span> <span class="n">sigma</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span><span class="o">*</span><span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">())</span> 
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a>    <span class="c1"># calculate new call price and delta</span>
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a>    <span class="n">calls</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">deltas</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">_</span> <span class="o">=</span> <span class="n">bs_call</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">t</span><span class="o">-</span><span class="n">i</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a>
<a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a>    <span class="c1"># portfolio value before rebalance </span>
<a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a>    <span class="n">port_value</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">shares</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">cash</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span> <span class="o">+</span> <span class="n">z</span><span class="o">*</span><span class="n">calls</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a>
<a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a>    <span class="c1"># rebalance (self-finacing) to delta neutral</span>
<a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a>    <span class="n">shares</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">deltas</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">z</span><span class="p">)</span>
<a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a>    <span class="n">cash</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cash</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">shares</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">shares</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a>
<a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a><span class="c1"># display the result</span>
<a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">port_value</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">calls</span><span class="p">,</span> <span class="n">shares</span><span class="p">,</span> <span class="n">cash</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<a id="__codelineno-21-26" name="__codelineno-21-26" href="#__codelineno-21-26"></a><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;portfolio value&#39;</span><span class="p">,</span> <span class="s1">&#39;stock price&#39;</span><span class="p">,</span> <span class="s1">&#39;call price&#39;</span><span class="p">,</span> <span class="s1">&#39;shares&#39;</span><span class="p">,</span> <span class="s1">&#39;cash&#39;</span><span class="p">]</span>
<a id="__codelineno-21-27" name="__codelineno-21-27" href="#__codelineno-21-27"></a><span class="n">df</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>portfolio value</th>
      <th>stock price</th>
      <th>call price</th>
      <th>shares</th>
      <th>cash</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.000000</td>
      <td>10.000000</td>
      <td>0.255480</td>
      <td>293.212636</td>
      <td>-2682.286489</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-2.934296</td>
      <td>9.866471</td>
      <td>0.213622</td>
      <td>257.839661</td>
      <td>-2333.280047</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.055841</td>
      <td>9.961899</td>
      <td>0.235237</td>
      <td>277.006987</td>
      <td>-2524.223013</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4.033587</td>
      <td>9.951206</td>
      <td>0.228297</td>
      <td>272.565340</td>
      <td>-2480.023269</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3.576690</td>
      <td>9.759862</td>
      <td>0.176600</td>
      <td>228.454157</td>
      <td>-2049.504213</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6.780305</td>
      <td>9.832621</td>
      <td>0.190019</td>
      <td>241.873276</td>
      <td>-2181.449328</td>
    </tr>
    <tr>
      <th>6</th>
      <td>6.853745</td>
      <td>10.024601</td>
      <td>0.236380</td>
      <td>283.258430</td>
      <td>-2596.318985</td>
    </tr>
    <tr>
      <th>7</th>
      <td>9.911283</td>
      <td>10.132685</td>
      <td>0.263938</td>
      <td>307.031225</td>
      <td>-2837.201233</td>
    </tr>
    <tr>
      <th>8</th>
      <td>14.388012</td>
      <td>10.141120</td>
      <td>0.262051</td>
      <td>307.079733</td>
      <td>-2837.693153</td>
    </tr>
    <tr>
      <th>9</th>
      <td>12.724883</td>
      <td>10.371314</td>
      <td>0.334402</td>
      <td>363.232160</td>
      <td>-3420.067634</td>
    </tr>
    <tr>
      <th>10</th>
      <td>14.417482</td>
      <td>10.218129</td>
      <td>0.277068</td>
      <td>322.222461</td>
      <td>-3001.025234</td>
    </tr>
    <tr>
      <th>11</th>
      <td>19.153584</td>
      <td>10.226238</td>
      <td>0.274945</td>
      <td>322.270828</td>
      <td>-3001.519856</td>
    </tr>
    <tr>
      <th>12</th>
      <td>20.022202</td>
      <td>10.407686</td>
      <td>0.332551</td>
      <td>367.672264</td>
      <td>-3474.043731</td>
    </tr>
    <tr>
      <th>13</th>
      <td>5.836616</td>
      <td>10.029471</td>
      <td>0.207678</td>
      <td>268.642372</td>
      <td>-2480.826311</td>
    </tr>
    <tr>
      <th>14</th>
      <td>9.573341</td>
      <td>10.112671</td>
      <td>0.226292</td>
      <td>286.861578</td>
      <td>-2665.071147</td>
    </tr>
    <tr>
      <th>15</th>
      <td>7.236629</td>
      <td>10.353548</td>
      <td>0.297727</td>
      <td>347.642896</td>
      <td>-3294.373463</td>
    </tr>
    <tr>
      <th>16</th>
      <td>12.301521</td>
      <td>10.391466</td>
      <td>0.305844</td>
      <td>355.991275</td>
      <td>-3381.125358</td>
    </tr>
    <tr>
      <th>17</th>
      <td>12.431688</td>
      <td>10.591195</td>
      <td>0.376816</td>
      <td>410.003613</td>
      <td>-3953.180545</td>
    </tr>
    <tr>
      <th>18</th>
      <td>18.096002</td>
      <td>10.613648</td>
      <td>0.380358</td>
      <td>414.935831</td>
      <td>-4005.529368</td>
    </tr>
    <tr>
      <th>19</th>
      <td>21.823489</td>
      <td>10.738191</td>
      <td>0.428307</td>
      <td>449.617839</td>
      <td>-4377.951406</td>
    </tr>
    <tr>
      <th>20</th>
      <td>8.465854</td>
      <td>10.377745</td>
      <td>0.279602</td>
      <td>343.897279</td>
      <td>-3280.810412</td>
    </tr>
    <tr>
      <th>21</th>
      <td>13.858941</td>
      <td>10.361839</td>
      <td>0.268739</td>
      <td>337.128097</td>
      <td>-3210.669239</td>
    </tr>
    <tr>
      <th>22</th>
      <td>4.184943</td>
      <td>10.691541</td>
      <td>0.389565</td>
      <td>432.114287</td>
      <td>-4226.217995</td>
    </tr>
    <tr>
      <th>23</th>
      <td>9.877649</td>
      <td>10.751996</td>
      <td>0.409996</td>
      <td>449.095960</td>
      <td>-4408.804877</td>
    </tr>
    <tr>
      <th>24</th>
      <td>3.326216</td>
      <td>11.045652</td>
      <td>0.548426</td>
      <td>537.609171</td>
      <td>-5386.490988</td>
    </tr>
    <tr>
      <th>25</th>
      <td>9.882366</td>
      <td>11.029907</td>
      <td>0.533406</td>
      <td>532.682659</td>
      <td>-5332.152016</td>
    </tr>
    <tr>
      <th>26</th>
      <td>13.503812</td>
      <td>10.890358</td>
      <td>0.455449</td>
      <td>488.934177</td>
      <td>-4855.715407</td>
    </tr>
    <tr>
      <th>27</th>
      <td>5.206982</td>
      <td>10.586183</td>
      <td>0.315024</td>
      <td>391.236226</td>
      <td>-3821.466998</td>
    </tr>
    <tr>
      <th>28</th>
      <td>7.583291</td>
      <td>10.750066</td>
      <td>0.376765</td>
      <td>441.960902</td>
      <td>-4366.760634</td>
    </tr>
    <tr>
      <th>29</th>
      <td>14.078094</td>
      <td>10.716546</td>
      <td>0.355456</td>
      <td>429.518258</td>
      <td>-4233.418461</td>
    </tr>
    <tr>
      <th>30</th>
      <td>13.766378</td>
      <td>10.514395</td>
      <td>0.268940</td>
      <td>361.432497</td>
      <td>-3517.537893</td>
    </tr>
  </tbody>
</table>
</div>

<h2 id="dynamic-hedge-in-practice">Dynamic hedge in practice<a class="headerlink" href="#dynamic-hedge-in-practice" title="Permanent link">&para;</a></h2>
<ul>
<li>Continuous trading in practice is unrealistic. </li>
<li>The tradeoff between frequency of rebalancing and replication of derivative</li>
<li>Imperfect hedge, risk penalty</li>
<li>Transaction cost, market order or limit order, etc</li>
</ul>
<h2 id="deep-hedging">Deep hedging<a class="headerlink" href="#deep-hedging" title="Permanent link">&para;</a></h2>
<p>Research works on hedging problem that resort to reinforcement learning techniques include</p>
<ul>
<li>Halperin, <em>QLBS: Q-Learner in the Black-Scholes(-Merton) Worlds</em></li>
<li>Buehler, Gonon, Teichmann, and Wood, <em>Deep hedging</em></li>
<li>Cao, Chen, Hull, and Poulos, <em>Deep hedging of derivatives using reinforcement learning</em></li>
<li>Kolm and Ritter, <em>Dynamic replication and hedging: a reinforcement learning approach</em></li>
</ul>
<h2 id="deep-hedging-in-a-nutshell">Deep hedging in a nutshell<a class="headerlink" href="#deep-hedging-in-a-nutshell" title="Permanent link">&para;</a></h2>
<p>The key idea behind deep hedging in the aforementioned works is to formulate the hedging problem as a stochastic control problem with certain objective functional, then solve the resulting control problem by the techniques introduced in reinforcement learning.  </p>
<p>Let's take the work by Cao, Chen, Hull, and Poulos as an example. </p>
<h2 id="notations">Notations<a class="headerlink" href="#notations" title="Permanent link">&para;</a></h2>
<ul>
<li><span class="arithmatex">\(i\)</span>: time, running from <span class="arithmatex">\(0\)</span> to <span class="arithmatex">\(n\)</span> </li>
<li><span class="arithmatex">\(C_i\)</span>: value of the call/derivative at the beginning of the time <span class="arithmatex">\(i\)</span></li>
<li><span class="arithmatex">\(S_i\)</span>: price of the underlying at the beginning of the time <span class="arithmatex">\(i\)</span></li>
<li><span class="arithmatex">\(H_i\)</span>: holdings of the underlying between time <span class="arithmatex">\(i\)</span> and <span class="arithmatex">\(i+1\)</span>. </li>
<li><span class="arithmatex">\(\kappa\)</span>: proportional transaction cost</li>
<li><span class="arithmatex">\(R_i\)</span>: running reward gained at time <span class="arithmatex">\(i\)</span></li>
</ul>
<h2 id="settings-in-cao-chen-hull-poulos">Settings in Cao-Chen-Hull-Poulos<a class="headerlink" href="#settings-in-cao-chen-hull-poulos" title="Permanent link">&para;</a></h2>
<p>Cao-Chen-Hull-Poulos formulate the hedging problem as follows.</p>
<ul>
<li>a trader is hedging a short position in a call option</li>
<li>hedging porfolio consisting of shares in the underlying, no cash component?</li>
<li>the trader rebalances his position at time intervals of length <span class="arithmatex">\(\Delta t\)</span> and is subject to trading costs </li>
<li>The life of the option is <span class="arithmatex">\(n\)</span>. </li>
<li>The cost of a trade in the underlying asset is proportional to the value of what is being bought or sold </li>
<li>The state at time <span class="arithmatex">\(i\)</span> is defined by three parameters:<ul>
<li>
<ol>
<li>The holding <span class="arithmatex">\(H_{i-1}\)</span> of the asset during the previous time period; i.e., from time <span class="arithmatex">\(i-1\)</span>  to time <span class="arithmatex">\(i\)</span></li>
</ol>
</li>
<li>
<ol>
<li>The asset price <span class="arithmatex">\(S_i\)</span> at time <span class="arithmatex">\(i\)</span></li>
</ol>
</li>
<li>
<ol>
<li>The time to maturity <span class="arithmatex">\((n-i)\)</span></li>
</ol>
</li>
</ul>
</li>
<li>The action/control <span class="arithmatex">\(H_i\)</span> at time <span class="arithmatex">\(i\)</span> is the amount of the asset to be held for the next period, i.e., from time <span class="arithmatex">\(i\)</span> to time <span class="arithmatex">\(i+1\)</span>.</li>
<li>Rebalance is done after observing the price change.  </li>
</ul>
<h2 id="two-alternative-formulations">Two alternative formulations<a class="headerlink" href="#two-alternative-formulations" title="Permanent link">&para;</a></h2>
<ul>
<li>There are two alternative formulations for the hedging problem: <ul>
<li>the accounting P&amp;L formulation </li>
<li>the cash flow formulation. </li>
</ul>
</li>
<li>For ease of exposition, no discounting is assumed in the control problem, i.e., <span class="arithmatex">\(\gamma=1\)</span></li>
</ul>
<h2 id="accounting-pl-formulation">Accounting P&amp;L formulation<a class="headerlink" href="#accounting-pl-formulation" title="Permanent link">&para;</a></h2>
<p>For <span class="arithmatex">\(1 \leq i \leq n\)</span>, define the running reward gained at time <span class="arithmatex">\(i\)</span> as</p>
<div class="arithmatex">\[
\begin{eqnarray*}
R_i &amp;=&amp; -C_i + C_{i-1} + H_{i-1} (S_i - S_{i-1}) - \kappa|S_i(H_i - H_{i-1})| \\
&amp;=&amp; -\Delta C_i + \underbrace{H_{i-1} \Delta S_i}_{\text{marked to market}} - \underbrace{\kappa|S_i\Delta H_i|}_{\text{transaction cost}}.
\end{eqnarray*}
\]</div>
<p>Note that this formulation is consistent with the self-financing conditon with transaction cost that was discussed previously. To set up the hedging initially and liquidate the position at expiry of option, we add to the (undiscounted) cumulative rewards  </p>
<ul>
<li>initial reward: <span class="arithmatex">\(-\kappa|S_0 H_0|\)</span></li>
<li>terminal reward: <span class="arithmatex">\(-\kappa|S_n H_n|\)</span></li>
</ul>
<p>Thus, the performance criterion <span class="arithmatex">\(Y^A\)</span> for a given hedging strategy <span class="arithmatex">\((H_0, \cdots, H_n)\)</span> reads</p>
<div class="arithmatex">\[
\begin{eqnarray*}
Y^A &amp;=&amp; -\kappa |S_0 H_0| + \sum_{i=1}^n R_i -\kappa |S_n H_n| \\
&amp;=&amp; -\kappa |S_0 H_0| + C_0 - C_n + \sum_{i=1}^n H_{i-1} \Delta S_i - \kappa\sum_{i=1}^n|S_i\Delta H_i| - \kappa |S_n H_n|.
\end{eqnarray*}
\]</div>
<h2 id="cashflow-formulation">Cashflow formulation<a class="headerlink" href="#cashflow-formulation" title="Permanent link">&para;</a></h2>
<p>In this formulation, for <span class="arithmatex">\(1 \leq i \leq n\)</span>, the running reward gained at time <span class="arithmatex">\(i\)</span> is defined by
$$
R_i = S_i(H_{i-1} - H_i) - \kappa |S_i(H_i - H_{i-1})|
= -S_i \Delta H_i - \kappa |S_i \Delta H_i|
$$
with 
- initial cost for setting up a position: <span class="arithmatex">\(-S_0H_0 - \kappa|S_0 H_0|\)</span>
- terminal cost for liquidate the position and payoff to call: <span class="arithmatex">\(S_nH_n - \kappa|S_n H_n| - C_n\)</span>.</p>
<p>Thus, the performance criterion <span class="arithmatex">\(Y^C\)</span> for a given hedging strategy <span class="arithmatex">\((H_0, \cdots, H_n)\)</span> reads</p>
<div class="arithmatex">\[
\begin{eqnarray*}
Y^C &amp;=&amp; -S_0H_0 - \kappa|S_0 H_0| + \sum_{i=1}^n R_i + S_nH_n - \kappa|S_n H_n| - C_n \\
&amp;=&amp; -S_0H_0 - \kappa|S_0 H_0| - \sum_{i=1}^n S_i \Delta H_i - \kappa \sum_{i=1}^n |S_i \Delta H_i| + S_nH_n - \kappa|S_n H_n| - C_n.
\end{eqnarray*}
\]</div>
<h2 id="accounting-pl-vs-cashflow">Accounting P&amp;L vs cashflow<a class="headerlink" href="#accounting-pl-vs-cashflow" title="Permanent link">&para;</a></h2>
<p>Recall that </p>
<div class="arithmatex">\[
\begin{eqnarray*}
Y^A &amp;=&amp; -\kappa |S_0 H_0| + C_0 - C_n + \sum_{i=1}^n H_{i-1} \Delta S_i - \kappa\sum_{i=1}^n|S_i\Delta H_i| - \kappa |S_n H_n| \\
&amp;=&amp; -\kappa |S_0 H_0| + C_0 - C_n + H_n S_n - H_0 S_0 - \sum_{i=1}^n S_i \Delta H_i - \kappa\sum_{i=1}^n|S_i\Delta H_i| - \kappa |S_n H_n|
\end{eqnarray*}
\]</div>
<p>where in the last equality we applied the following <em>summation by parts</em> formula</p>
<div class="arithmatex">\[
\begin{eqnarray*}
\sum_{i=1}^n H_{i-1} \Delta S_i = H_n S_n - H_0 S_0 - \sum_{i=1}^n S_i \Delta H_i. 
\end{eqnarray*}
\]</div>
<p>It follows that </p>
<div class="arithmatex">\[
\begin{eqnarray*}
Y^A - Y^C &amp;=&amp; C_0.
\end{eqnarray*}
\]</div>
<p>The two formulations are basically the same. </p>
<h2 id="objective-functional-and-resulting-control-problem">Objective functional and resulting control problem<a class="headerlink" href="#objective-functional-and-resulting-control-problem" title="Permanent link">&para;</a></h2>
<p>Objective functional for the performance criterion <span class="arithmatex">\(Y\)</span> is given by its expectation penalized by a risk measure. Namely,
$$
\Eof{Y} - \lambda \rho(Y),
$$
where <span class="arithmatex">\(\rho\)</span> is certain prespecified risk measure. Hence, the hedging problem can be recast as the following stochastic control problem 
$$
\max_{(H_0, \cdots, H_n)} \Eof{Y} - \lambda \rho(Y).
$$</p>
<p>From this point on, reinforcement learning techniques are then applied to solve the above control problem. </p>
<h4 id="note_7">Note<a class="headerlink" href="#note_7" title="Permanent link">&para;</a></h4>
<ul>
<li>In the original Cao-Chen-Hull-Poulos paper, the authors chose to penalize the expected reward by standard deviation. However, from control theory point of view, penalizing expected reward by variance/standard deviation will induce (unnecessary?) difficulty due to time inconsistency. </li>
<li>In the Buehler et al paper, the authors utilized the expected shortfall or conditional value-at-risk as the risk measure. </li>
</ul>
<h2 id="implementation-of-deep-hedging-in-tensorflow">Implementation of Deep hedging in <code>Tensorflow</code><a class="headerlink" href="#implementation-of-deep-hedging-in-tensorflow" title="Permanent link">&para;</a></h2>
<p>Courtsey: Laura He and Tony Xie, Baruch MFE 2020</p>
<h2 id="deep-hedging-implementation-with-ddpg-algorithm">Deep-hedging implementation with DDPG Algorithm<a class="headerlink" href="#deep-hedging-implementation-with-ddpg-algorithm" title="Permanent link">&para;</a></h2>
<p><strong>Step 1</strong>  Initialize neural network of <span class="arithmatex">\(Q_1(s,a|\theta^{Q_1}), Q_2(s,a|\theta^{Q_2})\)</span> and policy function <span class="arithmatex">\(\mu(s|\theta^\mu)\)</span>. Set target networks <span class="arithmatex">\(Q_1' \leftarrow Q_1,Q_2' \leftarrow Q_2,\mu' \leftarrow \mu\)</span>. Create replay buffer <span class="arithmatex">\(R\)</span>.</p>
<p><strong>Step 2</strong>  Begin loop:</p>
<p><strong>for</strong> episode <span class="arithmatex">\(= 1\)</span> to n_path: </p>
<p>Generate random process <span class="arithmatex">\({N_i}, i = 0, 1, ..., m\)</span> for action exploration. <br>
Get initial state: <span class="arithmatex">\(s_0 = [S_0\)</span>(stock price), <span class="arithmatex">\(V_0\)</span>(option price), <span class="arithmatex">\(H_{-1} = 0\)</span>(holding), <span class="arithmatex">\(\tau_0 = T = m\, dt\)</span>(time to maturity)<span class="arithmatex">\(]\)</span>. </p>
<p><strong>for</strong> <span class="arithmatex">\(i = 0\)</span> to <span class="arithmatex">\(m\)</span> (<span class="arithmatex">\(m\)</span> time intervals): </p>
<p><strong>Step 2.1</strong> Calculate action: <span class="arithmatex">\(a_i = (1-\epsilon_i)\mu(s_i|\theta^\mu) + \epsilon_i N_i,\,\, s_i = [S_i, V_i, H_{i-1}, \tau_i = (m-i)dt]\)</span> <br>
<strong>Step 2.2</strong> Execute <span class="arithmatex">\(a_i\)</span>. Get <span class="arithmatex">\(r_i = -(V_{i+1} - V_i) + H_i(S_{i+1} - S_i) - \kappa |S_ia_i|,\,\, 0\leqslant i&lt;m\)</span> <br>
<span class="arithmatex">\(\hspace{4.2 cm} r_m = - \kappa|S_mH_{m-1}|\)</span> <br>
<strong>Step 2.3</strong> Observe new state: <span class="arithmatex">\(s_{i+1} = [S_{i+1}, V_{i+1}, H_i = H_{i-1}+a_i, \tau_{i+1} = (m-i-1)dt]\)</span> <br>
<strong>Step 2.4</strong> Store <span class="arithmatex">\((s_i, a_i, r_i, s_{i+1})\)</span> in the replay buffer <span class="arithmatex">\(R\)</span>. <br>
<strong>Step 2.5</strong> Sample <span class="arithmatex">\(J\)</span> transitions from <span class="arithmatex">\(R\)</span>, mark as <span class="arithmatex">\((s_j, a_j, r_j, s_{j+1}), \,\, j = 1 \sim N/ J?\)</span> <br>
<span class="arithmatex">\(\hspace{1.6 cm}y_j^{(1)} = r_j + \gamma Q_1'(s_{i+1}, \mu'(s_{i+1}|\theta^{\mu'})|\theta^{Q'})\)</span> </p>
<p>$\hspace{1.6 cm}y_j^{(2)} = r_j^2 + \gamma^2 Q_2'(s_{i+1}, \mu'(s_{i+1}|\theta^{\mu'})|\theta^{Q'}) + 2 \gamma r_j Q_1'(s_{i+1}, \mu'(s_{i+1}|\theta^{\mu'})|\theta^{Q'}) $ </p>
<p><span class="arithmatex">\(\hspace{1.4 cm}\)</span> Update <span class="arithmatex">\(Q_{1,2}\)</span>: <span class="arithmatex">\(Q_{1,2} = \underset{Q_{1,2}}{\mathrm{argmin}}\left\{\frac{1}{J}\sum_j\left(y_j^{(1,2)} - Q_{1,2}(s_j,a_j|\theta^{Q_{1,2}})\right)^2\right\}\)</span> <br>
<span class="arithmatex">\(\hspace{1.4 cm}\)</span> Update <span class="arithmatex">\(\mu\)</span> using gradient descent: <span class="arithmatex">\(\nabla_{\theta^{\mu}}G = \frac{1}{J}\sum_j\nabla_aF(s_j, a_j|\theta^{Q_{1,2}})\nabla_{\theta^{\mu}}\mu(s_j|\theta^{\mu}),\,\, \theta^\mu = \theta^\mu - \nabla_{\theta^\mu}G \times \text{step}\)</span></p>
<p><strong>Step 2.6</strong> Update the target networks: <span class="arithmatex">\(\theta^{Q'_{1,2}} \leftarrow \tau\theta^{Q_{1,2}} + (1-\tau)\theta^{Q'_{1,2}}, \,\,\theta^{\mu'} \leftarrow \tau\theta^\mu + (1-\tau)\theta^{\mu'}\)</span></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="c1"># import DDPG and other related packages</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">DDPG.world</span><span class="w"> </span><span class="kn">import</span> <span class="n">World</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">tensorflow</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tf</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">DDPG.blackscholesgenerator</span><span class="w"> </span><span class="kn">import</span> <span class="n">GenerateBSPath</span><span class="p">,</span> <span class="n">BSCall</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
</code></pre></div>
<h2 id="performance-of-deep-hedging-vs-delta-hedging">Performance of deep hedging vs delta hedging<a class="headerlink" href="#performance-of-deep-hedging-vs-delta-hedging" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="c1"># python function to implement the trained model </span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">DDPG</span><span class="p">(</span><span class="n">n_path</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">S0</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">model_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>    <span class="n">stock_price</span><span class="p">,</span> <span class="n">call_price</span><span class="p">,</span> <span class="n">call_delta</span> <span class="o">=</span> <span class="n">GenerateBSPath</span><span class="p">(</span><span class="n">n_path</span><span class="o">=</span><span class="n">n_path</span><span class="p">,</span> \
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>                <span class="n">m</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">S0</span><span class="o">=</span><span class="n">S0</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="n">K</span><span class="p">)</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>    <span class="n">V0</span> <span class="o">=</span> <span class="n">call_price</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>    <span class="n">initial_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">S0</span><span class="p">,</span> <span class="n">V0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">])</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>    <span class="n">state_size</span><span class="p">,</span> <span class="n">action_size</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>    <span class="n">world</span> <span class="o">=</span> <span class="n">World</span><span class="p">(</span><span class="n">state_size</span><span class="p">,</span> <span class="n">action_size</span><span class="p">,</span> <span class="n">initial_state</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">T</span><span class="o">/</span><span class="n">m</span><span class="p">)</span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a>    <span class="c1"># load-in saved (trained) model </span>
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>    <span class="n">actor_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">model_path</span><span class="si">}</span><span class="s1">/Actor_Model&#39;</span><span class="p">,</span> <span class="nb">compile</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a>
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a>    <span class="n">actions_model</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_path</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span>
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a>    <span class="n">rewards</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_path</span><span class="p">)</span>
<a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a>
<a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a>    <span class="k">for</span> <span class="n">episode</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_path</span><span class="p">):</span>
<a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a>
<a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a>        <span class="k">if</span> <span class="n">episode</span> <span class="o">%</span> <span class="mi">2000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">episode</span><span class="p">)</span>
<a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a>
<a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a>        <span class="n">world</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a>
<a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
<a id="__codelineno-23-25" name="__codelineno-23-25" href="#__codelineno-23-25"></a>            <span class="n">state</span> <span class="o">=</span> <span class="n">world</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
<a id="__codelineno-23-26" name="__codelineno-23-26" href="#__codelineno-23-26"></a>            <span class="n">actions_model</span><span class="p">[</span><span class="n">episode</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">actor_model</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">state</span><span class="p">]))[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-23-27" name="__codelineno-23-27" href="#__codelineno-23-27"></a>            <span class="n">next_state</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span> <span class="o">=</span> <span class="n">world</span><span class="o">.</span><span class="n">act</span><span class="p">(</span><span class="n">actions_model</span><span class="p">[</span><span class="n">episode</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="n">stock_price</span><span class="p">[</span><span class="n">episode</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">call_price</span><span class="p">[</span><span class="n">episode</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
<a id="__codelineno-23-28" name="__codelineno-23-28" href="#__codelineno-23-28"></a>            <span class="n">rewards</span><span class="p">[</span><span class="n">episode</span><span class="p">]</span> <span class="o">+=</span> <span class="n">reward</span> 
<a id="__codelineno-23-29" name="__codelineno-23-29" href="#__codelineno-23-29"></a>
<a id="__codelineno-23-30" name="__codelineno-23-30" href="#__codelineno-23-30"></a>        <span class="n">state</span> <span class="o">=</span> <span class="n">world</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
<a id="__codelineno-23-31" name="__codelineno-23-31" href="#__codelineno-23-31"></a>        <span class="n">rewards</span><span class="p">[</span><span class="n">episode</span><span class="p">]</span> <span class="o">+=</span> <span class="n">world</span><span class="o">.</span><span class="n">act</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-23-32" name="__codelineno-23-32" href="#__codelineno-23-32"></a>
<a id="__codelineno-23-33" name="__codelineno-23-33" href="#__codelineno-23-33"></a><span class="c1">#    print(actions_model)</span>
<a id="__codelineno-23-34" name="__codelineno-23-34" href="#__codelineno-23-34"></a>
<a id="__codelineno-23-35" name="__codelineno-23-35" href="#__codelineno-23-35"></a>    <span class="n">positions</span> <span class="o">=</span> <span class="n">call_delta</span><span class="p">[:,:</span><span class="n">m</span><span class="p">]</span>
<a id="__codelineno-23-36" name="__codelineno-23-36" href="#__codelineno-23-36"></a>    <span class="n">actions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">call_delta</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_path</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">call_delta</span><span class="p">[:,:</span><span class="n">m</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)))</span>
<a id="__codelineno-23-37" name="__codelineno-23-37" href="#__codelineno-23-37"></a>    <span class="n">payoff</span> <span class="o">=</span> <span class="n">positions</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">stock_price</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">call_price</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">actions</span><span class="o">*</span><span class="n">stock_price</span><span class="p">[:,:</span><span class="n">m</span><span class="p">])</span><span class="o">*</span><span class="mf">0.01</span> 
<a id="__codelineno-23-38" name="__codelineno-23-38" href="#__codelineno-23-38"></a>    <span class="n">payoff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">payoff</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-23-39" name="__codelineno-23-39" href="#__codelineno-23-39"></a>    <span class="n">payoff</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">call_delta</span><span class="p">[:,</span><span class="n">m</span><span class="p">]</span><span class="o">*</span><span class="n">stock_price</span><span class="p">[:,</span><span class="n">m</span><span class="p">])</span><span class="o">*</span><span class="mf">0.01</span>
<a id="__codelineno-23-40" name="__codelineno-23-40" href="#__codelineno-23-40"></a>
<a id="__codelineno-23-41" name="__codelineno-23-41" href="#__codelineno-23-41"></a>    <span class="n">payoff_zero</span> <span class="o">=</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">call_price</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> 
<a id="__codelineno-23-42" name="__codelineno-23-42" href="#__codelineno-23-42"></a>    <span class="n">payoff_zero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">payoff_zero</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-23-43" name="__codelineno-23-43" href="#__codelineno-23-43"></a>
<a id="__codelineno-23-44" name="__codelineno-23-44" href="#__codelineno-23-44"></a>    <span class="n">hedging_cost_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">rewards</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="o">-</span><span class="n">payoff</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="o">-</span><span class="n">payoff_zero</span><span class="o">.</span><span class="n">mean</span><span class="p">()])</span>
<a id="__codelineno-23-45" name="__codelineno-23-45" href="#__codelineno-23-45"></a>    <span class="n">hedging_cost_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rewards</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="n">payoff</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="n">payoff_zero</span><span class="o">.</span><span class="n">std</span><span class="p">()])</span>
<a id="__codelineno-23-46" name="__codelineno-23-46" href="#__codelineno-23-46"></a>    <span class="n">obj_func</span> <span class="o">=</span> <span class="n">hedging_cost_mean</span> <span class="o">+</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">hedging_cost_std</span>
<a id="__codelineno-23-47" name="__codelineno-23-47" href="#__codelineno-23-47"></a>
<a id="__codelineno-23-48" name="__codelineno-23-48" href="#__codelineno-23-48"></a>    <span class="n">method_name</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;DDPG&quot;</span><span class="p">,</span> <span class="s2">&quot;Delta&quot;</span><span class="p">,</span> <span class="s2">&quot;No Hedge&quot;</span><span class="p">]</span>
<a id="__codelineno-23-49" name="__codelineno-23-49" href="#__codelineno-23-49"></a>    <span class="n">hedging_cost_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">rewards</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="o">-</span><span class="n">payoff</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="o">-</span><span class="n">payoff_zero</span><span class="o">.</span><span class="n">mean</span><span class="p">()])</span>
<a id="__codelineno-23-50" name="__codelineno-23-50" href="#__codelineno-23-50"></a>    <span class="n">hedging_cost_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rewards</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="n">payoff</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="n">payoff_zero</span><span class="o">.</span><span class="n">std</span><span class="p">()])</span>
<a id="__codelineno-23-51" name="__codelineno-23-51" href="#__codelineno-23-51"></a>    <span class="n">obj_func</span> <span class="o">=</span> <span class="n">hedging_cost_mean</span> <span class="o">+</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">hedging_cost_std</span>
<a id="__codelineno-23-52" name="__codelineno-23-52" href="#__codelineno-23-52"></a>
<a id="__codelineno-23-53" name="__codelineno-23-53" href="#__codelineno-23-53"></a>    <span class="n">mean_in_price</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">hedging_cost_mean</span> <span class="o">/</span> <span class="n">V0</span>
<a id="__codelineno-23-54" name="__codelineno-23-54" href="#__codelineno-23-54"></a>    <span class="n">std_in_price</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">hedging_cost_std</span> <span class="o">/</span> <span class="n">V0</span>
<a id="__codelineno-23-55" name="__codelineno-23-55" href="#__codelineno-23-55"></a>    <span class="n">obj_func_in_price</span> <span class="o">=</span> <span class="n">mean_in_price</span> <span class="o">+</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">std_in_price</span>
<a id="__codelineno-23-56" name="__codelineno-23-56" href="#__codelineno-23-56"></a>
<a id="__codelineno-23-57" name="__codelineno-23-57" href="#__codelineno-23-57"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="n">method_name</span><span class="p">,</span>
<a id="__codelineno-23-58" name="__codelineno-23-58" href="#__codelineno-23-58"></a>                           <span class="s1">&#39;Mean&#39;</span><span class="p">:</span> <span class="n">hedging_cost_mean</span><span class="p">,</span>
<a id="__codelineno-23-59" name="__codelineno-23-59" href="#__codelineno-23-59"></a>                           <span class="s1">&#39;STD&#39;</span><span class="p">:</span> <span class="n">hedging_cost_std</span><span class="p">,</span> 
<a id="__codelineno-23-60" name="__codelineno-23-60" href="#__codelineno-23-60"></a>                           <span class="s1">&#39;Obj Func&#39;</span><span class="p">:</span> <span class="n">obj_func</span><span class="p">,</span> <span class="c1">#\</span>
<a id="__codelineno-23-61" name="__codelineno-23-61" href="#__codelineno-23-61"></a>                           <span class="s1">&#39;Mean in Option Price(%)&#39;</span><span class="p">:</span> <span class="n">mean_in_price</span><span class="p">,</span> 
<a id="__codelineno-23-62" name="__codelineno-23-62" href="#__codelineno-23-62"></a>                           <span class="s1">&#39;STD in Option Price(%)&#39;</span><span class="p">:</span> <span class="n">std_in_price</span><span class="p">,</span> <span class="c1">#\</span>
<a id="__codelineno-23-63" name="__codelineno-23-63" href="#__codelineno-23-63"></a>                           <span class="s1">&#39;Obj Func in Option Price(%)&#39;</span><span class="p">:</span> <span class="n">obj_func_in_price</span><span class="p">})</span>
<a id="__codelineno-23-64" name="__codelineno-23-64" href="#__codelineno-23-64"></a>
<a id="__codelineno-23-65" name="__codelineno-23-65" href="#__codelineno-23-65"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;----------- DDPG Result: </span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s2"> hedges in </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="mi">12</span><span class="p">)</span><span class="si">}</span><span class="s2"> month. -----------&quot;</span><span class="p">)</span>
<a id="__codelineno-23-66" name="__codelineno-23-66" href="#__codelineno-23-66"></a>
<a id="__codelineno-23-67" name="__codelineno-23-67" href="#__codelineno-23-67"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-23-68" name="__codelineno-23-68" href="#__codelineno-23-68"></a>
<a id="__codelineno-23-69" name="__codelineno-23-69" href="#__codelineno-23-69"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-23-70" name="__codelineno-23-70" href="#__codelineno-23-70"></a>    <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">rewards</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;DDPG&#39;</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stat</span><span class="o">=</span><span class="s1">&#39;density&#39;</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">)</span>
<a id="__codelineno-23-71" name="__codelineno-23-71" href="#__codelineno-23-71"></a>    <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">payoff</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Delta&#39;</span><span class="p">,</span> <span class="n">stat</span><span class="o">=</span><span class="s1">&#39;density&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">)</span>
<a id="__codelineno-23-72" name="__codelineno-23-72" href="#__codelineno-23-72"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<a id="__codelineno-23-73" name="__codelineno-23-73" href="#__codelineno-23-73"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
<a id="__codelineno-23-74" name="__codelineno-23-74" href="#__codelineno-23-74"></a>
<a id="__codelineno-23-75" name="__codelineno-23-75" href="#__codelineno-23-75"></a>    <span class="k">return</span> <span class="n">actor_model</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="c1"># function for plotting optimal policy </span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">mpl_toolkits.mplot3d</span><span class="w"> </span><span class="kn">import</span> <span class="n">Axes3D</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">plotAction</span><span class="p">(</span><span class="n">curr_model</span><span class="p">):</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>    <span class="n">TT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>    <span class="n">SS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>    <span class="n">Y</span><span class="p">,</span> <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">TT</span><span class="p">,</span> <span class="n">SS</span><span class="p">)</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>    <span class="n">Z_DDPG</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">SS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">TT</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>    <span class="c1">#Z_BS = np.zeros((SS.shape[0], TT.shape[0]))</span>
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a>
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">SS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">TT</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a>            <span class="n">BS_model</span> <span class="o">=</span> <span class="n">BSCall</span><span class="p">(</span><span class="n">T</span><span class="o">=</span><span class="n">TT</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">S0</span><span class="o">=</span><span class="n">SS</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a>            <span class="n">Z_DDPG</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">curr_model</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">SS</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">BS_model</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="n">TT</span><span class="p">[</span><span class="n">j</span><span class="p">]]]))</span><span class="o">.</span><span class="n">numpy</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a>            <span class="c1">#Z_BS[i,j] = BS_model[1]</span>
<a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a>
<a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a>    <span class="n">V0</span> <span class="o">=</span> <span class="n">BSCall</span><span class="p">(</span><span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">S0</span><span class="o">=</span><span class="n">S0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a>    <span class="n">BS_action_pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">curr_model</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">S0</span><span class="p">,</span> <span class="n">V0</span><span class="p">,</span> <span class="n">_pos</span><span class="p">,</span> <span class="n">T</span><span class="p">]]))</span><span class="o">.</span><span class="n">numpy</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_pos</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.05</span><span class="p">)]</span>
<a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a>
<a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a>    <span class="c1"># %matplotlib notebook</span>
<a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a>    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>  
<a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a>    <span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
<a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a>    <span class="n">ax3</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z_DDPG</span><span class="p">)</span>
<a id="__codelineno-24-25" name="__codelineno-24-25" href="#__codelineno-24-25"></a>    <span class="c1"># ax3.plot_surface(X,Y,Z_BS)</span>
<a id="__codelineno-24-26" name="__codelineno-24-26" href="#__codelineno-24-26"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Action vs. Stock price &amp; Time to maturity&quot;</span><span class="p">)</span>
<a id="__codelineno-24-27" name="__codelineno-24-27" href="#__codelineno-24-27"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Stock price&quot;</span><span class="p">)</span>
<a id="__codelineno-24-28" name="__codelineno-24-28" href="#__codelineno-24-28"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Time to maturity&quot;</span><span class="p">)</span>
<a id="__codelineno-24-29" name="__codelineno-24-29" href="#__codelineno-24-29"></a>
<a id="__codelineno-24-30" name="__codelineno-24-30" href="#__codelineno-24-30"></a>    <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-24-31" name="__codelineno-24-31" href="#__codelineno-24-31"></a>    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span> <span class="n">BS_action_pos</span><span class="p">)</span>
<a id="__codelineno-24-32" name="__codelineno-24-32" href="#__codelineno-24-32"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Action vs. Position&quot;</span><span class="p">)</span>
<a id="__codelineno-24-33" name="__codelineno-24-33" href="#__codelineno-24-33"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Position&quot;</span><span class="p">)</span>
<a id="__codelineno-24-34" name="__codelineno-24-34" href="#__codelineno-24-34"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
</code></pre></div>
<h2 id="one-month-option-weekly-hedging">One-month option, weekly hedging<a class="headerlink" href="#one-month-option-weekly-hedging" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="o">%%</span><span class="n">time</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="c1"># model paramters</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="n">r</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">S0</span><span class="p">,</span> <span class="n">K</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="c1"># simulation parameters</span>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="c1"># option expires in a month, hedging weekly</span>
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="n">T</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n_path</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5_000</span>
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="n">model_path</span> <span class="o">=</span> <span class="s2">&quot;DDPG/trained_models/1m/weekly&quot;</span>
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>
<a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="c1"># set random seed for reproducing the result</span>
<a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">9999</span><span class="p">)</span>
<a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a>
<a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a><span class="n">weekly</span> <span class="o">=</span> <span class="n">DDPG</span><span class="p">(</span><span class="n">n_path</span><span class="o">=</span><span class="n">n_path</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">S0</span><span class="o">=</span><span class="n">S0</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">model_path</span><span class="o">=</span><span class="n">model_path</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>WARNING:tensorflow:SavedModel saved prior to TF 2.5 detected when loading Keras model. Please ensure that you are saving the model with model.save() or tf.keras.models.save_model(), *NOT* tf.saved_model.save(). To confirm, there should be a file named &quot;keras_metadata.pb&quot; in the SavedModel directory.
0
2000
4000
----------- DDPG Result: 4 hedges in 1 month. -----------
       Name      Mean       STD  Obj Func  Mean in Option Price(%)  \
0      DDPG  1.135190  2.199476  4.434405                49.292360   
1     Delta  1.543443  1.172043  3.301507                67.019524   
2  No Hedge  0.053613  3.528923  5.346998                 2.327991

   STD in Option Price(%)  Obj Func in Option Price(%)  
0               95.505895                   192.551203  
1               50.892563                   143.358369  
2              153.233282                   232.177914
</code></pre></div>
<p><img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-3/black-scholes-1_61_1.png" /></p>
<div class="highlight"><pre><span></span><code>CPU times: user 39.6 s, sys: 474 ms, total: 40.1 s
Wall time: 44.2 s
</code></pre></div>
<h2 id="what-does-the-optimal-action-look-like">What does the optimal action look like?<a class="headerlink" href="#what-does-the-optimal-action-look-like" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="n">plotAction</span><span class="p">(</span><span class="n">weekly</span><span class="p">)</span>
</code></pre></div>
<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-3/black-scholes-1_63_0.png" />
​    </p>
<h2 id="one-month-option-tridaily-hedging">One-month option, tridaily hedging<a class="headerlink" href="#one-month-option-tridaily-hedging" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="o">%%</span><span class="n">time</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="c1"># one month option, tridaily hedging</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="n">T</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="n">model_path</span> <span class="o">=</span> <span class="s2">&quot;DDPG/trained_models/1m/3-day&quot;</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="n">tridaily</span> <span class="o">=</span> <span class="n">DDPG</span><span class="p">(</span><span class="n">n_path</span><span class="o">=</span><span class="n">n_path</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">S0</span><span class="o">=</span><span class="n">S0</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">model_path</span><span class="o">=</span><span class="n">model_path</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>WARNING:tensorflow:SavedModel saved prior to TF 2.5 detected when loading Keras model. Please ensure that you are saving the model with model.save() or tf.keras.models.save_model(), *NOT* tf.saved_model.save(). To confirm, there should be a file named &quot;keras_metadata.pb&quot; in the SavedModel directory.
0
2000
4000
----------- DDPG Result: 10 hedges in 1 month. -----------
       Name      Mean       STD  Obj Func  Mean in Option Price(%)  \
0      DDPG  1.798405  2.092016  4.936429                78.090543   
1     Delta  1.957786  0.940487  3.368517                85.011175   
2  No Hedge  0.017840  3.497339  5.263849                 0.774652

   STD in Option Price(%)  Obj Func in Option Price(%)  
0               90.839720                   214.350123  
1               40.837944                   146.268091  
2              151.861840                   228.567411
</code></pre></div>
<p><img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-3/black-scholes-1_65_1.png" /></p>
<div class="highlight"><pre><span></span><code>CPU times: user 1min 22s, sys: 470 ms, total: 1min 23s
Wall time: 1min 26s
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="c1"># plot tridaily action function </span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="n">plotAction</span><span class="p">(</span><span class="n">tridaily</span><span class="p">)</span>
</code></pre></div>
<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-3/black-scholes-1_66_0.png" />
​    </p>
<h2 id="3-month-option-weekly-hedging">3-month option, weekly hedging<a class="headerlink" href="#3-month-option-weekly-hedging" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="o">%%</span><span class="n">time</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="c1"># 3 months option, weekly hedging</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="n">T</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">3</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="n">model_path</span> <span class="o">=</span> <span class="s2">&quot;DDPG/trained_models/3m/weekly&quot;</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="n">weekly_3m</span> <span class="o">=</span> <span class="n">DDPG</span><span class="p">(</span><span class="n">n_path</span><span class="o">=</span><span class="n">n_path</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">S0</span><span class="o">=</span><span class="n">S0</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">model_path</span><span class="o">=</span><span class="n">model_path</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>WARNING:tensorflow:SavedModel saved prior to TF 2.5 detected when loading Keras model. Please ensure that you are saving the model with model.save() or tf.keras.models.save_model(), *NOT* tf.saved_model.save(). To confirm, there should be a file named &quot;keras_metadata.pb&quot; in the SavedModel directory.
0
2000
4000
----------- DDPG Result: 4 hedges in 3 month. -----------
       Name      Mean       STD  Obj Func  Mean in Option Price(%)  \
0      DDPG  0.857972  3.904092  6.714110                21.515140   
1     Delta  1.474011  1.784586  4.150890                36.963365   
2  No Hedge -0.124989  6.013195  8.894803                -3.134323

   STD in Option Price(%)  Obj Func in Option Price(%)  
0               97.901839                   168.367898  
1               44.751576                   104.090729  
2              150.791253                   223.052557
</code></pre></div>
<p><img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-3/black-scholes-1_68_1.png" /></p>
<div class="highlight"><pre><span></span><code>CPU times: user 34.3 s, sys: 250 ms, total: 34.5 s
Wall time: 36.1 s
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="n">plotAction</span><span class="p">(</span><span class="n">weekly_3m</span><span class="p">)</span>
</code></pre></div>
<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-3/black-scholes-1_69_0.png" />
​    </p>
<h2 id="concluding-remarks-on-deep-hedging">Concluding remarks on deep hedging<a class="headerlink" href="#concluding-remarks-on-deep-hedging" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>Hedging with DDPG Algorithm can reduce the average hedging cost, however, it increases the variance of cost for the Black-Scholes model and probably also for stochastic volatility models.</p>
</li>
<li>
<p>As is mentioned in the original paper, the impact of trading costs (or transaction cost) is to under-hedge relative to delta hedging in some situations and over-hedge in other situations. By hedging short European call option position, we observe under-hedge relative to delta hedging.</p>
</li>
<li>
<p>One may be able to reduce the variance of hedging cost in the DDPG Algorithm by adding more paths for training. In the code, we used 5000 training paths for each model while renewing the model after each episode. However, using too many paths in the training stage may result in overfitting.</p>
</li>
</ul>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="最后更新">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="2025年3月21日 10:33:48 CST">2025年3月21日</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="创建日期">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="2025年3月20日 12:58:20 CST">2025年3月20日</span>
  </span>

    
    
    
  </aside>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2024 - 2025 <a href="https://github.com/Shocked-Pikachu" target="_blank" rel="noopener"> Haoyu Mo</a>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://github.com/Shocked-Pikachu" target="_blank" rel="noopener" title="My Github" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:<mohy@stu.pku.edu.cn>" target="_blank" rel="noopener" title="Send Me An Email" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M64 112c-8.8 0-16 7.2-16 16v22.1l172.5 141.6c20.7 17 50.4 17 71.1 0L464 150.1V128c0-8.8-7.2-16-16-16zM48 212.2V384c0 8.8 7.2 16 16 16h384c8.8 0 16-7.2 16-16V212.2L322 328.8c-38.4 31.5-93.7 31.5-132 0zM0 128c0-35.3 28.7-64 64-64h384c35.3 0 64 28.7 64 64v256c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.indexes", "navigation.tabs", "navigation.top", "toc.follow", "search.suggest", "search.highlight", "search.share", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>