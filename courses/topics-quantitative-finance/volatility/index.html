
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://shocked-pikachu.github.io/moe.site/courses/topics-quantitative-finance/volatility/">
      
      
        <link rel="prev" href="../black-scholes-2/">
      
      
        <link rel="next" href="../variational-control-problems/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Lecture 5 Volatility and Volatility-Linked Derivatives - Moe's Site</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#lecture-5-volatility-and-volatility-linked-derivatives" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="Moe&#39;s Site" class="md-header__button md-logo" aria-label="Moe's Site" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5zM6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Moe's Site
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Lecture 5 Volatility and Volatility-Linked Derivatives
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Shocked-Pikachu/moe.site" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Shocked-Pikachu/moe.site
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  主页

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
    
  
  课程

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../notes/" class="md-tabs__link">
          
  
  
    
  
  笔记

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../about/" class="md-tabs__link">
          
  
  
    
  
  关于

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Moe&#39;s Site" class="md-nav__button md-logo" aria-label="Moe's Site" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5zM6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5"/></svg>

    </a>
    Moe's Site
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Shocked-Pikachu/moe.site" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Shocked-Pikachu/moe.site
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    主页
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    课程
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            课程
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../electrodynamics/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    电动力学
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            电动力学
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../musical-modernism/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    现代主义音乐：挑战与挑衅
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            现代主义音乐：挑战与挑衅
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../modern-physics-lab/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    近代物理实验
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            近代物理实验
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../principles-of-economics/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    经济学原理（I）
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            经济学原理（I）
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles-of-economics/principles-economics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    经济学基本原理
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles-of-economics/gains-from-trade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    双赢的贸易
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles-of-economics/market-forces-supply-demand/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    供需的市场力量
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles-of-economics/elasticity-application/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    弹性及其应用
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles-of-economics/markets-government-policies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    市场与政策
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles-of-economics/market-efficiency/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    市场效率
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles-of-economics/externality-public-goods/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    外部性及公共品
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles-of-economics/consumer-theory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    消费者理论
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles-of-economics/producer-theory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    厂商理论
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles-of-economics/firms-competitive-markets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    竞争市场中的企业
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles-of-economics/monopoly/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    垄断
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles-of-economics/monopolistic-competition-markets-factors-production/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    垄断竞争及生产要素市场
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles-of-economics/oligopoly-game-theory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    寡头与博弈论
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles-of-economics/miscellany-frontiers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    杂及前沿
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../introduction-to-finance/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    金融学概论
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            金融学概论
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/time-value-money/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Allocating Resources Over Time
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/asset-classes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Asset Classes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/trading-margin-short-sale/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Trading, Margin and Short Sale
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/stock-market-indexes-funds/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Stock Market Indexes & Funds
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/historical-returns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Historical Returns on Risky Portfolios
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/introduction-portfolio-choice/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction to Portfolio Choice
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/constructing-portfolios/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Constructing Portfolios
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/optimal-risky-portfolios/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Optimal Risky Portfolios
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/markowitz-portfolio-selection-model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Markowitz Portfolio Selection Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/index-models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Index Models
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/capital-asset-pricing-model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Capital Asset Pricing Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/arbitrage-pricing-theory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Arbitrage Pricing Theory
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/bond-prices-yields/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bond Prices and Yields
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/term-structure-interest-rates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The Term Structure of Interest Rates
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/equity-valuation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Equity Valuation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/option-strategies-put-call-parity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Option Strategies and Put-Call Parity
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/option-pricing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Option Pricing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/futures/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Futures
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/structured-finance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Structured Finance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction-to-finance/financial-fragility/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Financial Fragility
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../financial-accounting/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    财务会计
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            财务会计
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-accounting/lecture-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-accounting/lecture-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-accounting/lecture-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 3
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-accounting/lecture-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 4
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-accounting/lecture-5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 5
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-accounting/lecture-6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 6
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-accounting/lecture-7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 7
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-accounting/lecture-8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 8
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-accounting/lecture-9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 9
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-accounting/lecture-10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 10
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-accounting/lecture-11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 11
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-accounting/lecture-12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 12
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-accounting/lecture-13/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 13
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-accounting/lecture-14/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 14
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_8" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    量化金融专题
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_8">
            <span class="md-nav__icon md-icon"></span>
            量化金融专题
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../financial-engineering-nutshell/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 1 Financial Engineering in a Nutshell
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stochastic-calculus/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 2 Crash Course on Stochastic Calculus
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../black-scholes-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 3 The Black-Merton-Scholes Model and Beyond I
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../black-scholes-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 4 The Black-Merton-Scholes Model and Beyond II
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Lecture 5 Volatility and Volatility-Linked Derivatives
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Lecture 5 Volatility and Volatility-Linked Derivatives
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#agenda" class="md-nav__link">
    <span class="md-ellipsis">
      Agenda
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-is-volatility" class="md-nav__link">
    <span class="md-ellipsis">
      What is volatility?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-is-volatility-important" class="md-nav__link">
    <span class="md-ellipsis">
      Why is volatility important?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#volatilities" class="md-nav__link">
    <span class="md-ellipsis">
      Volatilities
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#historical-volatility" class="md-nav__link">
    <span class="md-ellipsis">
      Historical volatility
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-of-historical-volatility" class="md-nav__link">
    <span class="md-ellipsis">
      Example of historical volatility
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example of historical volatility">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exponetially-weighted-moving-average-ewma" class="md-nav__link">
    <span class="md-ellipsis">
      Exponetially weighted moving average (EWMA)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#now-lets-dirty-our-hands" class="md-nav__link">
    <span class="md-ellipsis">
      Now let's dirty our hands ...
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#volatility-estimation-using-ohlc" class="md-nav__link">
    <span class="md-ellipsis">
      Volatility estimation using OHLC
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implied-volatility" class="md-nav__link">
    <span class="md-ellipsis">
      Implied volatility
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-implied-volatility-rather-than-the-price-itself" class="md-nav__link">
    <span class="md-ellipsis">
      Why implied volatility rather than the price itself?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-practical-tip-for-fetching-risk-free-and-dividend-rates" class="md-nav__link">
    <span class="md-ellipsis">
      A practical tip for fetching risk free and dividend rates
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-implied-volatilities-of-options-on-spx" class="md-nav__link">
    <span class="md-ellipsis">
      Example - Implied volatilities of options on SPX
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example - Implied volatilities of options on SPX">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-python-class-optionanalytics" class="md-nav__link">
    <span class="md-ellipsis">
      Create python class OptionAnalytics
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-shorter-time-to-expiry-option-on-spx" class="md-nav__link">
    <span class="md-ellipsis">
      A shorter time to expiry option on SPX
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gpr-fit-for-spx-implied-volatility-curve" class="md-nav__link">
    <span class="md-ellipsis">
      GPR fit for SPX implied volatility curve
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GPR fit for SPX implied volatility curve">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fine-tune-hyperparameters-by-mle" class="md-nav__link">
    <span class="md-ellipsis">
      Fine tune hyperparameters by MLE
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-is-vix" class="md-nav__link">
    <span class="md-ellipsis">
      What is VIX?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#volatility-indices-published-by-cboe" class="md-nav__link">
    <span class="md-ellipsis">
      Volatility indices published by CBOE
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Volatility indices published by CBOE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note_1" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formula-of-financial-engineering" class="md-nav__link">
    <span class="md-ellipsis">
      "Formula of financial engineering"
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-log-contract" class="md-nav__link">
    <span class="md-ellipsis">
      Example - log contract
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example - log contract">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note_2" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-is-vix-calculated" class="md-nav__link">
    <span class="md-ellipsis">
      How is VIX calculated?
    </span>
  </a>
  
    <nav class="md-nav" aria-label="How is VIX calculated?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#download-vix-data-from-yfinance" class="md-nav__link">
    <span class="md-ellipsis">
      Download VIX data from yfinance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#volatility-derivatives" class="md-nav__link">
    <span class="md-ellipsis">
      Volatility derivatives
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#variance-swap" class="md-nav__link">
    <span class="md-ellipsis">
      Variance swap
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#volatility-swap" class="md-nav__link">
    <span class="md-ellipsis">
      Volatility swap
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calculating-volatility-swap-fair-strike-from-mgf" class="md-nav__link">
    <span class="md-ellipsis">
      Calculating volatility swap fair strike from MGF
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vix-futures" class="md-nav__link">
    <span class="md-ellipsis">
      VIX futures
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vix-option" class="md-nav__link">
    <span class="md-ellipsis">
      VIX option
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-look-at-the-vix-option-chain-from-yahoo-finance" class="md-nav__link">
    <span class="md-ellipsis">
      A look at the VIX option chain from Yahoo Finance
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gpr-fit-for-vix-option-implied-volatility-curve" class="md-nav__link">
    <span class="md-ellipsis">
      GPR fit for VIX option implied volatility curve
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#appendix-optional" class="md-nav__link">
    <span class="md-ellipsis">
      Appendix (Optional)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#volatility-estimation-using-high-frequency-data" class="md-nav__link">
    <span class="md-ellipsis">
      Volatility estimation using high frequency data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#realized-variance" class="md-nav__link">
    <span class="md-ellipsis">
      Realized variance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Realized variance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#technical-notes" class="md-nav__link">
    <span class="md-ellipsis">
      Technical notes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assumption" class="md-nav__link">
    <span class="md-ellipsis">
      Assumption
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integrated-variance-or-quadratic-variation" class="md-nav__link">
    <span class="md-ellipsis">
      Integrated variance or quadratic variation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Integrated variance or quadratic variation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note_3" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#microstructure-noise" class="md-nav__link">
    <span class="md-ellipsis">
      Microstructure noise
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Microstructure noise">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note_4" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asymptotic-result" class="md-nav__link">
    <span class="md-ellipsis">
      Asymptotic result
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Asymptotic result">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note_5" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-conventional-solution" class="md-nav__link">
    <span class="md-ellipsis">
      The conventional solution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subsampling" class="md-nav__link">
    <span class="md-ellipsis">
      Subsampling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#boosting-rv-estimator" class="md-nav__link">
    <span class="md-ellipsis">
      Boosting RV estimator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Boosting RV estimator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note_6" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-zma-estimator" class="md-nav__link">
    <span class="md-ellipsis">
      The ZMA estimator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The ZMA estimator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note_7" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-zhou-estimator" class="md-nav__link">
    <span class="md-ellipsis">
      The Zhou estimator
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#realized-library" class="md-nav__link">
    <span class="md-ellipsis">
      Realized library
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Realized library">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note_8" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spx-realized-variance" class="md-nav__link">
    <span class="md-ellipsis">
      SPX realized variance
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-corsi-har-rv-forecast" class="md-nav__link">
    <span class="md-ellipsis">
      The Corsi HAR-RV forecast
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The Corsi HAR-RV forecast">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note_9" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../variational-control-problems/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 6 Brief Introduction to Variational and Control Problems
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../optimal-execution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 7 Optimal Execution under Price Impact
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_9" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../general-relativity/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    广义相对论
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_9">
            <span class="md-nav__icon md-icon"></span>
            广义相对论
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_10" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../ai-basis/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    人工智能基础
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_10">
            <span class="md-nav__icon md-icon"></span>
            人工智能基础
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_11" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../industrial-organization-theory/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    产业组织理论
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_11" id="__nav_2_11_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_11">
            <span class="md-nav__icon md-icon"></span>
            产业组织理论
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../industrial-organization-theory/introduction-comp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    产业组织简介，完全竞争
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../industrial-organization-theory/monopoly/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    垄断
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../industrial-organization-theory/oligopoly/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    寡头
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../industrial-organization-theory/monocom/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    垄断竞争
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../industrial-organization-theory/price-discrimination/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    非线性定价与区别定价
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../industrial-organization-theory/tie-in-sale/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    捆绑销售
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../industrial-organization-theory/strategic-behavior/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    策略行为
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../industrial-organization-theory/durables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    耐用品
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../industrial-organization-theory/information/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    广告与信息
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../industrial-organization-theory/research-development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    研究与开发
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../industrial-organization-theory/horizontal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    水平合并
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../industrial-organization-theory/vertical/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    垂直合并
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../industrial-organization-theory/international-trade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    国际贸易
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_12" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../baroque-classical-style-music/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    17 与 18 世纪的欧洲艺术音乐：巴洛克与古典风格
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_12" id="__nav_2_12_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_12">
            <span class="md-nav__icon md-icon"></span>
            17 与 18 世纪的欧洲艺术音乐：巴洛克与古典风格
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../baroque-classical-style-music/end-renaissance-concept-baroque/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    “巴洛克”？从⽂艺复兴末期出发
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../baroque-classical-style-music/monteverdi-madrigals-operas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    歌剧的诞⽣：“从蒙特威尔第的牧歌到蒙特威尔第的歌剧”
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../baroque-classical-style-music/spectacle-power-pleasure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    法国抒情悲剧中的权⼒与愉悦：从吕利到拉莫
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../baroque-classical-style-music/baroque-keyboard-tradition/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    法国、意⼤利与北德的键盘音乐：L. 库普兰、弗雷斯科巴尔蒂、扬·皮泰尔索恩·斯韦林克、F. 库普兰、布克斯特胡德
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../baroque-classical-style-music/italian-concerto-style/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    意⼤利协奏曲风格与调性的兴起：科雷利与维瓦尔第
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../baroque-classical-style-music/handel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    亨德尔的意⼤利歌剧、英国神剧与器乐作品
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../baroque-classical-style-music/introduction-bach/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    巴赫的键盘音乐：键盘十二平均律、哥德堡变奏曲
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../baroque-classical-style-music/bach-dance-suite-concertos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    巴赫的协奏曲与组曲
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../baroque-classical-style-music/bach-cantatas-passions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    巴赫的声乐作品：康塔塔与受难曲
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../baroque-classical-style-music/early-classical-styles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    喜歌剧的兴起：佩格莱西与歌剧中的⼆维性格
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../baroque-classical-style-music/emergence-comic-operas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    奏鸣曲式：鍵盤奏鸣曲、早期交响乐与协奏曲
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../baroque-classical-style-music/enlightenment-mozart-operas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    莫扎特的喜歌剧：启蒙主义精神的体现
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../baroque-classical-style-music/haydn/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    有幽默感的海顿：弦乐四重奏与交响乐
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_13" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../financial-statement-analysis/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    财务报表分析
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_13" id="__nav_2_13_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_13">
            <span class="md-nav__icon md-icon"></span>
            财务报表分析
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-statement-analysis/lecture-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-statement-analysis/lecture-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-statement-analysis/lecture-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 3
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-statement-analysis/lecture-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 4
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-statement-analysis/lecture-5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 5
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-statement-analysis/lecture-6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 6
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-statement-analysis/lecture-7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 7
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-statement-analysis/lecture-8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 8
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-statement-analysis/lecture-9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 9
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-statement-analysis/lecture-10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 10
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-statement-analysis/lecture-11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 11
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../financial-statement-analysis/lecture-12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 12
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_14" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../public-finance/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    公共财政学
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_14" id="__nav_2_14_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_14">
            <span class="md-nav__icon md-icon"></span>
            公共财政学
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../public-finance/intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    导言 公共财政的含义
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../public-finance/welfare-economics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    第一章 福利经济学
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../public-finance/market-failure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    第二章 市场失灵
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../public-finance/public-choice/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    第三章 公共选择理论
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../public-finance/cost-benefit-analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    第四章 成本收益分析
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../public-finance/public-expenditure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    第五章 公共支出概论
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../notes/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    笔记
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            笔记
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../notes/tensors-group-theory/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    张量和群论简介
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            张量和群论简介
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2_2" id="__nav_3_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    线性代数和张量
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_2">
            <span class="md-nav__icon md-icon"></span>
            线性代数和张量
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/tensors-group-theory/linear-algebra-tensors/vector-spaces/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    矢量空间
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/tensors-group-theory/linear-algebra-tensors/tensors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    张量
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_3" >
        
          
          <label class="md-nav__link" for="__nav_3_2_3" id="__nav_3_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    群论
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_3">
            <span class="md-nav__icon md-icon"></span>
            群论
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/tensors-group-theory/group-theory/groups-lie-algebras/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    群，李群和李代数
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/tensors-group-theory/group-theory/representation-theory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    群表示论基础
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../about/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    关于
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            关于
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#agenda" class="md-nav__link">
    <span class="md-ellipsis">
      Agenda
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-is-volatility" class="md-nav__link">
    <span class="md-ellipsis">
      What is volatility?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-is-volatility-important" class="md-nav__link">
    <span class="md-ellipsis">
      Why is volatility important?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#volatilities" class="md-nav__link">
    <span class="md-ellipsis">
      Volatilities
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#historical-volatility" class="md-nav__link">
    <span class="md-ellipsis">
      Historical volatility
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-of-historical-volatility" class="md-nav__link">
    <span class="md-ellipsis">
      Example of historical volatility
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example of historical volatility">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exponetially-weighted-moving-average-ewma" class="md-nav__link">
    <span class="md-ellipsis">
      Exponetially weighted moving average (EWMA)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#now-lets-dirty-our-hands" class="md-nav__link">
    <span class="md-ellipsis">
      Now let's dirty our hands ...
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#volatility-estimation-using-ohlc" class="md-nav__link">
    <span class="md-ellipsis">
      Volatility estimation using OHLC
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implied-volatility" class="md-nav__link">
    <span class="md-ellipsis">
      Implied volatility
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-implied-volatility-rather-than-the-price-itself" class="md-nav__link">
    <span class="md-ellipsis">
      Why implied volatility rather than the price itself?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-practical-tip-for-fetching-risk-free-and-dividend-rates" class="md-nav__link">
    <span class="md-ellipsis">
      A practical tip for fetching risk free and dividend rates
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-implied-volatilities-of-options-on-spx" class="md-nav__link">
    <span class="md-ellipsis">
      Example - Implied volatilities of options on SPX
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example - Implied volatilities of options on SPX">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-python-class-optionanalytics" class="md-nav__link">
    <span class="md-ellipsis">
      Create python class OptionAnalytics
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-shorter-time-to-expiry-option-on-spx" class="md-nav__link">
    <span class="md-ellipsis">
      A shorter time to expiry option on SPX
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gpr-fit-for-spx-implied-volatility-curve" class="md-nav__link">
    <span class="md-ellipsis">
      GPR fit for SPX implied volatility curve
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GPR fit for SPX implied volatility curve">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fine-tune-hyperparameters-by-mle" class="md-nav__link">
    <span class="md-ellipsis">
      Fine tune hyperparameters by MLE
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-is-vix" class="md-nav__link">
    <span class="md-ellipsis">
      What is VIX?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#volatility-indices-published-by-cboe" class="md-nav__link">
    <span class="md-ellipsis">
      Volatility indices published by CBOE
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Volatility indices published by CBOE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note_1" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formula-of-financial-engineering" class="md-nav__link">
    <span class="md-ellipsis">
      "Formula of financial engineering"
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-log-contract" class="md-nav__link">
    <span class="md-ellipsis">
      Example - log contract
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example - log contract">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note_2" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-is-vix-calculated" class="md-nav__link">
    <span class="md-ellipsis">
      How is VIX calculated?
    </span>
  </a>
  
    <nav class="md-nav" aria-label="How is VIX calculated?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#download-vix-data-from-yfinance" class="md-nav__link">
    <span class="md-ellipsis">
      Download VIX data from yfinance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#volatility-derivatives" class="md-nav__link">
    <span class="md-ellipsis">
      Volatility derivatives
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#variance-swap" class="md-nav__link">
    <span class="md-ellipsis">
      Variance swap
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#volatility-swap" class="md-nav__link">
    <span class="md-ellipsis">
      Volatility swap
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calculating-volatility-swap-fair-strike-from-mgf" class="md-nav__link">
    <span class="md-ellipsis">
      Calculating volatility swap fair strike from MGF
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vix-futures" class="md-nav__link">
    <span class="md-ellipsis">
      VIX futures
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vix-option" class="md-nav__link">
    <span class="md-ellipsis">
      VIX option
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-look-at-the-vix-option-chain-from-yahoo-finance" class="md-nav__link">
    <span class="md-ellipsis">
      A look at the VIX option chain from Yahoo Finance
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gpr-fit-for-vix-option-implied-volatility-curve" class="md-nav__link">
    <span class="md-ellipsis">
      GPR fit for VIX option implied volatility curve
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#appendix-optional" class="md-nav__link">
    <span class="md-ellipsis">
      Appendix (Optional)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#volatility-estimation-using-high-frequency-data" class="md-nav__link">
    <span class="md-ellipsis">
      Volatility estimation using high frequency data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#realized-variance" class="md-nav__link">
    <span class="md-ellipsis">
      Realized variance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Realized variance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#technical-notes" class="md-nav__link">
    <span class="md-ellipsis">
      Technical notes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assumption" class="md-nav__link">
    <span class="md-ellipsis">
      Assumption
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integrated-variance-or-quadratic-variation" class="md-nav__link">
    <span class="md-ellipsis">
      Integrated variance or quadratic variation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Integrated variance or quadratic variation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note_3" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#microstructure-noise" class="md-nav__link">
    <span class="md-ellipsis">
      Microstructure noise
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Microstructure noise">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note_4" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asymptotic-result" class="md-nav__link">
    <span class="md-ellipsis">
      Asymptotic result
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Asymptotic result">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note_5" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-conventional-solution" class="md-nav__link">
    <span class="md-ellipsis">
      The conventional solution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subsampling" class="md-nav__link">
    <span class="md-ellipsis">
      Subsampling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#boosting-rv-estimator" class="md-nav__link">
    <span class="md-ellipsis">
      Boosting RV estimator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Boosting RV estimator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note_6" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-zma-estimator" class="md-nav__link">
    <span class="md-ellipsis">
      The ZMA estimator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The ZMA estimator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note_7" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-zhou-estimator" class="md-nav__link">
    <span class="md-ellipsis">
      The Zhou estimator
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#realized-library" class="md-nav__link">
    <span class="md-ellipsis">
      Realized library
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Realized library">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note_8" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spx-realized-variance" class="md-nav__link">
    <span class="md-ellipsis">
      SPX realized variance
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-corsi-har-rv-forecast" class="md-nav__link">
    <span class="md-ellipsis">
      The Corsi HAR-RV forecast
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The Corsi HAR-RV forecast">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note_9" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="lecture-5-volatility-and-volatility-linked-derivatives">Lecture 5: Volatility and Volatility-Linked Derivatives<a class="headerlink" href="#lecture-5-volatility-and-volatility-linked-derivatives" title="Permanent link">&para;</a></h1>
<div class="arithmatex">\[
\newcommand{\bea}{\begin{eqnarray}}
\newcommand{\eea}{\end{eqnarray}}
\newcommand{\supp}{\mathrm{supp}}
\newcommand{\F}{\mathcal{F} }
\newcommand{\cF}{\mathcal{F} }
\newcommand{\E}{\mathbb{E} }
\newcommand{\Eof}[1]{\mathbb{E}\left[ #1 \right]}
\newcommand{\Etof}[1]{\mathbb{E}_t\left[ #1 \right]}
\def\Cov{{ \text{Cov} }}
\def\ES{{ \text{ES} }}
\def\Var{{ \text{Var} }}
\def\VaR{{ \text{VaR} }}
\def\sd{{ \text{sd} }}
\def\corr{{ \text{corr} }}
\newcommand{\1}{\mathbf{1} }
\newcommand{\p}{\partial}
\newcommand{\PP}{\mathbb{P} }
\newcommand{\Pof}[1]{\mathbb{P}\left[ #1 \right]}
\newcommand{\QQ}{\mathbb{Q} }
\newcommand{\R}{\mathbb{R} }
\newcommand{\DD}{\mathbb{D} }
\newcommand{\HH}{\mathbb{H} }
\newcommand{\spn}{\mathrm{span} }
\newcommand{\cov}{\mathrm{cov} }
\newcommand{\HS}{\mathcal{L}_{\mathrm{HS}} }
\newcommand{\Hess}{\mathrm{Hess} }
\newcommand{\trace}{\mathrm{trace} }
\newcommand{\LL}{\mathcal{L} }
\newcommand{\s}{\mathcal{S} }
\newcommand{\ee}{\mathcal{E} }
\newcommand{\ff}{\mathcal{F} }
\newcommand{\hh}{\mathcal{H} }
\newcommand{\bb}{\mathcal{B} }
\newcommand{\dd}{\mathcal{D} }
\newcommand{\g}{\mathcal{G} }
\newcommand{\half}{\frac{1}{2} }
\newcommand{\T}{\mathcal{T} }
\newcommand{\bit}{\begin{itemize}}
\newcommand{\eit}{\end{itemize}}
\newcommand{\beq}{\begin{equation}}
\newcommand{\eeq}{\end{equation}}
\newcommand{\tr}{\text{tr}}
\newcommand{\angl}[1]{\langle #1 \rangle}
\]</div>
<center>
<font size=5, color=blue> Tai-Ho Wang (王 太和)</font>
</center>
<center>
<img src="../../../assets/img/topics-quantitative-finance/baruch-logo.jpg" align = "center" width=450>
</center>

<h2 id="agenda">Agenda<a class="headerlink" href="#agenda" title="Permanent link">&para;</a></h2>
<ul>
<li>Volatility and its various estimators<ul>
<li>Historical volatility</li>
<li>Implied volatility</li>
<li>Realized variance</li>
<li>VIX</li>
</ul>
</li>
<li>Implied volatility<ul>
<li>Estimating discount factor and dividend rates by put-call parity</li>
<li>GPR fit of implied volatilities</li>
</ul>
</li>
<li>Volatility indices published by CBOE</li>
<li>
<p>Volatility linked derivatives</p>
<ul>
<li>VIX option</li>
</ul>
</li>
<li>
<p>Appendix (Optional)</p>
<ul>
<li>Realized variance from high frequency data</li>
<li>The Corsi HAR-RV forecast</li>
</ul>
</li>
</ul>
<h2 id="what-is-volatility">What is volatility?<a class="headerlink" href="#what-is-volatility" title="Permanent link">&para;</a></h2>
<p>From the <a href="https://en.wikipedia.org/wiki/Volatility_(finance)">Wikipage</a>:</p>
<blockquote>
<p>In finance, volatility (symbol <span class="arithmatex">\(\sigma\)</span>) is the degree of variation of a trading price series over time as measured by the standard deviation of logarithmic returns.</p>
<ul>
<li>Historic volatility measures a time series of past market prices. </li>
<li>Implied volatility looks forward in time, being derived from the market price of a market-traded derivative (in particular, an option). </li>
<li>Realized variance estimates the integrated variance or quadratic variation by using high frequency data.</li>
</ul>
</blockquote>
<p><em>Volatility is the conditional standard deviation of returns.</em></p>
<h2 id="why-is-volatility-important">Why is volatility important?<a class="headerlink" href="#why-is-volatility-important" title="Permanent link">&para;</a></h2>
<p>From the same <a href="https://en.wikipedia.org/wiki/Volatility_(finance)">Wikipage</a>:</p>
<blockquote>
<p>Investors care about volatility for at least the following reasons:</p>
<ul>
<li>
<p>The wider the swings in an investment's price, the harder emotionally it is to not worry;</p>
</li>
<li>
<p>Price volatility of a trading instrument can define position sizing in a portfolio;</p>
</li>
<li>
<p>When certain cash flows from selling a security are needed at a specific future date, higher volatility means a greater chance of a shortfall;</p>
</li>
<li>
<p>Higher volatility of returns while saving for retirement results in a wider distribution of possible final portfolio values;</p>
</li>
<li>
<p>Higher volatility of return when retired gives withdrawals a larger permanent impact on the portfolio's value;</p>
</li>
<li>
<p>Price volatility presents opportunities to buy assets cheaply and sell when overpriced;</p>
</li>
<li>
<p><font color=blue> Portfolio volatility has a negative impact on the compound annual growth rate (CAGR) of that portfolio </font></p>
</li>
<li>
<p>Volatility affects pricing of options, being a parameter of the Black–Scholes model.
</p>
</li>
</ul>
</blockquote>
<p>In today's markets, it is also possible to trade volatility directly, through the use of derivative securities such as options and variance swaps. </p>
<h2 id="volatilities">Volatilities<a class="headerlink" href="#volatilities" title="Permanent link">&para;</a></h2>
<p>Volatiltiy of a financial asset in its most prelimanry form is defined as the (conditional) standard deviation of its log return. In practice, there exist various notions of "volatility" that are commonly used including  </p>
<ul>
<li>Historical volatility</li>
<li>Realized and integrated variance/volatility</li>
<li>Implied volatility </li>
<li>Instantaneous volatility </li>
</ul>
<p>and methods of inferring these volatilities respectively from</p>
<ul>
<li>Daily or high-frequency time series data of the underlying</li>
<li>Price series of variance swap</li>
<li>Prices of liquidly traded vanilla options</li>
</ul>
<h2 id="historical-volatility">Historical volatility<a class="headerlink" href="#historical-volatility" title="Permanent link">&para;</a></h2>
<p>Historical volatility uses, say daily, price series to calculate the sample conditional standard deviation of log returns in rolling time windows of a prespecified width.  </p>
<h2 id="example-of-historical-volatility">Example of historical volatility<a class="headerlink" href="#example-of-historical-volatility" title="Permanent link">&para;</a></h2>
<p>Now let's calculate the volatility of S&amp;P500 using 25-day rolling time windows. </p>
<p>One can calculate the volatiltiy series of the input price series <span class="arithmatex">\(S_t\)</span>, <span class="arithmatex">\(1 \leq t \leq T\)</span>, by the following formula</p>
<div class="arithmatex">\[
\sigma_t = \sqrt{\frac N{n-2}\sum_{i=1}^{n-1} (r_i - \bar r)^2}, \quad \text{ for } n \leq t \leq T,
\]</div>
<p>where </p>
<div class="arithmatex">\[
\begin{aligned}
r_i &amp;= \ln S_{t + i} - \ln S_{t + i - 1}, \quad \text{for } 1 \leq i \leq n - 1, \\
\bar{r} &amp;= \frac{1}{n-1} \sum_{i=1}^{n-1} r_i.
\end{aligned}
\]</div>
<h3 id="note">Note<a class="headerlink" href="#note" title="Permanent link">&para;</a></h3>
<ul>
<li><span class="arithmatex">\(n\)</span> denotes the width (number of days) of rolling window</li>
<li><span class="arithmatex">\(N\)</span> denotes the number of days in a year, thus <span class="arithmatex">\(\sqrt N\)</span> is the annualizing factor</li>
<li>The first <span class="arithmatex">\(n-1\)</span> points in the output volatility series appear as NA, for an obvious reason.</li>
</ul>
<h3 id="exponetially-weighted-moving-average-ewma">Exponetially weighted moving average (EWMA)<a class="headerlink" href="#exponetially-weighted-moving-average-ewma" title="Permanent link">&para;</a></h3>
<p>An alternative to calculate historical volatility is the <em>exponentially weighted moving average</em> method. </p>
<div class="arithmatex">\[
\sigma_t = \sqrt{N(1 - \lambda)\sum_{i=1}^{\infty} \lambda^i (r_{t - i} - \bar r)^2}, \quad \text{ for } n \leq t \leq T,
\]</div>
<p>for some <span class="arithmatex">\(\lambda \in (0, 1)\)</span>.</p>
<h2 id="now-lets-dirty-our-hands">Now let's dirty our hands ...<a class="headerlink" href="#now-lets-dirty-our-hands" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1"># pip install yfinance</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">yfinance</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">yf</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">exp</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">sqrt</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ss</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">norm</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">yfinance</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">yf</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">statsmodels.formula.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sm</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="s1">&#39;2019-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2024-07-24&#39;</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="c1"># download SPX from yahoo finance</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="n">spx</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s2">&quot;^GSPC&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>[*********************100%%**********************]  1 of 1 completed
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># brief look at the data</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="n">spx</span><span class="o">.</span><span class="n">info</span><span class="p">(),</span> <span class="n">spx</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
DatetimeIndex: 1398 entries, 2019-01-02 to 2024-07-23
Data columns (total 6 columns):
 #   Column     Non-Null Count  Dtype  
---  ------     --------------  -----  
 0   Open       1398 non-null   float64
 1   High       1398 non-null   float64
 2   Low        1398 non-null   float64
 3   Close      1398 non-null   float64
 4   Adj Close  1398 non-null   float64
 5   Volume     1398 non-null   int64  
dtypes: float64(5), int64(1)
memory usage: 76.5 KB





(None,
 Open         0
 High         0
 Low          0
 Close        0
 Adj Close    0
 Volume       0
 dtype: int64)
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c1"># first and last few rows of the data</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="n">spx</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div style="overflow-x: auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Open</th>
      <th>High</th>
      <th>Low</th>
      <th>Close</th>
      <th>Adj Close</th>
      <th>Volume</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2019-01-02</th>
      <td>2476.959961</td>
      <td>2519.489990</td>
      <td>2467.469971</td>
      <td>2510.030029</td>
      <td>2510.030029</td>
      <td>3733160000</td>
    </tr>
    <tr>
      <th>2019-01-03</th>
      <td>2491.919922</td>
      <td>2493.139893</td>
      <td>2443.959961</td>
      <td>2447.889893</td>
      <td>2447.889893</td>
      <td>3858830000</td>
    </tr>
    <tr>
      <th>2019-01-04</th>
      <td>2474.330078</td>
      <td>2538.070068</td>
      <td>2474.330078</td>
      <td>2531.939941</td>
      <td>2531.939941</td>
      <td>4234140000</td>
    </tr>
    <tr>
      <th>2019-01-07</th>
      <td>2535.610107</td>
      <td>2566.159912</td>
      <td>2524.560059</td>
      <td>2549.689941</td>
      <td>2549.689941</td>
      <td>4133120000</td>
    </tr>
    <tr>
      <th>2019-01-08</th>
      <td>2568.110107</td>
      <td>2579.820068</td>
      <td>2547.560059</td>
      <td>2574.409912</td>
      <td>2574.409912</td>
      <td>4120060000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2024-07-17</th>
      <td>5610.069824</td>
      <td>5622.490234</td>
      <td>5584.810059</td>
      <td>5588.270020</td>
      <td>5588.270020</td>
      <td>4246450000</td>
    </tr>
    <tr>
      <th>2024-07-18</th>
      <td>5608.560059</td>
      <td>5614.049805</td>
      <td>5522.810059</td>
      <td>5544.589844</td>
      <td>5544.589844</td>
      <td>4007510000</td>
    </tr>
    <tr>
      <th>2024-07-19</th>
      <td>5543.370117</td>
      <td>5557.500000</td>
      <td>5497.040039</td>
      <td>5505.000000</td>
      <td>5505.000000</td>
      <td>3760570000</td>
    </tr>
    <tr>
      <th>2024-07-22</th>
      <td>5544.540039</td>
      <td>5570.359863</td>
      <td>5529.040039</td>
      <td>5564.410156</td>
      <td>5564.410156</td>
      <td>3375180000</td>
    </tr>
    <tr>
      <th>2024-07-23</th>
      <td>5565.299805</td>
      <td>5585.339844</td>
      <td>5550.899902</td>
      <td>5555.740234</td>
      <td>5555.740234</td>
      <td>3500210000</td>
    </tr>
  </tbody>
</table>
<p>1398 rows × 6 columns</p>
</div>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1"># save data, just in case</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="c1"># spx.to_csv(&#39;spx_07252022.csv&#39;)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1"># load saved data</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="c1"># spx = pd.read_csv(&#39;spx_07252022.csv&#39;)</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="n">spx</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">spx</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="n">spx</span> <span class="o">=</span> <span class="n">spx</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>---------------------------------------------------------------------------

KeyError                                  Traceback (most recent call last)

File ~/miniconda3/envs/main/lib/python3.10/site-packages/pandas/core/indexes/base.py:3803, in Index.get_loc(self, key, method, tolerance)
   3802 try:
-&gt; 3803     return self._engine.get_loc(casted_key)
   3804 except KeyError as err:


File ~/miniconda3/envs/main/lib/python3.10/site-packages/pandas/_libs/index.pyx:138, in pandas._libs.index.IndexEngine.get_loc()


File ~/miniconda3/envs/main/lib/python3.10/site-packages/pandas/_libs/index.pyx:165, in pandas._libs.index.IndexEngine.get_loc()


File pandas/_libs/hashtable_class_helper.pxi:5745, in pandas._libs.hashtable.PyObjectHashTable.get_item()


File pandas/_libs/hashtable_class_helper.pxi:5753, in pandas._libs.hashtable.PyObjectHashTable.get_item()


KeyError: &#39;Date&#39;
</code></pre></div>
<p>​  <br />
​    The above exception was the direct cause of the following exception:</p>
<div class="highlight"><pre><span></span><code>KeyError                                  Traceback (most recent call last)

Cell In[38], line 3
      1 # load saved data
      2 # spx = pd.read_csv(&#39;spx_07252022.csv&#39;)
----&gt; 3 spx.index = spx[&#39;Date&#39;]
      4 spx = spx.drop(&#39;Date&#39;, axis=1)


File ~/miniconda3/envs/main/lib/python3.10/site-packages/pandas/core/frame.py:3805, in DataFrame.__getitem__(self, key)
   3803 if self.columns.nlevels &gt; 1:
   3804     return self._getitem_multilevel(key)
-&gt; 3805 indexer = self.columns.get_loc(key)
   3806 if is_integer(indexer):
   3807     indexer = [indexer]


File ~/miniconda3/envs/main/lib/python3.10/site-packages/pandas/core/indexes/base.py:3805, in Index.get_loc(self, key, method, tolerance)
   3803     return self._engine.get_loc(casted_key)
   3804 except KeyError as err:
-&gt; 3805     raise KeyError(key) from err
   3806 except TypeError:
   3807     # If we have a listlike key, _check_indexing_error will raise
   3808     #  InvalidIndexError. Otherwise we fall through and re-raise
   3809     #  the TypeError.
   3810     self._check_indexing_error(key)


KeyError: &#39;Date&#39;
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1"># summary statistics</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="n">spx</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div style="overflow-x: auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Open</th>
      <td>1398.0</td>
      <td>3.896690e+03</td>
      <td>7.404446e+02</td>
      <td>2.290710e+03</td>
      <td>3.224580e+03</td>
      <td>3.977770e+03</td>
      <td>4.425177e+03</td>
      <td>5.644090e+03</td>
    </tr>
    <tr>
      <th>High</th>
      <td>1398.0</td>
      <td>3.919275e+03</td>
      <td>7.414695e+02</td>
      <td>2.300730e+03</td>
      <td>3.238730e+03</td>
      <td>4.009790e+03</td>
      <td>4.449748e+03</td>
      <td>5.669670e+03</td>
    </tr>
    <tr>
      <th>Low</th>
      <td>1398.0</td>
      <td>3.872932e+03</td>
      <td>7.396645e+02</td>
      <td>2.191860e+03</td>
      <td>3.212585e+03</td>
      <td>3.948365e+03</td>
      <td>4.401092e+03</td>
      <td>5.639020e+03</td>
    </tr>
    <tr>
      <th>Close</th>
      <td>1398.0</td>
      <td>3.897745e+03</td>
      <td>7.405478e+02</td>
      <td>2.237400e+03</td>
      <td>3.224927e+03</td>
      <td>3.979300e+03</td>
      <td>4.425167e+03</td>
      <td>5.667200e+03</td>
    </tr>
    <tr>
      <th>Adj Close</th>
      <td>1398.0</td>
      <td>3.897745e+03</td>
      <td>7.405478e+02</td>
      <td>2.237400e+03</td>
      <td>3.224927e+03</td>
      <td>3.979300e+03</td>
      <td>4.425167e+03</td>
      <td>5.667200e+03</td>
    </tr>
    <tr>
      <th>Volume</th>
      <td>1398.0</td>
      <td>4.269485e+09</td>
      <td>1.036368e+09</td>
      <td>1.296530e+09</td>
      <td>3.653008e+09</td>
      <td>4.013980e+09</td>
      <td>4.621978e+09</td>
      <td>9.976520e+09</td>
    </tr>
  </tbody>
</table>
</div>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1"># plot spx adjusted close</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="n">spx</span><span class="p">[</span><span class="s1">&#39;Adj Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;SPX&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">();</span>
</code></pre></div>
<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-5/volatility_17_0.png" />
​    </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1"># log return of spx </span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="n">r</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">spx</span><span class="p">[</span><span class="s1">&#39;Adj Close&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="c1"># historical volatility in this period</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="n">vol</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">252</span><span class="p">)</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="n">r</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">vol</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>(Date
 2019-01-02         NaN
 2019-01-03   -0.025068
 2019-01-04    0.033759
 2019-01-07    0.006986
 2019-01-08    0.009649
                 ...   
 2024-07-17   -0.014025
 2024-07-18   -0.007847
 2024-07-19   -0.007166
 2024-07-22    0.010734
 2024-07-23   -0.001559
 Name: Adj Close, Length: 1398, dtype: float64,
 0.000568745134424835,
 0.20594574559648623,
 pandas.core.series.Series)
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1"># plot log return</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="n">r</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;SPX log return&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">();</span>
</code></pre></div>
<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-5/volatility_19_0.png" />
​    </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">r</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">],</span> <span class="n">r</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>(Date
 2019-01-02         NaN
 2019-01-03   -0.025068
 2019-01-04    0.033759
 2019-01-07    0.006986
 2019-01-08    0.009649
 2019-01-09    0.004090
 2019-01-10    0.004508
 2019-01-11   -0.000146
 2019-01-14   -0.005271
 2019-01-15    0.010665
 Name: Adj Close, dtype: float64,
 Date
 2024-07-10    0.010156
 2024-07-11   -0.008802
 2024-07-12    0.005502
 2024-07-15    0.002822
 2024-07-16    0.006369
 2024-07-17   -0.014025
 2024-07-18   -0.007847
 2024-07-19   -0.007166
 2024-07-22    0.010734
 2024-07-23   -0.001559
 Name: Adj Close, dtype: float64)
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c1"># n: rwidth of rolling window</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="c1"># N: annualizing factor</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="k">def</span><span class="w"> </span><span class="nf">volatility</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">252</span><span class="p">):</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>    <span class="n">vol</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">-</span><span class="n">n</span><span class="p">):</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>        <span class="n">vol</span> <span class="o">+=</span> <span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">:(</span><span class="n">i</span><span class="o">+</span><span class="n">n</span><span class="p">)]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;volatility&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="p">})</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">volatility</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div style="overflow-x: auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>volatility</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>1393</th>
      <td>0.081197</td>
    </tr>
    <tr>
      <th>1394</th>
      <td>0.117438</td>
    </tr>
    <tr>
      <th>1395</th>
      <td>0.123942</td>
    </tr>
    <tr>
      <th>1396</th>
      <td>0.124998</td>
    </tr>
    <tr>
      <th>1397</th>
      <td>0.138452</td>
    </tr>
  </tbody>
</table>
<p>1398 rows × 1 columns</p>
</div>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="n">spx_vol</span> <span class="o">=</span> <span class="n">volatility</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="n">spx_vol</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">index</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spx_vol</span><span class="p">)</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Volatility&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;SPX historical volatility&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">();</span>
</code></pre></div>
<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-5/volatility_23_0.png" />
​    </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c1"># leverage effect</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="n">spx_scaled</span> <span class="o">=</span> <span class="p">(</span><span class="n">spx</span> <span class="o">-</span> <span class="n">spx</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="n">spx</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">spx</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="n">spx_scaled</span><span class="p">[</span><span class="s1">&#39;Adj Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;scaled spx&#39;</span><span class="p">)</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.6</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spx_vol</span><span class="p">,</span> <span class="s1">&#39;b-.&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;volatility&#39;</span><span class="p">)</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Leverage effect&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</code></pre></div>
<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-5/volatility_24_0.png" />
​    </p>
<h2 id="volatility-estimation-using-ohlc">Volatility estimation using OHLC<a class="headerlink" href="#volatility-estimation-using-ohlc" title="Permanent link">&para;</a></h2>
<ul>
<li>Parkison</li>
<li>Garman-Klass</li>
<li>Rogers-Satchell</li>
<li>Yang-Zhang</li>
</ul>
<div class="arithmatex">\[
\begin{aligned}
\sigma_P^2 &amp;= \frac{1}{4\ln2} \frac{1}{n}\sum_{i=1}^n (\ln H_i - \ln L_i)^2, \\
\sigma_{GK}^2 &amp;= \frac{1}{n} \left\{\sum_{i=1}^n \frac{1}{2}(\ln H_i - \ln L_i)^2 + (2\ln2 - 1)(\ln C_i - \ln O_i)^2 \right\}, \\
\sigma_{RS}^2 &amp;= \frac{1}{n} \sum_{i=1}^n u_i(u_i - c_i) + d_i(d_i - c_i), \\
\sigma_{YZ}^2 &amp;= \sigma_O^2 + w\sigma_C^2 + (1 - w)\sigma_P^2, \quad w = \frac{0.34}{1.34 + \frac{n+1}{n-1}}.
\end{aligned}
\]</div>
<ul>
<li><span class="arithmatex">\(u_i = \ln H_i - \ln O_i\)</span>: daily high weighted by open, </li>
<li><span class="arithmatex">\(d_i = \ln L_i - \ln O_i\)</span>: daily low weighted by open</li>
<li><span class="arithmatex">\(o_i = \ln O_i - \ln C_{i-1}\)</span></li>
<li><span class="arithmatex">\(c_i = \ln C_i - \ln O_i\)</span></li>
</ul>
<p>We make the calculation of these volatilties into a python <code>class</code>. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Volatilities</span><span class="p">:</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">OHLC</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">252</span><span class="p">):</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="n">N</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">OHLC</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">OHLC</span><span class="p">)</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">OHLC</span><span class="o">.</span><span class="n">Open</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">OHLC</span><span class="o">.</span><span class="n">High</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">OHLC</span><span class="o">.</span><span class="n">Low</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">OHLC</span><span class="o">.</span><span class="n">Close</span>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">OHLC</span><span class="p">[</span><span class="s1">&#39;Adj Close&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vols_c</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)]</span> 
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vols_p</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)]</span>
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vols_gk</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)]</span> 
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vols_rs</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)]</span> 
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a>
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
<a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols_c</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">:(</span><span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
<a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols_p</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cal_vol_p</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">:(</span><span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)],</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">:(</span><span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)])</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
<a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols_gk</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cal_vol_gk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">:(</span><span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)],</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">:(</span><span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)],</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">:(</span><span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)],</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">:(</span><span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)])</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
<a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols_rs</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cal_vol_rs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">:(</span><span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)],</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">:(</span><span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)],</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">:(</span><span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)],</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">:(</span><span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)])</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
<a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vols</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;close&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">vols_c</span><span class="p">,</span> <span class="s1">&#39;parkinson&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">vols_p</span><span class="p">,</span> <span class="s1">&#39;garman-klass&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">vols_gk</span><span class="p">,</span> <span class="s1">&#39;rogers-satchell&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">vols_rs</span><span class="p">})</span>
<a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">OHLC</span><span class="o">.</span><span class="n">index</span>
<a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a>
<a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cal_vol_p</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">L</span><span class="p">):</span>
<a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">log</span><span class="p">(</span><span class="n">H</span><span class="p">)</span> <span class="o">-</span> <span class="n">log</span><span class="p">(</span><span class="n">L</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">/</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a>
<a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cal_vol_gk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">C</span><span class="p">):</span>
<a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a>        <span class="n">term1</span> <span class="o">=</span> <span class="p">((</span><span class="n">log</span><span class="p">(</span><span class="n">O</span><span class="p">)</span> <span class="o">-</span> <span class="n">log</span><span class="p">(</span><span class="n">L</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span>
<a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a>        <span class="n">term2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="n">log</span><span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="o">-</span> <span class="n">log</span><span class="p">(</span><span class="n">O</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">term1</span> <span class="o">+</span> <span class="n">term2</span><span class="p">)</span>
<a id="__codelineno-17-31" name="__codelineno-17-31" href="#__codelineno-17-31"></a>
<a id="__codelineno-17-32" name="__codelineno-17-32" href="#__codelineno-17-32"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cal_vol_rs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">C</span><span class="p">):</span>
<a id="__codelineno-17-33" name="__codelineno-17-33" href="#__codelineno-17-33"></a>        <span class="n">u</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">H</span><span class="p">)</span> <span class="o">-</span> <span class="n">log</span><span class="p">(</span><span class="n">O</span><span class="p">),</span> <span class="n">log</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="o">-</span> <span class="n">log</span><span class="p">(</span><span class="n">O</span><span class="p">),</span> <span class="n">log</span><span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="o">-</span> <span class="n">log</span><span class="p">(</span><span class="n">O</span><span class="p">)</span>
<a id="__codelineno-17-34" name="__codelineno-17-34" href="#__codelineno-17-34"></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">u</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">-</span><span class="n">c</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="n">d</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="o">-</span><span class="n">c</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="o">%%</span><span class="n">time</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="n">spx_vols</span> <span class="o">=</span> <span class="n">Volatilities</span><span class="p">(</span><span class="n">spx</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>CPU times: user 1.29 s, sys: 8.23 ms, total: 1.3 s
Wall time: 1.3 s
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="n">spx_vols</span><span class="o">.</span><span class="n">vols</span><span class="p">[</span><span class="s1">&#39;garman-klass&#39;</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Date
2019-01-02         NaN
2019-01-03         NaN
2019-01-04         NaN
2019-01-07         NaN
2019-01-08         NaN
                ...   
2024-07-17    0.068756
2024-07-18    0.066384
2024-07-19    0.091649
2024-07-22    0.097313
2024-07-23    0.098237
Name: garman-klass, Length: 1398, dtype: float64
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="n">spx_vols</span><span class="o">.</span><span class="n">vols</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Close&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="n">spx_vols</span><span class="o">.</span><span class="n">vols</span><span class="p">[</span><span class="s1">&#39;parkinson&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Parkinson&#39;</span><span class="p">)</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="n">spx_vols</span><span class="o">.</span><span class="n">vols</span><span class="p">[</span><span class="s1">&#39;garman-klass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Garman-Klass&#39;</span><span class="p">)</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="n">spx_vols</span><span class="o">.</span><span class="n">vols</span><span class="p">[</span><span class="s1">&#39;rogers-satchell&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Rogers-Satchell&#39;</span><span class="p">)</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">();</span>
</code></pre></div>
<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-5/volatility_30_0.png" />
​    </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="n">spx</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div style="overflow-x: auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Open</th>
      <th>High</th>
      <th>Low</th>
      <th>Close</th>
      <th>Adj Close</th>
      <th>Volume</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2024-07-23</th>
      <td>5565.299805</td>
      <td>5585.339844</td>
      <td>5550.899902</td>
      <td>5555.740234</td>
      <td>5555.740234</td>
      <td>3500210000</td>
    </tr>
  </tbody>
</table>
</div>
</div>

<h2 id="implied-volatility">Implied volatility<a class="headerlink" href="#implied-volatility" title="Permanent link">&para;</a></h2>
<p>"A wrong number to a wrong formula for a correct answer."</p>
<ul>
<li>
<p>In the Black-Scholes model there is a one-to-one relation between the price of the option and the volatility parameter <span class="arithmatex">\(\sigma\)</span>. The option prices are often quoted by stating this specific volatility, called the <em>implied volatility</em>.</p>
</li>
<li>
<p>In Black-Scholes world, the volatility is assumed constant. But in reality, options of different strike require different volatilities to match their market prices. This is called the <em>volatility smile</em>.</p>
</li>
<li>
<p>Most of the work was inspired in modeling the implied volatility.</p>
</li>
</ul>
<h2 id="why-implied-volatility-rather-than-the-price-itself">Why implied volatility rather than the price itself?<a class="headerlink" href="#why-implied-volatility-rather-than-the-price-itself" title="Permanent link">&para;</a></h2>
<ul>
<li>Price of a call option is decreasing in strike and increasing in time to expiry</li>
<li>Price of a far out-of-money option is small whereas price of a far in-the-money option carries mostly the intrinsic value</li>
<li>Statistically speaking, implied volatility is a more standard quantity to infer</li>
<li>Traders trade options in terms of implied volatilities rather than their prices</li>
</ul>
<h2 id="a-practical-tip-for-fetching-risk-free-and-dividend-rates">A practical tip for fetching risk free and dividend rates<a class="headerlink" href="#a-practical-tip-for-fetching-risk-free-and-dividend-rates" title="Permanent link">&para;</a></h2>
<p>Q: How to obtain the interest rate <span class="arithmatex">\(r\)</span> and dividend rate <span class="arithmatex">\(d\)</span> for the calculation of implied volatility?</p>
<p>A: Put-call parity.</p>
<p>Recall the Put-Call Parity for European options</p>
<div class="arithmatex">\[
C - P = Se^{-dT}  - K e^{-rT} = e^{-rT} (F - K),
\]</div>
<p>where <span class="arithmatex">\(F\)</span> denotes the forward price of the underlying. 
Hence, if we regress <span class="arithmatex">\(C - P\)</span> against <span class="arithmatex">\(K\)</span>, the (negative) slope gives us the discount factor and the intercept gives the ex-dividend underlying.  </p>
<h2 id="example-implied-volatilities-of-options-on-spx">Example - Implied volatilities of options on SPX<a class="headerlink" href="#example-implied-volatilities-of-options-on-spx" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="c1"># import required modules</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span> <span class="k">as</span> <span class="n">dt</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">exp</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">sqrt</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ss</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">norm</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">yfinance</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">yf</span>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">statsmodels.formula.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sm</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="c1"># download spx options data from yahoo finance</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="n">spx</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">Ticker</span><span class="p">(</span><span class="s1">&#39;^SPX&#39;</span><span class="p">)</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="n">spx_expiries</span> <span class="o">=</span> <span class="n">spx</span><span class="o">.</span><span class="n">options</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="nb">print</span><span class="p">(</span><span class="n">spx_expiries</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>(&#39;2024-07-30&#39;, &#39;2024-07-31&#39;, &#39;2024-08-01&#39;, &#39;2024-08-02&#39;, &#39;2024-08-05&#39;, &#39;2024-08-06&#39;, &#39;2024-08-07&#39;, &#39;2024-08-08&#39;, &#39;2024-08-09&#39;, &#39;2024-08-12&#39;, &#39;2024-08-13&#39;, &#39;2024-08-14&#39;, &#39;2024-08-15&#39;, &#39;2024-08-16&#39;, &#39;2024-08-19&#39;, &#39;2024-08-20&#39;, &#39;2024-08-21&#39;, &#39;2024-08-22&#39;, &#39;2024-08-23&#39;, &#39;2024-08-26&#39;, &#39;2024-08-27&#39;, &#39;2024-08-28&#39;, &#39;2024-08-29&#39;, &#39;2024-08-30&#39;, &#39;2024-09-03&#39;, &#39;2024-09-06&#39;, &#39;2024-09-09&#39;, &#39;2024-09-13&#39;, &#39;2024-09-20&#39;, &#39;2024-09-30&#39;, &#39;2024-10-18&#39;, &#39;2024-10-31&#39;, &#39;2024-11-15&#39;, &#39;2024-11-29&#39;, &#39;2024-12-20&#39;, &#39;2024-12-31&#39;, &#39;2025-01-17&#39;, &#39;2025-02-21&#39;, &#39;2025-03-21&#39;, &#39;2025-03-31&#39;, &#39;2025-04-17&#39;, &#39;2025-05-16&#39;, &#39;2025-06-20&#39;, &#39;2025-06-30&#39;, &#39;2025-07-18&#39;, &#39;2025-08-15&#39;, &#39;2025-09-19&#39;, &#39;2025-12-19&#39;, &#39;2026-01-16&#39;, &#39;2026-03-20&#39;, &#39;2026-06-18&#39;, &#39;2026-12-18&#39;, &#39;2027-12-17&#39;, &#39;2028-12-15&#39;, &#39;2029-12-21&#39;)
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="c1"># choose an expiry </span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="n">idx</span> <span class="o">=</span> <span class="mi">17</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="n">today</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="n">day_count</span> <span class="o">=</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">spx_expiries</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">())</span><span class="o">.</span><span class="n">days</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;option expiry = </span><span class="si">{</span><span class="n">spx_expiries</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="si">}</span><span class="s1">, today = </span><span class="si">{</span><span class="n">today</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;There are </span><span class="si">{</span><span class="n">day_count</span><span class="si">}</span><span class="s1"> days to expiry&#39;</span><span class="p">)</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="n">option_chain</span> <span class="o">=</span> <span class="n">spx</span><span class="o">.</span><span class="n">option_chain</span><span class="p">(</span><span class="n">spx_expiries</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="n">spx_calls</span> <span class="o">=</span> <span class="n">option_chain</span><span class="o">.</span><span class="n">calls</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="n">spx_puts</span> <span class="o">=</span> <span class="n">option_chain</span><span class="o">.</span><span class="n">puts</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>option expiry = 2024-08-22, today = 2024-07-30
There are 22 days to expiry
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="n">spx_calls</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">spx_puts</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>((48, 14), (72, 14))
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="n">spx_calls</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 48 entries, 0 to 47
Data columns (total 14 columns):
 #   Column             Non-Null Count  Dtype              
---  ------             --------------  -----              
 0   contractSymbol     48 non-null     object             
 1   lastTradeDate      48 non-null     datetime64[ns, UTC]
 2   strike             48 non-null     float64            
 3   lastPrice          48 non-null     float64            
 4   bid                48 non-null     float64            
 5   ask                48 non-null     float64            
 6   change             48 non-null     float64            
 7   percentChange      48 non-null     float64            
 8   volume             45 non-null     float64            
 9   openInterest       48 non-null     int64              
 10  impliedVolatility  48 non-null     float64            
 11  inTheMoney         48 non-null     bool               
 12  contractSize       48 non-null     object             
 13  currency           48 non-null     object             
dtypes: bool(1), datetime64[ns, UTC](1), float64(8), int64(1), object(3)
memory usage: 5.0+ KB
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="n">spx_calls</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>contractSymbol       0
lastTradeDate        0
strike               0
lastPrice            0
bid                  0
ask                  0
change               0
percentChange        0
volume               3
openInterest         0
impliedVolatility    0
inTheMoney           0
contractSize         0
currency             0
dtype: int64
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="n">spx_puts</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>contractSymbol       0
lastTradeDate        0
strike               0
lastPrice            0
bid                  0
ask                  0
change               0
percentChange        0
volume               7
openInterest         0
impliedVolatility    0
inTheMoney           0
contractSize         0
currency             0
dtype: int64
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="n">spx_calls</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div style="overflow-x: auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>contractSymbol</th>
      <th>lastTradeDate</th>
      <th>strike</th>
      <th>lastPrice</th>
      <th>bid</th>
      <th>ask</th>
      <th>change</th>
      <th>percentChange</th>
      <th>volume</th>
      <th>openInterest</th>
      <th>impliedVolatility</th>
      <th>inTheMoney</th>
      <th>contractSize</th>
      <th>currency</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>SPXW240822C04800000</td>
      <td>2024-07-19 15:52:07+00:00</td>
      <td>4800.0</td>
      <td>743.58</td>
      <td>674.20</td>
      <td>681.50</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>0.363593</td>
      <td>True</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>1</th>
      <td>SPXW240822C05340000</td>
      <td>2024-07-23 15:42:28+00:00</td>
      <td>5340.0</td>
      <td>280.68</td>
      <td>172.50</td>
      <td>174.00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0</td>
      <td>0.181603</td>
      <td>True</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>2</th>
      <td>SPXW240822C05360000</td>
      <td>2024-07-23 15:42:28+00:00</td>
      <td>5360.0</td>
      <td>262.78</td>
      <td>157.40</td>
      <td>158.80</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0</td>
      <td>0.177884</td>
      <td>True</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>3</th>
      <td>SPXW240822C05380000</td>
      <td>2024-07-25 15:39:09+00:00</td>
      <td>5380.0</td>
      <td>146.92</td>
      <td>142.50</td>
      <td>143.80</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>0</td>
      <td>0.173638</td>
      <td>True</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>4</th>
      <td>SPXW240822C05390000</td>
      <td>2024-07-25 15:39:09+00:00</td>
      <td>5390.0</td>
      <td>139.92</td>
      <td>135.70</td>
      <td>137.00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>0</td>
      <td>0.172490</td>
      <td>True</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>5</th>
      <td>SPXW240822C05400000</td>
      <td>2024-07-25 13:35:14+00:00</td>
      <td>5400.0</td>
      <td>117.83</td>
      <td>128.70</td>
      <td>130.00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>0.170697</td>
      <td>True</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>6</th>
      <td>SPXW240822C05420000</td>
      <td>2024-07-29 17:20:07+00:00</td>
      <td>5420.0</td>
      <td>127.81</td>
      <td>114.80</td>
      <td>116.00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>8.0</td>
      <td>0</td>
      <td>0.166329</td>
      <td>True</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>7</th>
      <td>SPXW240822C05425000</td>
      <td>2024-07-25 13:35:14+00:00</td>
      <td>5425.0</td>
      <td>102.23</td>
      <td>111.80</td>
      <td>112.80</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>0.165616</td>
      <td>True</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>8</th>
      <td>SPXW240822C05440000</td>
      <td>2024-07-29 19:34:40+00:00</td>
      <td>5440.0</td>
      <td>108.49</td>
      <td>102.30</td>
      <td>103.30</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>24.0</td>
      <td>0</td>
      <td>0.163228</td>
      <td>True</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>9</th>
      <td>SPXW240822C05450000</td>
      <td>2024-07-26 14:13:32+00:00</td>
      <td>5450.0</td>
      <td>94.10</td>
      <td>96.20</td>
      <td>97.00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>25.0</td>
      <td>0</td>
      <td>0.161328</td>
      <td>True</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>10</th>
      <td>SPXW240822C05460000</td>
      <td>2024-07-29 19:58:19+00:00</td>
      <td>5460.0</td>
      <td>91.46</td>
      <td>90.20</td>
      <td>91.00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>7.0</td>
      <td>0</td>
      <td>0.159661</td>
      <td>True</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>11</th>
      <td>SPXW240822C05470000</td>
      <td>2024-07-29 18:42:54+00:00</td>
      <td>5470.0</td>
      <td>86.42</td>
      <td>84.40</td>
      <td>85.20</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>12.0</td>
      <td>0</td>
      <td>0.158036</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>12</th>
      <td>SPXW240822C05475000</td>
      <td>2024-07-29 14:14:23+00:00</td>
      <td>5475.0</td>
      <td>87.70</td>
      <td>81.80</td>
      <td>82.70</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>106.0</td>
      <td>0</td>
      <td>0.157822</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>13</th>
      <td>SPXW240822C05480000</td>
      <td>2024-07-29 17:30:21+00:00</td>
      <td>5480.0</td>
      <td>82.81</td>
      <td>78.80</td>
      <td>79.70</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>11.0</td>
      <td>0</td>
      <td>0.156628</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>14</th>
      <td>SPXW240822C05490000</td>
      <td>2024-07-29 16:28:07+00:00</td>
      <td>5490.0</td>
      <td>81.75</td>
      <td>73.50</td>
      <td>74.20</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>0</td>
      <td>0.154889</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>15</th>
      <td>SPXW240822C05500000</td>
      <td>2024-07-29 16:57:39+00:00</td>
      <td>5500.0</td>
      <td>77.10</td>
      <td>68.30</td>
      <td>69.00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>50.0</td>
      <td>0</td>
      <td>0.153348</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>16</th>
      <td>SPXW240822C05510000</td>
      <td>2024-07-25 09:09:54+00:00</td>
      <td>5510.0</td>
      <td>64.50</td>
      <td>63.30</td>
      <td>64.10</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>21.0</td>
      <td>0</td>
      <td>0.152001</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>17</th>
      <td>SPXW240822C05520000</td>
      <td>2024-07-25 20:11:03+00:00</td>
      <td>5520.0</td>
      <td>44.80</td>
      <td>58.70</td>
      <td>59.50</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>152.0</td>
      <td>0</td>
      <td>0.150847</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>18</th>
      <td>SPXW240822C05525000</td>
      <td>2024-07-29 19:51:40+00:00</td>
      <td>5525.0</td>
      <td>61.40</td>
      <td>56.40</td>
      <td>57.20</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>13.0</td>
      <td>0</td>
      <td>0.150136</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>19</th>
      <td>SPXW240822C05530000</td>
      <td>2024-07-24 16:46:10+00:00</td>
      <td>5530.0</td>
      <td>59.40</td>
      <td>54.20</td>
      <td>54.90</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>0</td>
      <td>0.149331</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>20</th>
      <td>SPXW240822C05540000</td>
      <td>2024-07-29 19:51:40+00:00</td>
      <td>5540.0</td>
      <td>54.50</td>
      <td>49.70</td>
      <td>50.50</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>16.0</td>
      <td>0</td>
      <td>0.147813</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>21</th>
      <td>SPXW240822C05550000</td>
      <td>2024-07-26 14:24:57+00:00</td>
      <td>5550.0</td>
      <td>47.20</td>
      <td>45.90</td>
      <td>46.70</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>12.0</td>
      <td>0</td>
      <td>0.147061</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>22</th>
      <td>SPXW240822C05560000</td>
      <td>2024-07-29 19:34:40+00:00</td>
      <td>5560.0</td>
      <td>45.27</td>
      <td>41.80</td>
      <td>42.50</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>24.0</td>
      <td>0</td>
      <td>0.145146</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>23</th>
      <td>SPXW240822C05570000</td>
      <td>2024-07-26 17:12:35+00:00</td>
      <td>5570.0</td>
      <td>48.80</td>
      <td>38.10</td>
      <td>38.80</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>0</td>
      <td>0.143807</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>24</th>
      <td>SPXW240822C05575000</td>
      <td>2024-07-29 19:23:01+00:00</td>
      <td>5575.0</td>
      <td>39.59</td>
      <td>36.40</td>
      <td>37.10</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>7.0</td>
      <td>0</td>
      <td>0.143292</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>25</th>
      <td>SPXW240822C05580000</td>
      <td>2024-07-29 15:48:02+00:00</td>
      <td>5580.0</td>
      <td>35.02</td>
      <td>34.60</td>
      <td>35.40</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>0</td>
      <td>0.142674</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>26</th>
      <td>SPXW240822C05590000</td>
      <td>2024-07-26 14:24:14+00:00</td>
      <td>5590.0</td>
      <td>33.42</td>
      <td>31.60</td>
      <td>32.30</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>0.141770</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>27</th>
      <td>SPXW240822C05600000</td>
      <td>2024-07-26 15:58:51+00:00</td>
      <td>5600.0</td>
      <td>31.60</td>
      <td>28.60</td>
      <td>29.30</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>0.140672</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>28</th>
      <td>SPXW240822C05610000</td>
      <td>2024-07-26 19:46:48+00:00</td>
      <td>5610.0</td>
      <td>26.67</td>
      <td>25.60</td>
      <td>26.30</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>0.139138</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>29</th>
      <td>SPXW240822C05620000</td>
      <td>2024-07-29 19:34:29+00:00</td>
      <td>5620.0</td>
      <td>25.21</td>
      <td>23.00</td>
      <td>23.70</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>24.0</td>
      <td>0</td>
      <td>0.138085</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>30</th>
      <td>SPXW240822C05625000</td>
      <td>2024-07-25 19:49:43+00:00</td>
      <td>5625.0</td>
      <td>20.72</td>
      <td>21.80</td>
      <td>22.50</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>0</td>
      <td>0.137643</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>31</th>
      <td>SPXW240822C05630000</td>
      <td>2024-07-26 15:17:31+00:00</td>
      <td>5630.0</td>
      <td>21.20</td>
      <td>20.80</td>
      <td>21.40</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>51.0</td>
      <td>0</td>
      <td>0.137342</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>32</th>
      <td>SPXW240822C05640000</td>
      <td>2024-07-26 15:28:12+00:00</td>
      <td>5640.0</td>
      <td>19.10</td>
      <td>18.60</td>
      <td>19.20</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>0</td>
      <td>0.136422</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>33</th>
      <td>SPXW240822C05650000</td>
      <td>2024-07-29 19:23:01+00:00</td>
      <td>5650.0</td>
      <td>18.14</td>
      <td>16.40</td>
      <td>17.00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>0</td>
      <td>0.135045</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>34</th>
      <td>SPXW240822C05660000</td>
      <td>2024-07-29 16:33:16+00:00</td>
      <td>5660.0</td>
      <td>17.65</td>
      <td>14.60</td>
      <td>15.10</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>0.134034</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>35</th>
      <td>SPXW240822C05670000</td>
      <td>2024-07-26 14:47:40+00:00</td>
      <td>5670.0</td>
      <td>13.10</td>
      <td>13.00</td>
      <td>13.50</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>0</td>
      <td>0.133470</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>36</th>
      <td>SPXW240822C05675000</td>
      <td>2024-07-29 15:22:03+00:00</td>
      <td>5675.0</td>
      <td>12.20</td>
      <td>12.20</td>
      <td>12.70</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>0</td>
      <td>0.133027</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>37</th>
      <td>SPXW240822C05680000</td>
      <td>2024-07-29 13:46:07+00:00</td>
      <td>5680.0</td>
      <td>14.90</td>
      <td>11.40</td>
      <td>12.00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>0</td>
      <td>0.132798</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>38</th>
      <td>SPXW240822C05700000</td>
      <td>2024-07-29 13:50:51+00:00</td>
      <td>5700.0</td>
      <td>11.00</td>
      <td>8.80</td>
      <td>9.20</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>0.130754</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>39</th>
      <td>SPXW240822C05725000</td>
      <td>2024-07-29 19:23:53+00:00</td>
      <td>5725.0</td>
      <td>7.04</td>
      <td>6.30</td>
      <td>6.70</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>25.0</td>
      <td>0</td>
      <td>0.129510</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>40</th>
      <td>SPXW240822C05750000</td>
      <td>2024-07-29 19:28:41+00:00</td>
      <td>5750.0</td>
      <td>5.00</td>
      <td>4.50</td>
      <td>4.80</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>16.0</td>
      <td>0</td>
      <td>0.128404</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>41</th>
      <td>SPXW240822C05800000</td>
      <td>2024-07-26 17:38:59+00:00</td>
      <td>5800.0</td>
      <td>3.54</td>
      <td>2.20</td>
      <td>2.45</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>0</td>
      <td>0.127511</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>42</th>
      <td>SPXW240822C05850000</td>
      <td>2024-07-26 18:44:34+00:00</td>
      <td>5850.0</td>
      <td>1.85</td>
      <td>1.15</td>
      <td>1.35</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>0</td>
      <td>0.129312</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>43</th>
      <td>SPXW240822C05900000</td>
      <td>2024-07-26 18:44:34+00:00</td>
      <td>5900.0</td>
      <td>1.13</td>
      <td>0.60</td>
      <td>0.85</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>7.0</td>
      <td>0</td>
      <td>0.133798</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>44</th>
      <td>SPXW240822C06000000</td>
      <td>2024-07-29 18:15:42+00:00</td>
      <td>6000.0</td>
      <td>0.32</td>
      <td>0.25</td>
      <td>0.40</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>195.0</td>
      <td>0</td>
      <td>0.144906</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>45</th>
      <td>SPXW240822C06100000</td>
      <td>2024-07-24 15:48:26+00:00</td>
      <td>6100.0</td>
      <td>0.25</td>
      <td>0.10</td>
      <td>0.30</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>0</td>
      <td>0.162240</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>46</th>
      <td>SPXW240822C06200000</td>
      <td>2024-07-24 14:14:05+00:00</td>
      <td>6200.0</td>
      <td>0.14</td>
      <td>0.05</td>
      <td>0.25</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>0</td>
      <td>0.179940</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
    <tr>
      <th>47</th>
      <td>SPXW240822C06400000</td>
      <td>2024-07-22 17:30:48+00:00</td>
      <td>6400.0</td>
      <td>0.15</td>
      <td>0.00</td>
      <td>0.20</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0</td>
      <td>0.215340</td>
      <td>False</td>
      <td>REGULAR</td>
      <td>USD</td>
    </tr>
  </tbody>
</table>
</div>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="c1"># clean up data</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="c1"># remove NA&#39;s</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="n">spx_calls</span> <span class="o">=</span> <span class="n">spx_calls</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;currency&#39;</span><span class="p">,</span> <span class="s1">&#39;contractSize&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="n">spx_puts</span> <span class="o">=</span> <span class="n">spx_puts</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;currency&#39;</span><span class="p">,</span> <span class="s1">&#39;contractSize&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="n">spx_calls</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">spx_puts</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>((45, 12), (65, 12))
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="n">spx_calls</span><span class="p">[</span><span class="n">spx_calls</span><span class="p">[</span><span class="s1">&#39;lastTradeDate&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s1">&#39;2024-07&#39;</span><span class="p">]</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div style="overflow-x: auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>contractSymbol</th>
      <th>lastTradeDate</th>
      <th>strike</th>
      <th>lastPrice</th>
      <th>bid</th>
      <th>ask</th>
      <th>change</th>
      <th>percentChange</th>
      <th>volume</th>
      <th>openInterest</th>
      <th>impliedVolatility</th>
      <th>inTheMoney</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>SPXW240822C04800000</td>
      <td>2024-07-19 15:52:07+00:00</td>
      <td>4800.0</td>
      <td>743.58</td>
      <td>674.20</td>
      <td>681.50</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>0.363593</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>SPXW240822C05380000</td>
      <td>2024-07-25 15:39:09+00:00</td>
      <td>5380.0</td>
      <td>146.92</td>
      <td>142.50</td>
      <td>143.80</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>0</td>
      <td>0.173638</td>
      <td>True</td>
    </tr>
    <tr>
      <th>4</th>
      <td>SPXW240822C05390000</td>
      <td>2024-07-25 15:39:09+00:00</td>
      <td>5390.0</td>
      <td>139.92</td>
      <td>135.70</td>
      <td>137.00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>0</td>
      <td>0.172490</td>
      <td>True</td>
    </tr>
    <tr>
      <th>5</th>
      <td>SPXW240822C05400000</td>
      <td>2024-07-25 13:35:14+00:00</td>
      <td>5400.0</td>
      <td>117.83</td>
      <td>128.70</td>
      <td>130.00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>0.170697</td>
      <td>True</td>
    </tr>
    <tr>
      <th>6</th>
      <td>SPXW240822C05420000</td>
      <td>2024-07-29 17:20:07+00:00</td>
      <td>5420.0</td>
      <td>127.81</td>
      <td>114.80</td>
      <td>116.00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>8.0</td>
      <td>0</td>
      <td>0.166329</td>
      <td>True</td>
    </tr>
    <tr>
      <th>7</th>
      <td>SPXW240822C05425000</td>
      <td>2024-07-25 13:35:14+00:00</td>
      <td>5425.0</td>
      <td>102.23</td>
      <td>111.80</td>
      <td>112.80</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>0.165616</td>
      <td>True</td>
    </tr>
    <tr>
      <th>8</th>
      <td>SPXW240822C05440000</td>
      <td>2024-07-29 19:34:40+00:00</td>
      <td>5440.0</td>
      <td>108.49</td>
      <td>102.30</td>
      <td>103.30</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>24.0</td>
      <td>0</td>
      <td>0.163228</td>
      <td>True</td>
    </tr>
    <tr>
      <th>9</th>
      <td>SPXW240822C05450000</td>
      <td>2024-07-26 14:13:32+00:00</td>
      <td>5450.0</td>
      <td>94.10</td>
      <td>96.20</td>
      <td>97.00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>25.0</td>
      <td>0</td>
      <td>0.161328</td>
      <td>True</td>
    </tr>
    <tr>
      <th>10</th>
      <td>SPXW240822C05460000</td>
      <td>2024-07-29 19:58:19+00:00</td>
      <td>5460.0</td>
      <td>91.46</td>
      <td>90.20</td>
      <td>91.00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>7.0</td>
      <td>0</td>
      <td>0.159661</td>
      <td>True</td>
    </tr>
    <tr>
      <th>11</th>
      <td>SPXW240822C05470000</td>
      <td>2024-07-29 18:42:54+00:00</td>
      <td>5470.0</td>
      <td>86.42</td>
      <td>84.40</td>
      <td>85.20</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>12.0</td>
      <td>0</td>
      <td>0.158036</td>
      <td>False</td>
    </tr>
    <tr>
      <th>12</th>
      <td>SPXW240822C05475000</td>
      <td>2024-07-29 14:14:23+00:00</td>
      <td>5475.0</td>
      <td>87.70</td>
      <td>81.80</td>
      <td>82.70</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>106.0</td>
      <td>0</td>
      <td>0.157822</td>
      <td>False</td>
    </tr>
    <tr>
      <th>13</th>
      <td>SPXW240822C05480000</td>
      <td>2024-07-29 17:30:21+00:00</td>
      <td>5480.0</td>
      <td>82.81</td>
      <td>78.80</td>
      <td>79.70</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>11.0</td>
      <td>0</td>
      <td>0.156628</td>
      <td>False</td>
    </tr>
    <tr>
      <th>14</th>
      <td>SPXW240822C05490000</td>
      <td>2024-07-29 16:28:07+00:00</td>
      <td>5490.0</td>
      <td>81.75</td>
      <td>73.50</td>
      <td>74.20</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>0</td>
      <td>0.154889</td>
      <td>False</td>
    </tr>
    <tr>
      <th>15</th>
      <td>SPXW240822C05500000</td>
      <td>2024-07-29 16:57:39+00:00</td>
      <td>5500.0</td>
      <td>77.10</td>
      <td>68.30</td>
      <td>69.00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>50.0</td>
      <td>0</td>
      <td>0.153348</td>
      <td>False</td>
    </tr>
    <tr>
      <th>16</th>
      <td>SPXW240822C05510000</td>
      <td>2024-07-25 09:09:54+00:00</td>
      <td>5510.0</td>
      <td>64.50</td>
      <td>63.30</td>
      <td>64.10</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>21.0</td>
      <td>0</td>
      <td>0.152001</td>
      <td>False</td>
    </tr>
    <tr>
      <th>17</th>
      <td>SPXW240822C05520000</td>
      <td>2024-07-25 20:11:03+00:00</td>
      <td>5520.0</td>
      <td>44.80</td>
      <td>58.70</td>
      <td>59.50</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>152.0</td>
      <td>0</td>
      <td>0.150847</td>
      <td>False</td>
    </tr>
    <tr>
      <th>18</th>
      <td>SPXW240822C05525000</td>
      <td>2024-07-29 19:51:40+00:00</td>
      <td>5525.0</td>
      <td>61.40</td>
      <td>56.40</td>
      <td>57.20</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>13.0</td>
      <td>0</td>
      <td>0.150136</td>
      <td>False</td>
    </tr>
    <tr>
      <th>19</th>
      <td>SPXW240822C05530000</td>
      <td>2024-07-24 16:46:10+00:00</td>
      <td>5530.0</td>
      <td>59.40</td>
      <td>54.20</td>
      <td>54.90</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>0</td>
      <td>0.149331</td>
      <td>False</td>
    </tr>
    <tr>
      <th>20</th>
      <td>SPXW240822C05540000</td>
      <td>2024-07-29 19:51:40+00:00</td>
      <td>5540.0</td>
      <td>54.50</td>
      <td>49.70</td>
      <td>50.50</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>16.0</td>
      <td>0</td>
      <td>0.147813</td>
      <td>False</td>
    </tr>
    <tr>
      <th>21</th>
      <td>SPXW240822C05550000</td>
      <td>2024-07-26 14:24:57+00:00</td>
      <td>5550.0</td>
      <td>47.20</td>
      <td>45.90</td>
      <td>46.70</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>12.0</td>
      <td>0</td>
      <td>0.147061</td>
      <td>False</td>
    </tr>
    <tr>
      <th>22</th>
      <td>SPXW240822C05560000</td>
      <td>2024-07-29 19:34:40+00:00</td>
      <td>5560.0</td>
      <td>45.27</td>
      <td>41.80</td>
      <td>42.50</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>24.0</td>
      <td>0</td>
      <td>0.145146</td>
      <td>False</td>
    </tr>
    <tr>
      <th>23</th>
      <td>SPXW240822C05570000</td>
      <td>2024-07-26 17:12:35+00:00</td>
      <td>5570.0</td>
      <td>48.80</td>
      <td>38.10</td>
      <td>38.80</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>0</td>
      <td>0.143807</td>
      <td>False</td>
    </tr>
    <tr>
      <th>24</th>
      <td>SPXW240822C05575000</td>
      <td>2024-07-29 19:23:01+00:00</td>
      <td>5575.0</td>
      <td>39.59</td>
      <td>36.40</td>
      <td>37.10</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>7.0</td>
      <td>0</td>
      <td>0.143292</td>
      <td>False</td>
    </tr>
    <tr>
      <th>25</th>
      <td>SPXW240822C05580000</td>
      <td>2024-07-29 15:48:02+00:00</td>
      <td>5580.0</td>
      <td>35.02</td>
      <td>34.60</td>
      <td>35.40</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>0</td>
      <td>0.142674</td>
      <td>False</td>
    </tr>
    <tr>
      <th>26</th>
      <td>SPXW240822C05590000</td>
      <td>2024-07-26 14:24:14+00:00</td>
      <td>5590.0</td>
      <td>33.42</td>
      <td>31.60</td>
      <td>32.30</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>0.141770</td>
      <td>False</td>
    </tr>
    <tr>
      <th>27</th>
      <td>SPXW240822C05600000</td>
      <td>2024-07-26 15:58:51+00:00</td>
      <td>5600.0</td>
      <td>31.60</td>
      <td>28.60</td>
      <td>29.30</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>0.140672</td>
      <td>False</td>
    </tr>
    <tr>
      <th>28</th>
      <td>SPXW240822C05610000</td>
      <td>2024-07-26 19:46:48+00:00</td>
      <td>5610.0</td>
      <td>26.67</td>
      <td>25.60</td>
      <td>26.30</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>0.139138</td>
      <td>False</td>
    </tr>
    <tr>
      <th>29</th>
      <td>SPXW240822C05620000</td>
      <td>2024-07-29 19:34:29+00:00</td>
      <td>5620.0</td>
      <td>25.21</td>
      <td>23.00</td>
      <td>23.70</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>24.0</td>
      <td>0</td>
      <td>0.138085</td>
      <td>False</td>
    </tr>
    <tr>
      <th>30</th>
      <td>SPXW240822C05625000</td>
      <td>2024-07-25 19:49:43+00:00</td>
      <td>5625.0</td>
      <td>20.72</td>
      <td>21.80</td>
      <td>22.50</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>0</td>
      <td>0.137643</td>
      <td>False</td>
    </tr>
    <tr>
      <th>31</th>
      <td>SPXW240822C05630000</td>
      <td>2024-07-26 15:17:31+00:00</td>
      <td>5630.0</td>
      <td>21.20</td>
      <td>20.80</td>
      <td>21.40</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>51.0</td>
      <td>0</td>
      <td>0.137342</td>
      <td>False</td>
    </tr>
    <tr>
      <th>32</th>
      <td>SPXW240822C05640000</td>
      <td>2024-07-26 15:28:12+00:00</td>
      <td>5640.0</td>
      <td>19.10</td>
      <td>18.60</td>
      <td>19.20</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>0</td>
      <td>0.136422</td>
      <td>False</td>
    </tr>
    <tr>
      <th>33</th>
      <td>SPXW240822C05650000</td>
      <td>2024-07-29 19:23:01+00:00</td>
      <td>5650.0</td>
      <td>18.14</td>
      <td>16.40</td>
      <td>17.00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>0</td>
      <td>0.135045</td>
      <td>False</td>
    </tr>
    <tr>
      <th>34</th>
      <td>SPXW240822C05660000</td>
      <td>2024-07-29 16:33:16+00:00</td>
      <td>5660.0</td>
      <td>17.65</td>
      <td>14.60</td>
      <td>15.10</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>0.134034</td>
      <td>False</td>
    </tr>
    <tr>
      <th>35</th>
      <td>SPXW240822C05670000</td>
      <td>2024-07-26 14:47:40+00:00</td>
      <td>5670.0</td>
      <td>13.10</td>
      <td>13.00</td>
      <td>13.50</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>0</td>
      <td>0.133470</td>
      <td>False</td>
    </tr>
    <tr>
      <th>36</th>
      <td>SPXW240822C05675000</td>
      <td>2024-07-29 15:22:03+00:00</td>
      <td>5675.0</td>
      <td>12.20</td>
      <td>12.20</td>
      <td>12.70</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>0</td>
      <td>0.133027</td>
      <td>False</td>
    </tr>
    <tr>
      <th>37</th>
      <td>SPXW240822C05680000</td>
      <td>2024-07-29 13:46:07+00:00</td>
      <td>5680.0</td>
      <td>14.90</td>
      <td>11.40</td>
      <td>12.00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>0</td>
      <td>0.132798</td>
      <td>False</td>
    </tr>
    <tr>
      <th>38</th>
      <td>SPXW240822C05700000</td>
      <td>2024-07-29 13:50:51+00:00</td>
      <td>5700.0</td>
      <td>11.00</td>
      <td>8.80</td>
      <td>9.20</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>0.130754</td>
      <td>False</td>
    </tr>
    <tr>
      <th>39</th>
      <td>SPXW240822C05725000</td>
      <td>2024-07-29 19:23:53+00:00</td>
      <td>5725.0</td>
      <td>7.04</td>
      <td>6.30</td>
      <td>6.70</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>25.0</td>
      <td>0</td>
      <td>0.129510</td>
      <td>False</td>
    </tr>
    <tr>
      <th>40</th>
      <td>SPXW240822C05750000</td>
      <td>2024-07-29 19:28:41+00:00</td>
      <td>5750.0</td>
      <td>5.00</td>
      <td>4.50</td>
      <td>4.80</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>16.0</td>
      <td>0</td>
      <td>0.128404</td>
      <td>False</td>
    </tr>
    <tr>
      <th>41</th>
      <td>SPXW240822C05800000</td>
      <td>2024-07-26 17:38:59+00:00</td>
      <td>5800.0</td>
      <td>3.54</td>
      <td>2.20</td>
      <td>2.45</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>0</td>
      <td>0.127511</td>
      <td>False</td>
    </tr>
    <tr>
      <th>42</th>
      <td>SPXW240822C05850000</td>
      <td>2024-07-26 18:44:34+00:00</td>
      <td>5850.0</td>
      <td>1.85</td>
      <td>1.15</td>
      <td>1.35</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>0</td>
      <td>0.129312</td>
      <td>False</td>
    </tr>
    <tr>
      <th>43</th>
      <td>SPXW240822C05900000</td>
      <td>2024-07-26 18:44:34+00:00</td>
      <td>5900.0</td>
      <td>1.13</td>
      <td>0.60</td>
      <td>0.85</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>7.0</td>
      <td>0</td>
      <td>0.133798</td>
      <td>False</td>
    </tr>
    <tr>
      <th>44</th>
      <td>SPXW240822C06000000</td>
      <td>2024-07-29 18:15:42+00:00</td>
      <td>6000.0</td>
      <td>0.32</td>
      <td>0.25</td>
      <td>0.40</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>195.0</td>
      <td>0</td>
      <td>0.144906</td>
      <td>False</td>
    </tr>
    <tr>
      <th>45</th>
      <td>SPXW240822C06100000</td>
      <td>2024-07-24 15:48:26+00:00</td>
      <td>6100.0</td>
      <td>0.25</td>
      <td>0.10</td>
      <td>0.30</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>0</td>
      <td>0.162240</td>
      <td>False</td>
    </tr>
    <tr>
      <th>46</th>
      <td>SPXW240822C06200000</td>
      <td>2024-07-24 14:14:05+00:00</td>
      <td>6200.0</td>
      <td>0.14</td>
      <td>0.05</td>
      <td>0.25</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>0</td>
      <td>0.179940</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="c1"># remove data point where either bid = 0 or ask = 0</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="c1"># remove data that that are not traded recently</span>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="n">spx_calls</span> <span class="o">=</span> <span class="n">spx_calls</span><span class="p">[(</span><span class="n">spx_calls</span><span class="p">[</span><span class="s1">&#39;bid&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">spx_calls</span><span class="p">[</span><span class="s1">&#39;ask&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]</span>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="c1"># spx_calls[spx_calls[&#39;lastTradeDate&#39;] &gt; &#39;2022-07&#39;]</span>
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="n">spx_calls</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div style="overflow-x: auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>contractSymbol</th>
      <th>lastTradeDate</th>
      <th>strike</th>
      <th>lastPrice</th>
      <th>bid</th>
      <th>ask</th>
      <th>change</th>
      <th>percentChange</th>
      <th>volume</th>
      <th>openInterest</th>
      <th>impliedVolatility</th>
      <th>inTheMoney</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>SPXW220826C03425000</td>
      <td>2022-07-20 19:29:23</td>
      <td>3425.0</td>
      <td>553.08</td>
      <td>543.40</td>
      <td>550.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>10.0</td>
      <td>11</td>
      <td>0.322112</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>SPXW220826C03470000</td>
      <td>2022-07-21 16:28:29</td>
      <td>3470.0</td>
      <td>524.85</td>
      <td>501.60</td>
      <td>508.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>20.0</td>
      <td>20</td>
      <td>0.318153</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>SPXW220826C03475000</td>
      <td>2022-07-21 16:28:29</td>
      <td>3475.0</td>
      <td>520.15</td>
      <td>495.80</td>
      <td>502.2</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>20.0</td>
      <td>20</td>
      <td>0.310706</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>SPXW220826C03500000</td>
      <td>2022-07-21 15:40:29</td>
      <td>3500.0</td>
      <td>481.74</td>
      <td>472.60</td>
      <td>478.7</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.0</td>
      <td>1</td>
      <td>0.306220</td>
      <td>True</td>
    </tr>
    <tr>
      <th>4</th>
      <td>SPXW220826C03540000</td>
      <td>2022-07-21 15:40:29</td>
      <td>3540.0</td>
      <td>444.89</td>
      <td>433.80</td>
      <td>439.8</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.0</td>
      <td>0</td>
      <td>0.290595</td>
      <td>True</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>101</th>
      <td>SPXW220826C04250000</td>
      <td>2022-07-25 14:46:41</td>
      <td>4250.0</td>
      <td>10.74</td>
      <td>10.50</td>
      <td>10.8</td>
      <td>-0.610001</td>
      <td>-5.374454</td>
      <td>44.0</td>
      <td>150</td>
      <td>0.181496</td>
      <td>False</td>
    </tr>
    <tr>
      <th>102</th>
      <td>SPXW220826C04300000</td>
      <td>2022-07-25 14:24:17</td>
      <td>4300.0</td>
      <td>6.40</td>
      <td>6.20</td>
      <td>6.5</td>
      <td>-0.750000</td>
      <td>-10.489511</td>
      <td>23.0</td>
      <td>97</td>
      <td>0.179650</td>
      <td>False</td>
    </tr>
    <tr>
      <th>103</th>
      <td>SPXW220826C04400000</td>
      <td>2022-07-25 14:41:03</td>
      <td>4400.0</td>
      <td>2.18</td>
      <td>2.25</td>
      <td>2.4</td>
      <td>-1.120000</td>
      <td>-33.939390</td>
      <td>16.0</td>
      <td>303</td>
      <td>0.180703</td>
      <td>False</td>
    </tr>
    <tr>
      <th>104</th>
      <td>SPXW220826C04600000</td>
      <td>2022-07-25 14:39:45</td>
      <td>4600.0</td>
      <td>0.40</td>
      <td>0.35</td>
      <td>0.5</td>
      <td>-0.250000</td>
      <td>-38.461533</td>
      <td>9.0</td>
      <td>28</td>
      <td>0.197274</td>
      <td>False</td>
    </tr>
    <tr>
      <th>105</th>
      <td>SPXW220826C04800000</td>
      <td>2022-07-22 15:08:17</td>
      <td>4800.0</td>
      <td>0.21</td>
      <td>0.10</td>
      <td>0.2</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.0</td>
      <td>5</td>
      <td>0.224373</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
<p>106 rows × 12 columns</p>
</div>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="n">spx_puts</span> <span class="o">=</span> <span class="n">spx_puts</span><span class="p">[(</span><span class="n">spx_puts</span><span class="p">[</span><span class="s1">&#39;bid&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">spx_puts</span><span class="p">[</span><span class="s1">&#39;ask&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="c1"># spx_puts = spx_puts[spx_puts[&#39;lastTradeDate&#39;] &gt; &#39;2022-02&#39;]</span>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="n">spx_puts</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div style="overflow-x: auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>contractSymbol</th>
      <th>lastTradeDate</th>
      <th>strike</th>
      <th>lastPrice</th>
      <th>bid</th>
      <th>ask</th>
      <th>change</th>
      <th>percentChange</th>
      <th>volume</th>
      <th>openInterest</th>
      <th>impliedVolatility</th>
      <th>inTheMoney</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>SPXW240822P03600000</td>
      <td>2024-07-24 19:59:59+00:00</td>
      <td>3600.0</td>
      <td>0.80</td>
      <td>0.20</td>
      <td>0.35</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>0</td>
      <td>0.549809</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>SPXW240822P03800000</td>
      <td>2024-07-26 19:45:03+00:00</td>
      <td>3800.0</td>
      <td>0.55</td>
      <td>0.35</td>
      <td>0.50</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>0.503179</td>
      <td>False</td>
    </tr>
    <tr>
      <th>5</th>
      <td>SPXW240822P04000000</td>
      <td>2024-07-25 15:54:31+00:00</td>
      <td>4000.0</td>
      <td>1.20</td>
      <td>0.55</td>
      <td>0.75</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>0</td>
      <td>0.463262</td>
      <td>False</td>
    </tr>
    <tr>
      <th>6</th>
      <td>SPXW240822P04200000</td>
      <td>2024-07-29 15:46:15+00:00</td>
      <td>4200.0</td>
      <td>1.00</td>
      <td>0.90</td>
      <td>1.05</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>15.0</td>
      <td>0</td>
      <td>0.412176</td>
      <td>False</td>
    </tr>
    <tr>
      <th>7</th>
      <td>SPXW240822P04300000</td>
      <td>2024-07-29 19:46:49+00:00</td>
      <td>4300.0</td>
      <td>1.10</td>
      <td>1.10</td>
      <td>1.25</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>30.0</td>
      <td>0</td>
      <td>0.386786</td>
      <td>False</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>64</th>
      <td>SPXW240822P05625000</td>
      <td>2024-07-22 18:15:01+00:00</td>
      <td>5625.0</td>
      <td>98.14</td>
      <td>169.30</td>
      <td>170.80</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>0</td>
      <td>0.100961</td>
      <td>True</td>
    </tr>
    <tr>
      <th>66</th>
      <td>SPXW240822P05640000</td>
      <td>2024-07-17 14:56:22+00:00</td>
      <td>5640.0</td>
      <td>86.33</td>
      <td>180.90</td>
      <td>182.30</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>0</td>
      <td>0.094087</td>
      <td>True</td>
    </tr>
    <tr>
      <th>67</th>
      <td>SPXW240822P05650000</td>
      <td>2024-07-22 14:46:15+00:00</td>
      <td>5650.0</td>
      <td>115.19</td>
      <td>188.80</td>
      <td>190.20</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>0</td>
      <td>0.087961</td>
      <td>True</td>
    </tr>
    <tr>
      <th>69</th>
      <td>SPXW240822P05680000</td>
      <td>2024-07-18 13:55:00+00:00</td>
      <td>5680.0</td>
      <td>110.10</td>
      <td>213.70</td>
      <td>215.10</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>6.0</td>
      <td>0</td>
      <td>0.000010</td>
      <td>True</td>
    </tr>
    <tr>
      <th>70</th>
      <td>SPXW240822P05700000</td>
      <td>2024-07-18 13:55:04+00:00</td>
      <td>5700.0</td>
      <td>121.30</td>
      <td>228.10</td>
      <td>235.40</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>0</td>
      <td>0.000010</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
<p>64 rows × 12 columns</p>
</div>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="c1"># save data as csv</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="c1"># spx_calls.to_csv(&#39;spxcall_07252022.csv&#39;, index=False)</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="c1"># spx_puts.to_csv(&#39;spxput_07252022.csv&#39;, index=False)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="c1"># read saved spx option data</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="n">spx_calls</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;spxcall_07252022.csv&#39;</span><span class="p">)</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="n">spx_puts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;spxput_07252022.csv&#39;</span><span class="p">)</span>
</code></pre></div>
<h3 id="create-python-class-optionanalytics">Create <code>python</code> class <code>OptionAnalytics</code><a class="headerlink" href="#create-python-class-optionanalytics" title="Permanent link">&para;</a></h3>
<p>Wrap everything up in a python class.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">OptionAnalytics</span><span class="p">:</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option_chain</span><span class="p">,</span> <span class="n">expiry</span><span class="p">,</span> <span class="n">today</span><span class="p">):</span>
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">expiry</span> <span class="o">=</span> <span class="n">expiry</span>
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">today</span> <span class="o">=</span> <span class="n">today</span>
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">today</span><span class="p">)</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">:</span>
<a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">today</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">today</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">calls</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">puts</span> <span class="o">=</span> <span class="n">option_chain</span>
<a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ks_c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calls</span><span class="p">[</span><span class="s1">&#39;strike&#39;</span><span class="p">]</span>
<a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calls</span><span class="p">[</span><span class="s1">&#39;bid&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">calls</span><span class="p">[</span><span class="s1">&#39;ask&#39;</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span> 
<a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ks_p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">puts</span><span class="p">[</span><span class="s1">&#39;strike&#39;</span><span class="p">]</span> 
<a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ps</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">puts</span><span class="p">[</span><span class="s1">&#39;bid&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">puts</span><span class="p">[</span><span class="s1">&#39;ask&#39;</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>         
<a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a>        <span class="c1"># strikes that are traded for both calls and puts</span>
<a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<a id="__codelineno-36-14" name="__codelineno-36-14" href="#__codelineno-36-14"></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ks_c</span><span class="p">:</span>
<a id="__codelineno-36-15" name="__codelineno-36-15" href="#__codelineno-36-15"></a>            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ks_p</span><span class="p">):</span>
<a id="__codelineno-36-16" name="__codelineno-36-16" href="#__codelineno-36-16"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">ks</span><span class="p">,</span> <span class="p">[</span><span class="n">k</span><span class="p">]])</span>
<a id="__codelineno-36-17" name="__codelineno-36-17" href="#__codelineno-36-17"></a>
<a id="__codelineno-36-18" name="__codelineno-36-18" href="#__codelineno-36-18"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mids_call</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<a id="__codelineno-36-19" name="__codelineno-36-19" href="#__codelineno-36-19"></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ks</span><span class="p">:</span>
<a id="__codelineno-36-20" name="__codelineno-36-20" href="#__codelineno-36-20"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">calls</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">calls</span><span class="p">[</span><span class="s1">&#39;strike&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">k</span><span class="p">][</span><span class="s1">&#39;bid&#39;</span><span class="p">]</span>
<a id="__codelineno-36-21" name="__codelineno-36-21" href="#__codelineno-36-21"></a>            <span class="n">bid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calls</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">calls</span><span class="p">[</span><span class="s1">&#39;strike&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">k</span><span class="p">][</span><span class="s1">&#39;bid&#39;</span><span class="p">]</span>
<a id="__codelineno-36-22" name="__codelineno-36-22" href="#__codelineno-36-22"></a>            <span class="n">ask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calls</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">calls</span><span class="p">[</span><span class="s1">&#39;strike&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">k</span><span class="p">][</span><span class="s1">&#39;ask&#39;</span><span class="p">]</span>
<a id="__codelineno-36-23" name="__codelineno-36-23" href="#__codelineno-36-23"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mids_call</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">mids_call</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">bid</span> <span class="o">+</span> <span class="n">ask</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)])</span>
<a id="__codelineno-36-24" name="__codelineno-36-24" href="#__codelineno-36-24"></a>
<a id="__codelineno-36-25" name="__codelineno-36-25" href="#__codelineno-36-25"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mids_put</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<a id="__codelineno-36-26" name="__codelineno-36-26" href="#__codelineno-36-26"></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ks</span><span class="p">:</span>
<a id="__codelineno-36-27" name="__codelineno-36-27" href="#__codelineno-36-27"></a>            <span class="n">bid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">puts</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">puts</span><span class="p">[</span><span class="s1">&#39;strike&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">k</span><span class="p">][</span><span class="s1">&#39;bid&#39;</span><span class="p">]</span>
<a id="__codelineno-36-28" name="__codelineno-36-28" href="#__codelineno-36-28"></a>            <span class="n">ask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">puts</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">puts</span><span class="p">[</span><span class="s1">&#39;strike&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">k</span><span class="p">][</span><span class="s1">&#39;ask&#39;</span><span class="p">]</span>
<a id="__codelineno-36-29" name="__codelineno-36-29" href="#__codelineno-36-29"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mids_put</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">mids_put</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">bid</span> <span class="o">+</span> <span class="n">ask</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)])</span>
<a id="__codelineno-36-30" name="__codelineno-36-30" href="#__codelineno-36-30"></a>
<a id="__codelineno-36-31" name="__codelineno-36-31" href="#__codelineno-36-31"></a>        <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imp_vols</span><span class="p">()</span>
<a id="__codelineno-36-32" name="__codelineno-36-32" href="#__codelineno-36-32"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ivs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_adj</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;imp_vols&#39;</span><span class="p">],</span> <span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;s_adj&#39;</span><span class="p">]</span>
<a id="__codelineno-36-33" name="__codelineno-36-33" href="#__codelineno-36-33"></a>
<a id="__codelineno-36-34" name="__codelineno-36-34" href="#__codelineno-36-34"></a>    <span class="c1"># put-call parity plot </span>
<a id="__codelineno-36-35" name="__codelineno-36-35" href="#__codelineno-36-35"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_parity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-36-36" name="__codelineno-36-36" href="#__codelineno-36-36"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<a id="__codelineno-36-37" name="__codelineno-36-37" href="#__codelineno-36-37"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ks</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mids_call</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mids_put</span><span class="p">,</span> <span class="s1">&#39;r.--&#39;</span><span class="p">)</span>
<a id="__codelineno-36-38" name="__codelineno-36-38" href="#__codelineno-36-38"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$C - P$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-36-39" name="__codelineno-36-39" href="#__codelineno-36-39"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$K$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-36-40" name="__codelineno-36-40" href="#__codelineno-36-40"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Expiry: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">expiry</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">);</span>
<a id="__codelineno-36-41" name="__codelineno-36-41" href="#__codelineno-36-41"></a>        <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-36-42" name="__codelineno-36-42" href="#__codelineno-36-42"></a>
<a id="__codelineno-36-43" name="__codelineno-36-43" href="#__codelineno-36-43"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_arb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-36-44" name="__codelineno-36-44" href="#__codelineno-36-44"></a>        <span class="c1"># monotonicity and convexity for option premia vs strikes</span>
<a id="__codelineno-36-45" name="__codelineno-36-45" href="#__codelineno-36-45"></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-36-46" name="__codelineno-36-46" href="#__codelineno-36-46"></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ks_c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">,</span> <span class="s1">&#39;bo--&#39;</span><span class="p">)</span>
<a id="__codelineno-36-47" name="__codelineno-36-47" href="#__codelineno-36-47"></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Option mid price&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-36-48" name="__codelineno-36-48" href="#__codelineno-36-48"></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Strike&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-36-49" name="__codelineno-36-49" href="#__codelineno-36-49"></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ks_p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ps</span><span class="p">,</span> <span class="s1">&#39;ro--&#39;</span><span class="p">)</span>
<a id="__codelineno-36-50" name="__codelineno-36-50" href="#__codelineno-36-50"></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Strike&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">);</span>
<a id="__codelineno-36-51" name="__codelineno-36-51" href="#__codelineno-36-51"></a>        <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-36-52" name="__codelineno-36-52" href="#__codelineno-36-52"></a>
<a id="__codelineno-36-53" name="__codelineno-36-53" href="#__codelineno-36-53"></a>    <span class="c1"># plot implied vol</span>
<a id="__codelineno-36-54" name="__codelineno-36-54" href="#__codelineno-36-54"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_imp_vols1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-36-55" name="__codelineno-36-55" href="#__codelineno-36-55"></a>        <span class="n">ivs_c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calls</span><span class="p">[</span><span class="s1">&#39;impliedVolatility&#39;</span><span class="p">]</span>
<a id="__codelineno-36-56" name="__codelineno-36-56" href="#__codelineno-36-56"></a>        <span class="n">ivs_p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">puts</span><span class="p">[</span><span class="s1">&#39;impliedVolatility&#39;</span><span class="p">]</span>
<a id="__codelineno-36-57" name="__codelineno-36-57" href="#__codelineno-36-57"></a>        <span class="c1"># plot </span>
<a id="__codelineno-36-58" name="__codelineno-36-58" href="#__codelineno-36-58"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-36-59" name="__codelineno-36-59" href="#__codelineno-36-59"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ks_p</span><span class="p">,</span> <span class="n">ivs_p</span><span class="p">,</span> <span class="s1">&#39;ro--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;implied vol from puts&#39;</span><span class="p">)</span>
<a id="__codelineno-36-60" name="__codelineno-36-60" href="#__codelineno-36-60"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ks_c</span><span class="p">,</span> <span class="n">ivs_c</span><span class="p">,</span> <span class="s1">&#39;bo--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;implied vol from calls&#39;</span><span class="p">)</span>
<a id="__codelineno-36-61" name="__codelineno-36-61" href="#__codelineno-36-61"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Expiration date: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">expiry</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<a id="__codelineno-36-62" name="__codelineno-36-62" href="#__codelineno-36-62"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Strikes&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-36-63" name="__codelineno-36-63" href="#__codelineno-36-63"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Impliied Volatilities&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-36-64" name="__codelineno-36-64" href="#__codelineno-36-64"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
<a id="__codelineno-36-65" name="__codelineno-36-65" href="#__codelineno-36-65"></a>        <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-36-66" name="__codelineno-36-66" href="#__codelineno-36-66"></a>
<a id="__codelineno-36-67" name="__codelineno-36-67" href="#__codelineno-36-67"></a>    <span class="c1"># Black-Scholes formula for call</span>
<a id="__codelineno-36-68" name="__codelineno-36-68" href="#__codelineno-36-68"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">bs_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<a id="__codelineno-36-69" name="__codelineno-36-69" href="#__codelineno-36-69"></a>        <span class="n">d1</span> <span class="o">=</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">s</span><span class="o">/</span><span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="n">r</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">sigma</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">))</span> <span class="o">+</span> <span class="n">sigma</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
<a id="__codelineno-36-70" name="__codelineno-36-70" href="#__codelineno-36-70"></a>        <span class="n">d2</span> <span class="o">=</span> <span class="n">d1</span> <span class="o">-</span> <span class="n">sigma</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<a id="__codelineno-36-71" name="__codelineno-36-71" href="#__codelineno-36-71"></a>        <span class="k">return</span> <span class="n">s</span><span class="o">*</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span> <span class="o">-</span> <span class="n">K</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span>
<a id="__codelineno-36-72" name="__codelineno-36-72" href="#__codelineno-36-72"></a>
<a id="__codelineno-36-73" name="__codelineno-36-73" href="#__codelineno-36-73"></a>    <span class="c1"># function calculating implied vol by the bisection method</span>
<a id="__codelineno-36-74" name="__codelineno-36-74" href="#__codelineno-36-74"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">bs_impvol_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s0</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<a id="__codelineno-36-75" name="__codelineno-36-75" href="#__codelineno-36-75"></a>        <span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">K</span><span class="p">])</span>
<a id="__codelineno-36-76" name="__codelineno-36-76" href="#__codelineno-36-76"></a>        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
<a id="__codelineno-36-77" name="__codelineno-36-77" href="#__codelineno-36-77"></a>        <span class="n">sigmaL</span><span class="p">,</span> <span class="n">sigmaH</span> <span class="o">=</span> <span class="mf">1e-10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-36-78" name="__codelineno-36-78" href="#__codelineno-36-78"></a>        <span class="n">CL</span><span class="p">,</span> <span class="n">CH</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bs_call</span><span class="p">(</span><span class="n">s0</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">sigmaL</span><span class="p">,</span> <span class="n">r</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">bs_call</span><span class="p">(</span><span class="n">s0</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">sigmaH</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
<a id="__codelineno-36-79" name="__codelineno-36-79" href="#__codelineno-36-79"></a>        <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sigmaH</span> <span class="o">-</span> <span class="n">sigmaL</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-10</span><span class="p">:</span>
<a id="__codelineno-36-80" name="__codelineno-36-80" href="#__codelineno-36-80"></a>            <span class="n">sigma</span> <span class="o">=</span> <span class="p">(</span><span class="n">sigmaL</span> <span class="o">+</span> <span class="n">sigmaH</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
<a id="__codelineno-36-81" name="__codelineno-36-81" href="#__codelineno-36-81"></a>            <span class="n">CM</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bs_call</span><span class="p">(</span><span class="n">s0</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
<a id="__codelineno-36-82" name="__codelineno-36-82" href="#__codelineno-36-82"></a>            <span class="n">CL</span> <span class="o">=</span> <span class="n">CL</span> <span class="o">+</span> <span class="p">(</span><span class="n">CM</span> <span class="o">&lt;</span> <span class="n">C</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">CM</span> <span class="o">-</span> <span class="n">CL</span><span class="p">)</span>
<a id="__codelineno-36-83" name="__codelineno-36-83" href="#__codelineno-36-83"></a>            <span class="n">sigmaL</span> <span class="o">=</span> <span class="n">sigmaL</span> <span class="o">+</span> <span class="p">(</span><span class="n">CM</span> <span class="o">&lt;</span> <span class="n">C</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">sigma</span> <span class="o">-</span> <span class="n">sigmaL</span><span class="p">)</span>
<a id="__codelineno-36-84" name="__codelineno-36-84" href="#__codelineno-36-84"></a>            <span class="n">CH</span> <span class="o">=</span> <span class="n">CH</span> <span class="o">+</span> <span class="p">(</span><span class="n">CM</span> <span class="o">&gt;=</span> <span class="n">C</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">CM</span> <span class="o">-</span> <span class="n">CH</span><span class="p">)</span>
<a id="__codelineno-36-85" name="__codelineno-36-85" href="#__codelineno-36-85"></a>            <span class="n">sigmaH</span> <span class="o">=</span> <span class="n">sigmaH</span> <span class="o">+</span> <span class="p">(</span><span class="n">CM</span> <span class="o">&gt;=</span> <span class="n">C</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">sigma</span> <span class="o">-</span> <span class="n">sigmaH</span><span class="p">)</span>    
<a id="__codelineno-36-86" name="__codelineno-36-86" href="#__codelineno-36-86"></a>        <span class="k">return</span> <span class="n">sigma</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-36-87" name="__codelineno-36-87" href="#__codelineno-36-87"></a>
<a id="__codelineno-36-88" name="__codelineno-36-88" href="#__codelineno-36-88"></a>    <span class="c1"># calculate implied vols</span>
<a id="__codelineno-36-89" name="__codelineno-36-89" href="#__codelineno-36-89"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">imp_vols</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-36-90" name="__codelineno-36-90" href="#__codelineno-36-90"></a>        <span class="c1"># regress call - put over strike K </span>
<a id="__codelineno-36-91" name="__codelineno-36-91" href="#__codelineno-36-91"></a>        <span class="c1"># apply put-call parity </span>
<a id="__codelineno-36-92" name="__codelineno-36-92" href="#__codelineno-36-92"></a>        <span class="n">df</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;CP&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mids_call</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mids_put</span><span class="p">,</span> <span class="s1">&#39;Strike&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ks</span><span class="p">}</span>
<a id="__codelineno-36-93" name="__codelineno-36-93" href="#__codelineno-36-93"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="s1">&#39;CP ~ Strike&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<a id="__codelineno-36-94" name="__codelineno-36-94" href="#__codelineno-36-94"></a>        <span class="n">s_adj</span><span class="p">,</span> <span class="n">pv</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-36-95" name="__codelineno-36-95" href="#__codelineno-36-95"></a>        <span class="n">ks_pv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ks</span><span class="o">*</span><span class="n">pv</span>
<a id="__codelineno-36-96" name="__codelineno-36-96" href="#__codelineno-36-96"></a>        <span class="n">days_to_expiry</span> <span class="o">=</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expiry</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">today</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
<a id="__codelineno-36-97" name="__codelineno-36-97" href="#__codelineno-36-97"></a>        <span class="n">imp_vols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bs_impvol_call</span><span class="p">(</span><span class="n">s_adj</span><span class="p">,</span> <span class="n">ks_pv</span><span class="p">,</span> <span class="n">days_to_expiry</span><span class="o">/</span><span class="mi">365</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mids_call</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>        
<a id="__codelineno-36-98" name="__codelineno-36-98" href="#__codelineno-36-98"></a>        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;imp_vols&#39;</span><span class="p">:</span> <span class="n">imp_vols</span><span class="p">,</span> <span class="s1">&#39;pv&#39;</span><span class="p">:</span> <span class="n">pv</span><span class="p">,</span> <span class="s1">&#39;s_adj&#39;</span><span class="p">:</span> <span class="n">s_adj</span><span class="p">}</span>
<a id="__codelineno-36-99" name="__codelineno-36-99" href="#__codelineno-36-99"></a>
<a id="__codelineno-36-100" name="__codelineno-36-100" href="#__codelineno-36-100"></a>    <span class="c1"># plot implied vol</span>
<a id="__codelineno-36-101" name="__codelineno-36-101" href="#__codelineno-36-101"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_imp_vols2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-36-102" name="__codelineno-36-102" href="#__codelineno-36-102"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-36-103" name="__codelineno-36-103" href="#__codelineno-36-103"></a>        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ivs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ivs</span><span class="o">&gt;</span><span class="mf">0.001</span><span class="p">]</span>
<a id="__codelineno-36-104" name="__codelineno-36-104" href="#__codelineno-36-104"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ks</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ivs</span><span class="o">&gt;</span><span class="mf">0.001</span><span class="p">]</span>
<a id="__codelineno-36-105" name="__codelineno-36-105" href="#__codelineno-36-105"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">s_adj</span><span class="p">),</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;b.--&#39;</span><span class="p">)</span>
<a id="__codelineno-36-106" name="__codelineno-36-106" href="#__codelineno-36-106"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">s_adj</span><span class="p">),</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;r.&#39;</span><span class="p">)</span>
<a id="__codelineno-36-107" name="__codelineno-36-107" href="#__codelineno-36-107"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;logmoneyness&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-36-108" name="__codelineno-36-108" href="#__codelineno-36-108"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;implied volatilities&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-36-109" name="__codelineno-36-109" href="#__codelineno-36-109"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Implied volatilities vs Logmoneyness&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">);</span>
<a id="__codelineno-36-110" name="__codelineno-36-110" href="#__codelineno-36-110"></a>        <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-36-111" name="__codelineno-36-111" href="#__codelineno-36-111"></a>
<a id="__codelineno-36-112" name="__codelineno-36-112" href="#__codelineno-36-112"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-36-113" name="__codelineno-36-113" href="#__codelineno-36-113"></a>        <span class="k">pass</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="n">expiry</span> <span class="o">=</span> <span class="s1">&#39;2022-08-26&#39;</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="n">today</span> <span class="o">=</span> <span class="s1">&#39;2022-07-25&#39;</span>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="c1"># today = dt.now()</span>
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="n">spx_opt</span> <span class="o">=</span> <span class="n">OptionAnalytics</span><span class="p">([</span><span class="n">spx_calls</span><span class="p">,</span> <span class="n">spx_puts</span><span class="p">],</span> <span class="n">expiry</span><span class="p">,</span> <span class="n">today</span><span class="p">)</span>
<a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a><span class="c1">#spx_opt = OptionAnalytics([spx_calls, spx_puts], spx_expiries[idx])</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>/var/folders/3h/357vtvkn1294nqc0jtg6lmw40000gn/T/ipykernel_72493/903028481.py:94: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  s_adj, pv = result.params[0], -result.params[1]
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="n">spx_opt</span><span class="o">.</span><span class="n">plot_arb</span><span class="p">()</span>
</code></pre></div>
<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-5/volatility_53_0.png" />
​    </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="n">spx_opt</span><span class="o">.</span><span class="n">plot_parity</span><span class="p">()</span>
</code></pre></div>
<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-5/volatility_54_0.png" />
​    </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="n">spx_opt</span><span class="o">.</span><span class="n">s_adj</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>np.float64(3956.9116921934437)
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="n">spx_opt</span><span class="o">.</span><span class="n">imp_vols</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>/var/folders/3h/357vtvkn1294nqc0jtg6lmw40000gn/T/ipykernel_72493/903028481.py:94: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  s_adj, pv = result.params[0], -result.params[1]





{&#39;imp_vols&#39;: array([0.30600045, 0.30595555, 0.2977905 , 0.29545201, 0.28072122,
        0.28232929, 0.2760224 , 0.27571335, 0.26859412, 0.26908309,
        0.27284159, 0.2708769 , 0.26853801, 0.26566743, 0.26527454,
        0.26282943, 0.26242285, 0.2594965 , 0.25959885, 0.25941643,
        0.25750019, 0.25653246, 0.25254566, 0.25387708, 0.25385611,
        0.2507587 , 0.25183417, 0.24960497, 0.24816526, 0.24549749,
        0.2473746 , 0.24511455, 0.24306506, 0.24344569, 0.24239335,
        0.2381772 , 0.23923107, 0.23911993, 0.23822523, 0.23924822,
        0.23345209, 0.23237829, 0.2344444 , 0.23344536, 0.22909791,
        0.22899399, 0.23093383, 0.23010241, 0.22853441, 0.22734051,
        0.22629503, 0.22473931, 0.22267772, 0.22467133, 0.22094489,
        0.22158022, 0.22029972, 0.21894173, 0.22040126, 0.21866736,
        0.21803138, 0.21752707, 0.21522827, 0.21498524, 0.21433691,
        0.21338911, 0.21299896, 0.20983357, 0.21131474, 0.20839273,
        0.20862321, 0.20877018, 0.20719259, 0.20584517, 0.20362794,
        0.20224901, 0.20071144, 0.20063567, 0.19902292, 0.19711411,
        0.19699863, 0.19436676, 0.1925327 , 0.18606077, 0.18129871,
        0.1965902 , 0.22174679]),
 &#39;pv&#39;: np.float64(0.9978522732469031),
 &#39;s_adj&#39;: np.float64(3956.9116921934437)}
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="n">spx_opt</span><span class="o">.</span><span class="n">plot_imp_vols2</span><span class="p">(),</span> <span class="n">spx_opt</span><span class="o">.</span><span class="n">plot_imp_vols1</span><span class="p">();</span>
</code></pre></div>
<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-5/volatility_57_0.png" />
​    </p>
<p><img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-5/volatility_57_1.png" /></p>
<h2 id="a-shorter-time-to-expiry-option-on-spx">A shorter time to expiry option on SPX<a class="headerlink" href="#a-shorter-time-to-expiry-option-on-spx" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="c1"># choose an expiry </span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="n">idx</span> <span class="o">=</span> <span class="mi">5</span>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="n">today</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="n">day_count</span> <span class="o">=</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">spx_expiries</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">())</span><span class="o">.</span><span class="n">days</span>
<a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;option expiry = </span><span class="si">{</span><span class="n">spx_expiries</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="si">}</span><span class="s1">, today = </span><span class="si">{</span><span class="n">today</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;There are </span><span class="si">{</span><span class="n">day_count</span><span class="si">}</span><span class="s1"> days to expiry&#39;</span><span class="p">)</span>
<a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a><span class="n">option_chain</span> <span class="o">=</span> <span class="n">spx</span><span class="o">.</span><span class="n">option_chain</span><span class="p">(</span><span class="n">spx_expiries</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
<a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a><span class="n">spx_calls1</span> <span class="o">=</span> <span class="n">option_chain</span><span class="o">.</span><span class="n">calls</span>
<a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a><span class="n">spx_puts1</span> <span class="o">=</span> <span class="n">option_chain</span><span class="o">.</span><span class="n">puts</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>option expiry = 2024-08-05, today = 2024-07-28
There are 7 days to expiry
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="c1"># clean data</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="n">spx_calls1</span> <span class="o">=</span> <span class="n">spx_calls1</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="n">spx_calls1</span> <span class="o">=</span> <span class="n">spx_calls1</span><span class="p">[(</span><span class="n">spx_calls1</span><span class="p">[</span><span class="s1">&#39;bid&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">spx_calls1</span><span class="p">[</span><span class="s1">&#39;ask&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]</span>
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="n">spx_puts1</span> <span class="o">=</span> <span class="n">spx_puts1</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="n">spx_puts1</span> <span class="o">=</span> <span class="n">spx_puts1</span><span class="p">[(</span><span class="n">spx_puts1</span><span class="p">[</span><span class="s1">&#39;bid&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">spx_puts1</span><span class="p">[</span><span class="s1">&#39;ask&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="n">today</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="n">spx_opt1</span> <span class="o">=</span> <span class="n">OptionAnalytics</span><span class="p">([</span><span class="n">spx_calls1</span><span class="p">,</span> <span class="n">spx_puts1</span><span class="p">],</span> <span class="n">spx_expiries</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">today</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>/var/folders/3h/357vtvkn1294nqc0jtg6lmw40000gn/T/ipykernel_72493/903028481.py:94: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  s_adj, pv = result.params[0], -result.params[1]
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="n">spx_opt1</span><span class="o">.</span><span class="n">plot_arb</span><span class="p">()</span>
</code></pre></div>
<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-5/volatility_62_0.png" />
​    </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="n">spx_opt1</span><span class="o">.</span><span class="n">plot_parity</span><span class="p">()</span>
</code></pre></div>
<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-5/volatility_63_0.png" />
​    </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="n">spx_opt</span><span class="o">.</span><span class="n">imp_vols</span><span class="p">()[</span><span class="s1">&#39;pv&#39;</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>/var/folders/3h/357vtvkn1294nqc0jtg6lmw40000gn/T/ipykernel_72493/903028481.py:94: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  s_adj, pv = result.params[0], -result.params[1]





np.float64(0.9978522732469031)
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="n">spx_opt1</span><span class="o">.</span><span class="n">s_adj</span><span class="p">,</span> <span class="n">spx_opt1</span><span class="o">.</span><span class="n">imp_vols</span><span class="p">()[</span><span class="s1">&#39;pv&#39;</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>/var/folders/3h/357vtvkn1294nqc0jtg6lmw40000gn/T/ipykernel_72493/903028481.py:94: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  s_adj, pv = result.params[0], -result.params[1]





(np.float64(5461.021617405575), np.float64(0.9988536359480314))
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="n">spx_opt1</span><span class="o">.</span><span class="n">plot_imp_vols2</span><span class="p">(),</span> <span class="n">spx_opt1</span><span class="o">.</span><span class="n">plot_imp_vols1</span><span class="p">();</span>
</code></pre></div>
<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-5/volatility_66_0.png" />
​    </p>
<p><img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-5/volatility_66_1.png" /></p>
<h2 id="gpr-fit-for-spx-implied-volatility-curve">GPR fit for SPX implied volatility curve<a class="headerlink" href="#gpr-fit-for-spx-implied-volatility-curve" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="c1"># The posterior mean function from GPR</span>
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="c1"># inputs: </span>
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="c1"># m: prior mean function </span>
<a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="c1"># k: prior kernel</span>
<a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="c1"># y: observations</span>
<a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a><span class="c1"># x: indices</span>
<a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a><span class="c1"># </span>
<a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a><span class="c1"># output: the posterior mean function</span>
<a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a>
<a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a><span class="k">def</span><span class="w"> </span><span class="nf">pos_mean</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.001</span><span class="p">):</span>
<a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a>    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a>
<a id="__codelineno-51-13" name="__codelineno-51-13" href="#__codelineno-51-13"></a>    <span class="c1"># calculate the covariance matrices</span>
<a id="__codelineno-51-14" name="__codelineno-51-14" href="#__codelineno-51-14"></a>    <span class="n">tmp</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-51-15" name="__codelineno-51-15" href="#__codelineno-51-15"></a>    <span class="n">Sigma_YY</span> <span class="o">=</span> <span class="n">k</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span>
<a id="__codelineno-51-16" name="__codelineno-51-16" href="#__codelineno-51-16"></a>    <span class="n">Sigma_YY</span> <span class="o">=</span> <span class="n">Sigma_YY</span> <span class="o">+</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-51-17" name="__codelineno-51-17" href="#__codelineno-51-17"></a>
<a id="__codelineno-51-18" name="__codelineno-51-18" href="#__codelineno-51-18"></a>    <span class="c1"># determine Sigma_YY_inv(Y - EY) by solving the linear system Sigma_YY x = Y - EY</span>
<a id="__codelineno-51-19" name="__codelineno-51-19" href="#__codelineno-51-19"></a>    <span class="n">Sigma_YY_inv_Y_EY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">Sigma_YY</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">m</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<a id="__codelineno-51-20" name="__codelineno-51-20" href="#__codelineno-51-20"></a>
<a id="__codelineno-51-21" name="__codelineno-51-21" href="#__codelineno-51-21"></a>    <span class="c1"># return the posterior mean function</span>
<a id="__codelineno-51-22" name="__codelineno-51-22" href="#__codelineno-51-22"></a>    <span class="k">return</span> <span class="k">lambda</span> <span class="n">xx</span><span class="p">:</span> <span class="n">m</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">Sigma_YY_inv_Y_EY</span><span class="p">)</span>
<a id="__codelineno-51-23" name="__codelineno-51-23" href="#__codelineno-51-23"></a>
<a id="__codelineno-51-24" name="__codelineno-51-24" href="#__codelineno-51-24"></a>
<a id="__codelineno-51-25" name="__codelineno-51-25" href="#__codelineno-51-25"></a><span class="c1"># The posterior kernel from GPR</span>
<a id="__codelineno-51-26" name="__codelineno-51-26" href="#__codelineno-51-26"></a><span class="c1"># inputs: </span>
<a id="__codelineno-51-27" name="__codelineno-51-27" href="#__codelineno-51-27"></a><span class="c1"># k: prior kernel</span>
<a id="__codelineno-51-28" name="__codelineno-51-28" href="#__codelineno-51-28"></a><span class="c1"># x: indices</span>
<a id="__codelineno-51-29" name="__codelineno-51-29" href="#__codelineno-51-29"></a><span class="c1"># </span>
<a id="__codelineno-51-30" name="__codelineno-51-30" href="#__codelineno-51-30"></a><span class="c1"># output: the posterior kernel</span>
<a id="__codelineno-51-31" name="__codelineno-51-31" href="#__codelineno-51-31"></a>
<a id="__codelineno-51-32" name="__codelineno-51-32" href="#__codelineno-51-32"></a><span class="k">def</span><span class="w"> </span><span class="nf">pos_kernel</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
<a id="__codelineno-51-33" name="__codelineno-51-33" href="#__codelineno-51-33"></a>    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-51-34" name="__codelineno-51-34" href="#__codelineno-51-34"></a>
<a id="__codelineno-51-35" name="__codelineno-51-35" href="#__codelineno-51-35"></a>    <span class="c1"># calculate the covariance matrices</span>
<a id="__codelineno-51-36" name="__codelineno-51-36" href="#__codelineno-51-36"></a>    <span class="n">tmp</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-51-37" name="__codelineno-51-37" href="#__codelineno-51-37"></a>    <span class="n">Sigma_YY</span> <span class="o">=</span> <span class="n">k</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span>
<a id="__codelineno-51-38" name="__codelineno-51-38" href="#__codelineno-51-38"></a>    <span class="n">Sigma_YY</span> <span class="o">=</span> <span class="n">Sigma_YY</span> <span class="o">+</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-51-39" name="__codelineno-51-39" href="#__codelineno-51-39"></a>
<a id="__codelineno-51-40" name="__codelineno-51-40" href="#__codelineno-51-40"></a>    <span class="c1"># return the posterior kernel</span>
<a id="__codelineno-51-41" name="__codelineno-51-41" href="#__codelineno-51-41"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">xp</span><span class="p">):</span>
<a id="__codelineno-51-42" name="__codelineno-51-42" href="#__codelineno-51-42"></a>        <span class="c1"># determine Sigma_YY_inv Sigma_Yxp by solving the linear system Sigma_YY x = Sigma_Yxp</span>
<a id="__codelineno-51-43" name="__codelineno-51-43" href="#__codelineno-51-43"></a>        <span class="n">Sigma_YY_inv_Yxp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">Sigma_YY</span><span class="p">,</span> <span class="n">k</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
<a id="__codelineno-51-44" name="__codelineno-51-44" href="#__codelineno-51-44"></a>        <span class="n">Sigma_xY</span> <span class="o">=</span> <span class="n">k</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-51-45" name="__codelineno-51-45" href="#__codelineno-51-45"></a>        <span class="k">return</span> <span class="n">k</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">xp</span><span class="p">)</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">Sigma_xY</span><span class="o">*</span><span class="n">Sigma_YY_inv_Yxp</span><span class="p">)</span>
<a id="__codelineno-51-46" name="__codelineno-51-46" href="#__codelineno-51-46"></a>
<a id="__codelineno-51-47" name="__codelineno-51-47" href="#__codelineno-51-47"></a>    <span class="k">return</span> <span class="n">_</span> 
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="n">imp_vols</span> <span class="o">=</span> <span class="n">spx_opt</span><span class="o">.</span><span class="n">ivs</span>
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="n">logmnyns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">spx_opt</span><span class="o">.</span><span class="n">ks</span><span class="o">/</span><span class="n">spx_opt</span><span class="o">.</span><span class="n">s_adj</span><span class="p">)</span>
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a>
<a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="c1"># set hyperparameters by guessing</span>
<a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a><span class="n">A</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.01</span>
<a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a>
<a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a><span class="c1"># prior mean function</span>
<a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a><span class="c1"># set prior mean as sample mean of implied vols</span>
<a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a><span class="n">iv_mean</span> <span class="o">=</span> <span class="n">imp_vols</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-52-10" name="__codelineno-52-10" href="#__codelineno-52-10"></a><span class="n">mpr</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">iv_mean</span>
<a id="__codelineno-52-11" name="__codelineno-52-11" href="#__codelineno-52-11"></a>
<a id="__codelineno-52-12" name="__codelineno-52-12" href="#__codelineno-52-12"></a><span class="c1"># prior kernel</span>
<a id="__codelineno-52-13" name="__codelineno-52-13" href="#__codelineno-52-13"></a><span class="n">k</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">A</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">l</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-52-14" name="__codelineno-52-14" href="#__codelineno-52-14"></a>
<a id="__codelineno-52-15" name="__codelineno-52-15" href="#__codelineno-52-15"></a><span class="c1"># indices and observations</span>
<a id="__codelineno-52-16" name="__codelineno-52-16" href="#__codelineno-52-16"></a><span class="n">x_is</span> <span class="o">=</span> <span class="n">logmnyns</span>
<a id="__codelineno-52-17" name="__codelineno-52-17" href="#__codelineno-52-17"></a><span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_is</span><span class="p">)</span>
<a id="__codelineno-52-18" name="__codelineno-52-18" href="#__codelineno-52-18"></a><span class="n">y_is</span> <span class="o">=</span> <span class="n">imp_vols</span>
<a id="__codelineno-52-19" name="__codelineno-52-19" href="#__codelineno-52-19"></a>
<a id="__codelineno-52-20" name="__codelineno-52-20" href="#__codelineno-52-20"></a><span class="c1"># posterior mean function for implied vol</span>
<a id="__codelineno-52-21" name="__codelineno-52-21" href="#__codelineno-52-21"></a><span class="n">mpo_iv</span> <span class="o">=</span> <span class="n">pos_mean</span><span class="p">(</span><span class="n">mpr</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">y_is</span><span class="p">,</span> <span class="n">x_is</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">)</span>
<a id="__codelineno-52-22" name="__codelineno-52-22" href="#__codelineno-52-22"></a><span class="n">mpo_iv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">mpo_iv</span><span class="p">)</span>
<a id="__codelineno-52-23" name="__codelineno-52-23" href="#__codelineno-52-23"></a><span class="n">mpo_iv</span><span class="p">(</span><span class="n">x_is</span><span class="p">)</span>
<a id="__codelineno-52-24" name="__codelineno-52-24" href="#__codelineno-52-24"></a>
<a id="__codelineno-52-25" name="__codelineno-52-25" href="#__codelineno-52-25"></a>
<a id="__codelineno-52-26" name="__codelineno-52-26" href="#__codelineno-52-26"></a><span class="c1"># fitted values</span>
<a id="__codelineno-52-27" name="__codelineno-52-27" href="#__codelineno-52-27"></a><span class="n">iv_hat</span> <span class="o">=</span> <span class="n">mpo_iv</span><span class="p">(</span><span class="n">x_is</span><span class="p">)</span>
<a id="__codelineno-52-28" name="__codelineno-52-28" href="#__codelineno-52-28"></a><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">y_is</span><span class="p">,</span> <span class="n">iv_hat</span><span class="p">)</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div style="overflow-x: auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0.307461</th>
      <td>0.306000</td>
    </tr>
    <tr>
      <th>0.299448</th>
      <td>0.305956</td>
    </tr>
    <tr>
      <th>0.298590</th>
      <td>0.297790</td>
    </tr>
    <tr>
      <th>0.294401</th>
      <td>0.295452</td>
    </tr>
    <tr>
      <th>0.288030</th>
      <td>0.280721</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>0.192479</th>
      <td>0.192533</td>
    </tr>
    <tr>
      <th>0.185995</th>
      <td>0.186061</td>
    </tr>
    <tr>
      <th>0.181538</th>
      <td>0.181299</td>
    </tr>
    <tr>
      <th>0.196908</th>
      <td>0.196590</td>
    </tr>
    <tr>
      <th>0.221521</th>
      <td>0.221747</td>
    </tr>
  </tbody>
</table>
<p>87 rows × 1 columns</p>
</div>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="c1"># plot </span>
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_is</span><span class="p">,</span> <span class="n">y_is</span><span class="p">,</span> <span class="s1">&#39;bo&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Market data&#39;</span><span class="p">)</span>
<a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;logmoneyness&#39;</span><span class="p">)</span>
<a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;implied vol&#39;</span><span class="p">)</span>
<a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_is</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">x_is</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">200</span><span class="p">)</span>
<a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mpo_iv</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;GPR fit&#39;</span><span class="p">)</span>
<a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</code></pre></div>
<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-5/volatility_70_0.png" />
​    </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="c1"># analysis on absolute errors </span>
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="n">abs_errs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">iv_hat</span> <span class="o">-</span> <span class="n">y_is</span><span class="p">)</span>
<a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_is</span><span class="p">,</span> <span class="n">abs_errs</span><span class="p">,</span> <span class="s1">&#39;bo&#39;</span><span class="p">)</span>
<a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;logmoneyness&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span> 
<a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;errors&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">abs_errs</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div style="overflow-x: auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>87.0</td>
      <td>0.001156</td>
      <td>0.001303</td>
      <td>0.000011</td>
      <td>0.000347</td>
      <td>0.000829</td>
      <td>0.001325</td>
      <td>0.007309</td>
    </tr>
  </tbody>
</table>
</div>
</div>

<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-5/volatility_71_1.png" />
​    </p>
<h3 id="fine-tune-hyperparameters-by-mle">Fine tune hyperparameters by MLE<a class="headerlink" href="#fine-tune-hyperparameters-by-mle" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="c1"># estimate the hyperparameters by MLE</span>
<a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a>
<a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="c1"># objective function</span>
<a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">obj</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
<a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a>        <span class="n">A</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">params</span>
<a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a>        <span class="n">k</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">A</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">u</span><span class="o">-</span><span class="n">v</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">l</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a>        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a>        <span class="c1"># calculate the covariance matrices</span>
<a id="__codelineno-55-10" name="__codelineno-55-10" href="#__codelineno-55-10"></a>        <span class="n">tmp</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-55-11" name="__codelineno-55-11" href="#__codelineno-55-11"></a>        <span class="n">Sigma_YY</span> <span class="o">=</span> <span class="n">k</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span>
<a id="__codelineno-55-12" name="__codelineno-55-12" href="#__codelineno-55-12"></a>        <span class="n">Sigma_YY</span> <span class="o">=</span> <span class="n">Sigma_YY</span> <span class="o">+</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-55-13" name="__codelineno-55-13" href="#__codelineno-55-13"></a>        <span class="n">Sigma_YY_inv_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">Sigma_YY</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>        
<a id="__codelineno-55-14" name="__codelineno-55-14" href="#__codelineno-55-14"></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">Sigma_YY</span><span class="p">))</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">y</span><span class="o">*</span><span class="n">Sigma_YY_inv_y</span><span class="p">)</span> <span class="c1">#this is in fact negative log likelihood</span>
<a id="__codelineno-55-15" name="__codelineno-55-15" href="#__codelineno-55-15"></a>    <span class="k">return</span> <span class="n">_</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">minimize</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="o">%%</span><span class="n">time</span>
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="c1"># minimize objective function</span>
<a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="p">(</span><span class="n">x_is</span><span class="p">,</span> <span class="n">y_is</span><span class="p">)([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]))</span>
<a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a><span class="n">pars</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
<a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a><span class="n">res</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">obj</span><span class="p">(</span><span class="n">x_is</span><span class="p">,</span> <span class="n">y_is</span><span class="p">),</span> <span class="n">pars</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nelder-mead&#39;</span><span class="p">,</span> 
<a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a>               <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;xatol&#39;</span><span class="p">:</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="s1">&#39;disp&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span> 
<a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a><span class="n">hyparams</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span>
<a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a><span class="n">hyparams</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>-381.2423169273305


/var/folders/3h/357vtvkn1294nqc0jtg6lmw40000gn/T/ipykernel_72493/1457444304.py:14: RuntimeWarning: divide by zero encountered in log
  return np.log(np.linalg.det(Sigma_YY)) + sum(y*Sigma_YY_inv_y) #this is in fact negative log likelihood
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/scipy/optimize/_optimize.py:835: RuntimeWarning: invalid value encountered in subtract
  np.max(np.abs(fsim[0] - fsim[1:])) &lt;= fatol):


CPU times: user 421 ms, sys: 149 ms, total: 569 ms
Wall time: 423 ms


&lt;timed exec&gt;:4: RuntimeWarning: Maximum number of function evaluations has been exceeded.





array([ 0.13481481,  0.16574074, -0.00740741])
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="c1"># hyperparameters estimated from MLE</span>
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="n">A</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">hyparams</span>
<a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a>
<a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a><span class="c1"># prior mean function</span>
<a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a><span class="c1"># set prior mean as sample mean of implied vols</span>
<a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a><span class="n">iv_mean</span> <span class="o">=</span> <span class="n">imp_vols</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a><span class="n">mpr</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">iv_mean</span>
<a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a>
<a id="__codelineno-58-9" name="__codelineno-58-9" href="#__codelineno-58-9"></a><span class="c1"># prior kernel</span>
<a id="__codelineno-58-10" name="__codelineno-58-10" href="#__codelineno-58-10"></a><span class="n">k</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">A</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">l</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-58-11" name="__codelineno-58-11" href="#__codelineno-58-11"></a>
<a id="__codelineno-58-12" name="__codelineno-58-12" href="#__codelineno-58-12"></a><span class="c1"># indices and observations</span>
<a id="__codelineno-58-13" name="__codelineno-58-13" href="#__codelineno-58-13"></a><span class="n">x_is</span> <span class="o">=</span> <span class="n">logmnyns</span>
<a id="__codelineno-58-14" name="__codelineno-58-14" href="#__codelineno-58-14"></a><span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_is</span><span class="p">)</span>
<a id="__codelineno-58-15" name="__codelineno-58-15" href="#__codelineno-58-15"></a><span class="n">y_is</span> <span class="o">=</span> <span class="n">imp_vols</span>
<a id="__codelineno-58-16" name="__codelineno-58-16" href="#__codelineno-58-16"></a>
<a id="__codelineno-58-17" name="__codelineno-58-17" href="#__codelineno-58-17"></a><span class="c1"># posterior mean function for implied vol</span>
<a id="__codelineno-58-18" name="__codelineno-58-18" href="#__codelineno-58-18"></a><span class="n">mpo_iv</span> <span class="o">=</span> <span class="n">pos_mean</span><span class="p">(</span><span class="n">mpr</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">y_is</span><span class="p">,</span> <span class="n">x_is</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">)</span>
<a id="__codelineno-58-19" name="__codelineno-58-19" href="#__codelineno-58-19"></a><span class="n">mpo_iv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">mpo_iv</span><span class="p">)</span>
<a id="__codelineno-58-20" name="__codelineno-58-20" href="#__codelineno-58-20"></a><span class="c1">#mpo_iv(x_is)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="c1"># plot </span>
<a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_is</span><span class="p">,</span> <span class="n">y_is</span><span class="p">,</span> <span class="s1">&#39;bo&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Market data&#39;</span><span class="p">)</span>
<a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;logmoneyness&#39;</span><span class="p">)</span>
<a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;implied vol&#39;</span><span class="p">)</span>
<a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_is</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">x_is</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">200</span><span class="p">)</span>
<a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mpo_iv</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;GPR fit&#39;</span><span class="p">)</span>
<a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</code></pre></div>
<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-5/volatility_77_0.png" />
​    </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="c1"># analysis on absolute errors </span>
<a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="n">abs_errs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">iv_hat</span> <span class="o">-</span> <span class="n">y_is</span><span class="p">)</span>
<a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_is</span><span class="p">,</span> <span class="n">abs_errs</span><span class="p">,</span> <span class="s1">&#39;bo&#39;</span><span class="p">)</span>
<a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;logmoneyness&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span> 
<a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;errors&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">abs_errs</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div style="overflow-x: auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>87.0</td>
      <td>0.001156</td>
      <td>0.001303</td>
      <td>0.000011</td>
      <td>0.000347</td>
      <td>0.000829</td>
      <td>0.001325</td>
      <td>0.007309</td>
    </tr>
  </tbody>
</table>
</div>
</div>

<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-5/volatility_78_1.png" />
​    </p>
<h2 id="what-is-vix">What is VIX?<a class="headerlink" href="#what-is-vix" title="Permanent link">&para;</a></h2>
<p>Quote from <a href="https://www.investopedia.com/terms/v/vix.asp">this page</a> in Investopedia:</p>
<blockquote>
<p>Created by the Chicago Board Options Exchange (CBOE), the Volatility Index, or VIX, is a real-time market index that represents the market's expectation of 30-day forward-looking volatility. Derived from the price inputs of the S&amp;P 500 index options, it provides a measure of market risk and investors' sentiments. It is also known by other names like "Fear Gauge" or "Fear Index." Investors, research analysts and portfolio managers look to VIX values as a way to measure market risk, fear and stress before they take investment decisions. </p>
<p>Introduced in 1993, the Volatility Index (VIX) was initially a weighted measure of the implied volatility (IV) of eight S&amp;P 100 at-the-money put and call options. Ten years later, in 2004, it expanded to use options based on a broader index, the S&amp;P 500. This expansion allows for a more accurate view of investors' expectations on future market volatility. VIX values higher than 30 are usually associated with a significant amount of volatility as a result of investor fear or uncertainty. Values below 15 ordinarily correspond to less stressful, or even complacent, times in the markets.</p>
</blockquote>
<ul>
<li>Originally, the VIX computation was designed to mimic the implied volatility of an at-the-money 1 month option on the OEX index. It did this by averaging volatilities from 8 options (puts and calls from the closest to ATM strikes in the nearest and next to nearest months).</li>
<li>The CBOE changed the VIX computation: “CBOE is changing VIX to provide a more precise and robust measure of expected market volatility and to create a viable underlying index for tradable volatility products.”</li>
<li>CBOE listed futures on the VIX in 2004.</li>
</ul>
<h2 id="volatility-indices-published-by-cboe">Volatility indices published by CBOE<a class="headerlink" href="#volatility-indices-published-by-cboe" title="Permanent link">&para;</a></h2>
<p>In addition to VIX, other volatility indices published by <a href="http://www.cboe.com/products/vix-index-volatility/volatility-on-stock-indexes/cboe-s-p-500-9-day-vol-index-vix9d">CBOE</a> include</p>
<ul>
<li>VIX9D</li>
<li>VIX3M</li>
<li>VIX6M</li>
<li>VOX</li>
<li>VXD: Dow Jones index volatility</li>
<li>RVX</li>
<li>VXN</li>
<li>VVIX: VIX of VIX.</li>
</ul>
<h3 id="note_1">Note<a class="headerlink" href="#note_1" title="Permanent link">&para;</a></h3>
<p>More volatility indices published by CBOE can be found in <a href="http://www.cboe.com/Volatility">this link</a>.</p>
<h2 id="formula-of-financial-engineering">"Formula of financial engineering"<a class="headerlink" href="#formula-of-financial-engineering" title="Permanent link">&para;</a></h2>
<p>Notice that all payoffs we saw before can be expressed as a combination of payoffs from calls and puts, even the underlying itself since it can be regarded as a call struck at zero. A natural question to ask is, to what extent, can a given payoff function be represented as a combination of calls and puts?</p>
<p>The answer is surprisingly "all the payoffs"! The following formula shows how. </p>
<p>Let <span class="arithmatex">\(\varphi\)</span> be a payoff function, we have</p>
<div class="arithmatex">\[
\varphi(s) = \varphi(f) + \varphi'(f)(s - f) + \int_f^\infty (s - k)^+ \varphi''(k) dk + \int_0^f (k - s)^+ \varphi''(k)dk.
\]</div>
<p>Let <span class="arithmatex">\(\delta\)</span> denote the Dirac delta function and <span class="arithmatex">\(\theta\)</span> the Heaviside function. Note that heuristically <span class="arithmatex">\(\theta' = \delta\)</span>, i.e., the Dirac delta can be regarded as the derivative of the Heaviside function. </p>
<p>The payoff <span class="arithmatex">\(\varphi(s)\)</span> at time <span class="arithmatex">\(T\)</span> can be written as </p>
<div class="arithmatex">\[
\begin{aligned}
\varphi(s) &amp;= \int_0^\infty \varphi(k) \delta(s - k)\,dk \\\
&amp;= \int_0^f \varphi(k) \delta(s - k)\,dk + \int_f^\infty \varphi(k) \delta(s - k)\,dk \\\
&amp;= \varphi(f) - \int_0^f \varphi'(k) \theta(k - s)\,dk + \int_f^\infty \varphi'(k) \theta(s - k)\,dk \\\
&amp;= \varphi(f) + \varphi'(f) (s - f) + \int_0^f \varphi''(k) (k - s)^+\,dk + \int_f^\infty \varphi''(k) (s - k)^+\,dk.
\end{aligned}
\]</div>
<p>Thus, </p>
<div class="arithmatex">\[
\varphi(S_T) = \varphi(f) + \varphi'(f) (S_T - f) + \int_0^f \varphi''(k) (k - S_T)^+ dk + \int_f^\infty \varphi''(k) (S_T - k)^+ dk.
\]</div>
<p>With <span class="arithmatex">\(f = \Eof{S_T}\)</span> and taking expectation on both sides, we end up</p>
<div class="arithmatex">\[
\begin{aligned}
\E[\varphi(S_T)] &amp;= \varphi(f) + \int_0^f \varphi''(k) P(k)\, dk + \int_f^\infty \varphi''(k) C(k)\, dk.
\end{aligned}
\]</div>
<ul>
<li>The price of any European style contingent claim can be expressed in terms of strips of out-of-money European options. </li>
</ul>
<h2 id="example-log-contract">Example - log contract<a class="headerlink" href="#example-log-contract" title="Permanent link">&para;</a></h2>
<p>Consider the log contract <span class="arithmatex">\(\varphi(s) = \log s\)</span>. Since <span class="arithmatex">\(\varphi'(s) = \frac1s\)</span> and <span class="arithmatex">\(\varphi''(s) = -\frac1{s^2}\)</span>, we obtain</p>
<div class="arithmatex">\[
\log s = \log f + \frac{s - f}{f} - \int_0^f \frac{(k - s)^+}{k^2} dk - \int_f^\infty \frac{(s - k)^+}{k^2} dk. 
\]</div>
<p>Thus, </p>
<div class="arithmatex">\[
\Eof{\log S_T} = \log f - \int_0^f \, \frac{P(k)}{k^2} \,dk - \int_f^\infty\, \frac{C(k)}{k^2} \,dk.
\]</div>
<p>On the other hand, assume <span class="arithmatex">\(S_t\)</span> satisfies the SDE under risk neutral probability with zero interest and dividend rates</p>
<div class="arithmatex">\[
\frac{dS_t}{S_t} = \sigma_t dW_t,
\]</div>
<p>by applying Ito's formula to <span class="arithmatex">\(\log S_t\)</span>, we obtain</p>
<div class="arithmatex">\[
\log S_T = \log S_0 + \int_0^T \sigma_t \, dW_t - \frac{1}{2} \int_0^T \sigma_t^2 \, dt.
\]</div>
<p>It follows by taking expectation on both sides that </p>
<div class="arithmatex">\[
\Eof{\log S_T} = \log S_0 - \frac12 \Eof{\int_0^T \sigma_t^2 dt}
\]</div>
<p>Compare the two identities we obtain</p>
<div class="arithmatex">\[
\frac1T \Eof{\int_0^T \sigma_t^2 dt} = \frac2T \int_0^f \, \frac{P(k)}{k^2} \,dk + \frac2T \int_f^\infty\, \frac{C(k)}{k^2} \,dk.
\]</div>
<h3 id="note_2">Note<a class="headerlink" href="#note_2" title="Permanent link">&para;</a></h3>
<ul>
<li>Modulo the diffusion process assumption on the underlying, the last relationship is model-free.  </li>
<li>VIX is calculated based on this formula with <span class="arithmatex">\(T\)</span> equal to a month.  </li>
</ul>
<h2 id="how-is-vix-calculated">How is VIX calculated?<a class="headerlink" href="#how-is-vix-calculated" title="Permanent link">&para;</a></h2>
<p>VIX definition in the CBOE white paper:</p>
<p>$$
VIX^2=\frac{2}{T}\,\sum_i\,\frac{\Delta K_i}{K_i^2}\,
Q_i(K_i)\,-\,\frac{1}{T}\,\left[\frac{F}{K_0}-1\right]^2
$$
where <span class="arithmatex">\(Q_i\)</span> is the price of the out-of-the-money option with strike
<span class="arithmatex">\(K_i\)</span> and <span class="arithmatex">\(K_0\)</span> is the highest strike below the forward price <span class="arithmatex">\(F\)</span>. <span class="arithmatex">\(T\)</span> is one month.</p>
<h3 id="download-vix-data-from-yfinance">Download VIX data from <code>yfinance</code><a class="headerlink" href="#download-vix-data-from-yfinance" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="n">start</span> <span class="o">=</span> <span class="s1">&#39;2007-01-01&#39;</span>
<a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="n">end</span> <span class="o">=</span> <span class="s1">&#39;2022-07-29&#39;</span>
<a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a><span class="n">vix</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;^VIX&#39;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">)</span>
<a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a><span class="n">vix</span> <span class="o">=</span> <span class="n">vix</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;Volume&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a><span class="n">vix</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>[*********************100%%**********************]  1 of 1 completed
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div style="overflow-x: auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Open</th>
      <th>High</th>
      <th>Low</th>
      <th>Close</th>
      <th>Adj Close</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2007-01-03</th>
      <td>12.160000</td>
      <td>12.750000</td>
      <td>11.530000</td>
      <td>12.040000</td>
      <td>12.040000</td>
    </tr>
    <tr>
      <th>2007-01-04</th>
      <td>12.400000</td>
      <td>12.420000</td>
      <td>11.280000</td>
      <td>11.510000</td>
      <td>11.510000</td>
    </tr>
    <tr>
      <th>2007-01-05</th>
      <td>11.840000</td>
      <td>12.250000</td>
      <td>11.680000</td>
      <td>12.140000</td>
      <td>12.140000</td>
    </tr>
    <tr>
      <th>2007-01-08</th>
      <td>12.480000</td>
      <td>12.830000</td>
      <td>11.780000</td>
      <td>12.000000</td>
      <td>12.000000</td>
    </tr>
    <tr>
      <th>2007-01-09</th>
      <td>11.860000</td>
      <td>12.470000</td>
      <td>11.690000</td>
      <td>11.910000</td>
      <td>11.910000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2022-07-22</th>
      <td>23.299999</td>
      <td>23.809999</td>
      <td>22.410000</td>
      <td>23.030001</td>
      <td>23.030001</td>
    </tr>
    <tr>
      <th>2022-07-25</th>
      <td>24.330000</td>
      <td>24.570000</td>
      <td>23.190001</td>
      <td>23.360001</td>
      <td>23.360001</td>
    </tr>
    <tr>
      <th>2022-07-26</th>
      <td>23.950001</td>
      <td>25.309999</td>
      <td>23.820000</td>
      <td>24.690001</td>
      <td>24.690001</td>
    </tr>
    <tr>
      <th>2022-07-27</th>
      <td>24.270000</td>
      <td>24.410000</td>
      <td>23.020000</td>
      <td>23.240000</td>
      <td>23.240000</td>
    </tr>
    <tr>
      <th>2022-07-28</th>
      <td>23.330000</td>
      <td>23.540001</td>
      <td>22.219999</td>
      <td>22.330000</td>
      <td>22.330000</td>
    </tr>
  </tbody>
</table>
<p>3920 rows × 5 columns</p>
</div>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a><span class="n">vix</span><span class="p">[</span><span class="s1">&#39;Adj Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;VIX&#39;</span><span class="p">)</span>
<a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a><span class="c1"># plt.plot(spx_vol*100, &#39;r-.&#39;, label=&#39;Historical Volatility&#39;)</span>
<a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</code></pre></div>
<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-5/volatility_88_0.png" />
​    </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="c1"># plot log(vix)</span>
<a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a><span class="n">log</span><span class="p">(</span><span class="n">vix</span><span class="p">)[</span><span class="s1">&#39;Adj Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;log ViX&#39;</span><span class="p">)</span>
<a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</code></pre></div>
<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-5/volatility_89_0.png" />
​    </p>
<h2 id="volatility-derivatives">Volatility derivatives<a class="headerlink" href="#volatility-derivatives" title="Permanent link">&para;</a></h2>
<ul>
<li>variance swap</li>
<li>volatility swap</li>
<li>VIX futures</li>
<li>VIX options</li>
</ul>
<h2 id="variance-swap">Variance swap<a class="headerlink" href="#variance-swap" title="Permanent link">&para;</a></h2>
<p>Quote from the <a href="https://en.wikipedia.org/wiki/Variance_swap">Wikipage</a>:</p>
<blockquote>
<p>A variance swap is an over-the-counter financial derivative that allows one to speculate on or hedge risks associated with the magnitude of movement, i.e. volatility, of some underlying product, like an <font color=blue> exchange rate</font>, <font color=blue>interest rate</font>, or stock index.</p>
<p>One leg of the swap will pay an amount based upon the realized variance of the price changes of the underlying product. Conventionally, these price changes will be daily log returns, based upon the most commonly used closing price. The other leg of the swap will pay a fixed amount, which is the strike, quoted at the deal's inception. Thus the net payoff to the counterparties will be the difference between these two and will be settled in cash at the expiration of the deal, though some cash payments will likely be made along the way by one or the other counterparty to maintain agreed upon margin. </p>
</blockquote>
<p>In summary, a variance swap is a forward contract on realized (annualized) variance whose payoff function ideally is given by
$$
N \times \left(\frac1T \int_0^T \sigma_t^2 dt - K \right)
$$
where <span class="arithmatex">\(K\)</span> is the strike and <span class="arithmatex">\(N\)</span> denotes the notional.</p>
<h2 id="volatility-swap">Volatility swap<a class="headerlink" href="#volatility-swap" title="Permanent link">&para;</a></h2>
<p>Quote from the <a href="https://en.wikipedia.org/wiki/Volatility_swap">Wikipage</a>:</p>
<blockquote>
<p>In finance, a volatility swap is a forward contract on the future realised volatility of a given underlying asset. Volatility swaps allow investors to trade the volatility of an asset directly, much as they would trade a price index.</p>
<p>The underlying is usually a foreign exchange (FX) rate (very liquid market) but could be as well a single name equity or index. However, the variance swap is preferred in the equity market because it can be replicated with a linear combination of options and a dynamic position in futures.</p>
<p>Unlike a stock option, whose volatility exposure is contaminated by its stock price dependence, these swaps provide pure exposure to volatility alone. This is truly the case only for forward starting volatility swaps. However, once the swap has its asset fixings its mark-to-market value also depends on the current asset price. One can use these instruments to speculate on future volatility levels, to trade the spread between realized and implied volatility, or to hedge the volatility exposure of other positions or businesses. </p>
</blockquote>
<p>In summary, a volatility swap is a forward contract on realized (annualized) volatility whose payoff function ideally is given by<br />
$$
N \times \left(\sqrt{\frac1T \int_0^T \sigma_t^2 dt} - K \right)
$$
where <span class="arithmatex">\(K\)</span> is the strike and <span class="arithmatex">\(N\)</span> denotes the notional.</p>
<h2 id="calculating-volatility-swap-fair-strike-from-mgf">Calculating volatility swap fair strike from MGF<a class="headerlink" href="#calculating-volatility-swap-fair-strike-from-mgf" title="Permanent link">&para;</a></h2>
<p>By applying the following formula
$$
\sqrt x = \frac1{2\sqrt\pi}\int_0^\infty s^{-\frac32}\left(1 - e^{-xs}\right) ds,
$$
we obtain<br />
$$
\Eof{\sqrt{\frac1T \int_0^T \sigma_t^2 dt}} = \frac1{2\sqrt\pi}\int_0^\infty s^{-\frac32}\left(1 - \Eof{e^{-xs}}\right) ds
$$
where apparently,
$$
x = \frac1T \int_0^T \sigma_t^2 dt
$$
and <span class="arithmatex">\(\Eof{e^{-xs}}\)</span> the moment generating function for realized variance. </p>
<h2 id="vix-futures">VIX futures<a class="headerlink" href="#vix-futures" title="Permanent link">&para;</a></h2>
<p>According to the <a href="https://cfe.cboe.com/cfe-products/vx-cboe-volatility-index-vix-futures">VIX page</a> on CBOE,</p>
<blockquote>
<p>Introduced in 2004 on Cboe Futures Exchange (CFE), VIX futures provide market participants with the ability to trade a liquid volatility product based on the VIX Index methodology. VIX futures reflect the market's estimate of the value of the VIX Index on various expiration dates in the future. VIX futures provide market participants with a variety of opportunities to implement their view using volatility trading strategies, including risk management, alpha generation and portfolio diversification.</p>
</blockquote>
<h2 id="vix-option">VIX option<a class="headerlink" href="#vix-option" title="Permanent link">&para;</a></h2>
<p>Quote from <a href="https://www.investopedia.com/terms/v/vixoption.asp">this page</a> in Investopedia </p>
<blockquote>
<p>A VIX option is a non-equity index option that uses the CBOE Volatility Index as its underlying asset. Call and put VIX options are both available. The call options hedge portfolios against a sudden market decline, and put options hedge against a rapid reversal of short positions on the S&amp;P 500 index. These options thus allow traders and investors to speculate on future moves in volatility.</p>
</blockquote>
<h2 id="a-look-at-the-vix-option-chain-from-yahoo-finance">A look at the VIX option chain from Yahoo Finance<a class="headerlink" href="#a-look-at-the-vix-option-chain-from-yahoo-finance" title="Permanent link">&para;</a></h2>
<p>Visit this <a href="https://finance.yahoo.com/quote/%5EVIX/options/">Yahoo Finance link for VIX option chain</a>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="n">vix</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">Ticker</span><span class="p">(</span><span class="s1">&#39;^VIX&#39;</span><span class="p">)</span>
<a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="n">vix_expiries</span> <span class="o">=</span> <span class="n">vix</span><span class="o">.</span><span class="n">options</span>
<a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a><span class="nb">print</span><span class="p">(</span><span class="n">vix_expiries</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>(&#39;2024-07-31&#39;, &#39;2024-08-07&#39;, &#39;2024-08-14&#39;, &#39;2024-08-21&#39;, &#39;2024-08-28&#39;, &#39;2024-09-18&#39;, &#39;2024-10-16&#39;, &#39;2024-11-20&#39;, &#39;2024-12-18&#39;, &#39;2025-01-22&#39;, &#39;2025-02-19&#39;, &#39;2025-03-18&#39;, &#39;2025-04-16&#39;)
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="c1"># choose an expiry </span>
<a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a><span class="n">idx</span> <span class="o">=</span> <span class="mi">4</span>
<a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a><span class="n">today</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a><span class="n">day_count</span> <span class="o">=</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">vix_expiries</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">())</span><span class="o">.</span><span class="n">days</span>
<a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;option expiry = </span><span class="si">{</span><span class="n">vix_expiries</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="si">}</span><span class="s1">, today = </span><span class="si">{</span><span class="n">today</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;There are </span><span class="si">{</span><span class="n">day_count</span><span class="si">}</span><span class="s1"> days to expiry&#39;</span><span class="p">)</span>
<a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a><span class="n">option_chain</span> <span class="o">=</span> <span class="n">vix</span><span class="o">.</span><span class="n">option_chain</span><span class="p">(</span><span class="n">vix_expiries</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
<a id="__codelineno-65-8" name="__codelineno-65-8" href="#__codelineno-65-8"></a><span class="n">vix_calls</span><span class="p">,</span> <span class="n">vix_puts</span> <span class="o">=</span> <span class="n">option_chain</span><span class="o">.</span><span class="n">calls</span><span class="p">,</span> <span class="n">option_chain</span><span class="o">.</span><span class="n">puts</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>option expiry = 2024-08-28, today = 2024-07-30
There are 28 days to expiry
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="c1"># clean data</span>
<a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a><span class="n">vix_calls</span> <span class="o">=</span> <span class="n">vix_calls</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;currency&#39;</span><span class="p">,</span> <span class="s1">&#39;contractSize&#39;</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a><span class="n">vix_calls</span> <span class="o">=</span> <span class="n">vix_calls</span><span class="p">[(</span><span class="n">vix_calls</span><span class="p">[</span><span class="s1">&#39;bid&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">vix_calls</span><span class="p">[</span><span class="s1">&#39;ask&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]</span>
<a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a><span class="n">vix_calls</span>
<a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a><span class="c1"># The spread is high here, because Cboe does not know how to hedge the vix option</span>
<a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a><span class="c1"># So they have to charge more :D</span>
<a id="__codelineno-66-7" name="__codelineno-66-7" href="#__codelineno-66-7"></a><span class="c1"># Option price rises when the strike price is higher??? - The information is lagged</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div style="overflow-x: auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>contractSymbol</th>
      <th>lastTradeDate</th>
      <th>strike</th>
      <th>lastPrice</th>
      <th>bid</th>
      <th>ask</th>
      <th>change</th>
      <th>percentChange</th>
      <th>volume</th>
      <th>openInterest</th>
      <th>impliedVolatility</th>
      <th>inTheMoney</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>VIXW240828C00014000</td>
      <td>2024-07-29 19:10:46+00:00</td>
      <td>14.0</td>
      <td>2.62</td>
      <td>1.74</td>
      <td>3.25</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>28</td>
      <td>0</td>
      <td>0.958985</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>VIXW240828C00016000</td>
      <td>2024-07-29 20:00:22+00:00</td>
      <td>16.0</td>
      <td>1.57</td>
      <td>0.78</td>
      <td>2.20</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>11</td>
      <td>0</td>
      <td>0.639652</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>VIXW240828C00017000</td>
      <td>2024-07-29 18:46:51+00:00</td>
      <td>17.0</td>
      <td>1.33</td>
      <td>0.51</td>
      <td>1.95</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>59</td>
      <td>0</td>
      <td>0.750979</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>VIXW240828C00018000</td>
      <td>2024-07-29 13:39:56+00:00</td>
      <td>18.0</td>
      <td>1.10</td>
      <td>0.53</td>
      <td>1.61</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5</td>
      <td>0</td>
      <td>0.859376</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>VIXW240828C00019000</td>
      <td>2024-07-26 17:36:19+00:00</td>
      <td>19.0</td>
      <td>1.15</td>
      <td>0.47</td>
      <td>1.38</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>32</td>
      <td>0</td>
      <td>0.939454</td>
      <td>False</td>
    </tr>
    <tr>
      <th>5</th>
      <td>VIXW240828C00020000</td>
      <td>2024-07-29 14:39:02+00:00</td>
      <td>20.0</td>
      <td>0.87</td>
      <td>0.41</td>
      <td>1.22</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>10</td>
      <td>0</td>
      <td>1.011724</td>
      <td>False</td>
    </tr>
    <tr>
      <th>6</th>
      <td>VIXW240828C00022000</td>
      <td>2024-07-25 20:05:40+00:00</td>
      <td>22.0</td>
      <td>0.99</td>
      <td>0.33</td>
      <td>0.99</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>85</td>
      <td>0</td>
      <td>1.141606</td>
      <td>False</td>
    </tr>
    <tr>
      <th>7</th>
      <td>VIXW240828C00023000</td>
      <td>2024-07-25 19:43:51+00:00</td>
      <td>23.0</td>
      <td>0.80</td>
      <td>0.30</td>
      <td>0.91</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>100</td>
      <td>0</td>
      <td>1.201176</td>
      <td>False</td>
    </tr>
    <tr>
      <th>8</th>
      <td>VIXW240828C00024000</td>
      <td>2024-07-29 13:30:04+00:00</td>
      <td>24.0</td>
      <td>0.66</td>
      <td>0.27</td>
      <td>0.84</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1</td>
      <td>0</td>
      <td>1.253910</td>
      <td>False</td>
    </tr>
    <tr>
      <th>9</th>
      <td>VIXW240828C00025000</td>
      <td>2024-07-26 18:59:53+00:00</td>
      <td>25.0</td>
      <td>0.55</td>
      <td>0.25</td>
      <td>0.78</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1</td>
      <td>0</td>
      <td>1.304691</td>
      <td>False</td>
    </tr>
    <tr>
      <th>10</th>
      <td>VIXW240828C00030000</td>
      <td>2024-07-29 15:49:46+00:00</td>
      <td>30.0</td>
      <td>0.42</td>
      <td>0.16</td>
      <td>0.57</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2</td>
      <td>0</td>
      <td>1.505862</td>
      <td>False</td>
    </tr>
    <tr>
      <th>11</th>
      <td>VIXW240828C00031000</td>
      <td>2024-07-26 17:07:06+00:00</td>
      <td>31.0</td>
      <td>0.37</td>
      <td>0.15</td>
      <td>0.54</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1</td>
      <td>0</td>
      <td>1.541018</td>
      <td>False</td>
    </tr>
    <tr>
      <th>12</th>
      <td>VIXW240828C00033000</td>
      <td>2024-07-26 16:27:32+00:00</td>
      <td>33.0</td>
      <td>0.38</td>
      <td>0.12</td>
      <td>0.49</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>10</td>
      <td>0</td>
      <td>1.597658</td>
      <td>False</td>
    </tr>
    <tr>
      <th>13</th>
      <td>VIXW240828C00038000</td>
      <td>2024-07-29 19:25:34+00:00</td>
      <td>38.0</td>
      <td>0.20</td>
      <td>0.08</td>
      <td>0.40</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>29</td>
      <td>0</td>
      <td>1.734376</td>
      <td>False</td>
    </tr>
    <tr>
      <th>14</th>
      <td>VIXW240828C00040000</td>
      <td>2024-07-29 13:51:16+00:00</td>
      <td>40.0</td>
      <td>0.26</td>
      <td>0.06</td>
      <td>0.37</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>9</td>
      <td>0</td>
      <td>1.773439</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="n">vix_puts</span> <span class="o">=</span> <span class="n">vix_puts</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;currency&#39;</span><span class="p">,</span> <span class="s1">&#39;contractSize&#39;</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a><span class="n">vix_puts</span> <span class="o">=</span> <span class="n">vix_puts</span><span class="p">[(</span><span class="n">vix_puts</span><span class="p">[</span><span class="s1">&#39;bid&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">vix_puts</span><span class="p">[</span><span class="s1">&#39;ask&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]</span>
<a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a><span class="n">vix_puts</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div style="overflow-x: auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>contractSymbol</th>
      <th>lastTradeDate</th>
      <th>strike</th>
      <th>lastPrice</th>
      <th>bid</th>
      <th>ask</th>
      <th>change</th>
      <th>percentChange</th>
      <th>volume</th>
      <th>openInterest</th>
      <th>impliedVolatility</th>
      <th>inTheMoney</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>VIXW240828P00014000</td>
      <td>2024-07-26 16:59:50+00:00</td>
      <td>14.0</td>
      <td>0.24</td>
      <td>0.01</td>
      <td>0.57</td>
      <td>-0.12</td>
      <td>-33.333336</td>
      <td>4</td>
      <td>10</td>
      <td>0.611332</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>VIXW240828P00014500</td>
      <td>2024-07-26 16:59:50+00:00</td>
      <td>14.5</td>
      <td>0.41</td>
      <td>0.11</td>
      <td>0.80</td>
      <td>-0.14</td>
      <td>-25.454548</td>
      <td>4</td>
      <td>1</td>
      <td>0.639652</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>VIXW240828P00015000</td>
      <td>2024-07-26 18:42:35+00:00</td>
      <td>15.0</td>
      <td>0.75</td>
      <td>0.26</td>
      <td>1.10</td>
      <td>0.08</td>
      <td>11.940296</td>
      <td>15</td>
      <td>7</td>
      <td>0.677738</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>VIXW240828P00016000</td>
      <td>2024-07-26 17:59:38+00:00</td>
      <td>16.0</td>
      <td>1.17</td>
      <td>0.69</td>
      <td>1.84</td>
      <td>-0.03</td>
      <td>-2.500007</td>
      <td>15</td>
      <td>13</td>
      <td>0.760745</td>
      <td>False</td>
    </tr>
    <tr>
      <th>5</th>
      <td>VIXW240828P00017000</td>
      <td>2024-07-26 14:48:43+00:00</td>
      <td>17.0</td>
      <td>1.82</td>
      <td>1.17</td>
      <td>2.69</td>
      <td>0.04</td>
      <td>2.247196</td>
      <td>11</td>
      <td>29</td>
      <td>0.816408</td>
      <td>True</td>
    </tr>
    <tr>
      <th>6</th>
      <td>VIXW240828P00018000</td>
      <td>2024-07-26 19:58:24+00:00</td>
      <td>18.0</td>
      <td>3.00</td>
      <td>1.83</td>
      <td>3.59</td>
      <td>0.25</td>
      <td>9.090909</td>
      <td>25</td>
      <td>9</td>
      <td>0.884767</td>
      <td>True</td>
    </tr>
    <tr>
      <th>7</th>
      <td>VIXW240828P00020000</td>
      <td>2024-07-26 13:39:59+00:00</td>
      <td>20.0</td>
      <td>4.49</td>
      <td>3.38</td>
      <td>5.45</td>
      <td>0.36</td>
      <td>8.716699</td>
      <td>1</td>
      <td>10</td>
      <td>1.003911</td>
      <td>True</td>
    </tr>
    <tr>
      <th>8</th>
      <td>VIXW240828P00040000</td>
      <td>2024-07-25 14:13:31+00:00</td>
      <td>40.0</td>
      <td>22.75</td>
      <td>22.06</td>
      <td>25.55</td>
      <td>0.00</td>
      <td>0.000000</td>
      <td>10</td>
      <td>10</td>
      <td>1.705080</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="c1"># save data</span>
<a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="c1"># vix_calls.to_csv(&#39;vixcall_07252022.csv&#39;, index=False)</span>
<a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a><span class="c1"># vix_puts.to_csv(&#39;vixput_07252022.csv&#39;, index=False)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="c1"># read in saved data</span>
<a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a><span class="n">vix_calls</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;vixcall_07252022.csv&#39;</span><span class="p">)</span>
<a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a><span class="n">vix_puts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;vixput_07252022.csv&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="n">expiry</span><span class="p">,</span> <span class="n">today</span> <span class="o">=</span> <span class="s1">&#39;2022-08-24&#39;</span><span class="p">,</span> <span class="s1">&#39;2022-07-25&#39;</span>
<a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="n">vix_opt</span> <span class="o">=</span> <span class="n">OptionAnalytics</span><span class="p">([</span><span class="n">vix_calls</span><span class="p">,</span> <span class="n">vix_puts</span><span class="p">],</span> <span class="n">expiry</span><span class="p">,</span> <span class="n">today</span><span class="p">)</span>
<a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a><span class="c1">#vix_opt = OptionAnalytics([vix_calls, vix_puts], vix_expiries[idx], dt.now())</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>/var/folders/3h/357vtvkn1294nqc0jtg6lmw40000gn/T/ipykernel_72493/903028481.py:94: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  s_adj, pv = result.params[0], -result.params[1]
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="n">vix_opt</span><span class="o">.</span><span class="n">plot_arb</span><span class="p">()</span>
</code></pre></div>
<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-5/volatility_104_0.png" />
​    </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="n">vix_opt</span><span class="o">.</span><span class="n">plot_parity</span><span class="p">()</span>
</code></pre></div>
<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-5/volatility_105_0.png" />
​    </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="n">vix_opt</span><span class="o">.</span><span class="n">plot_imp_vols2</span><span class="p">(),</span> <span class="n">vix_opt</span><span class="o">.</span><span class="n">plot_imp_vols1</span><span class="p">();</span>
</code></pre></div>
<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-5/volatility_106_0.png" />
​    </p>
<p><img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-5/volatility_106_1.png" /></p>
<h2 id="gpr-fit-for-vix-option-implied-volatility-curve">GPR fit for VIX option implied volatility curve<a class="headerlink" href="#gpr-fit-for-vix-option-implied-volatility-curve" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="n">imp_vols</span> <span class="o">=</span> <span class="n">vix_opt</span><span class="o">.</span><span class="n">ivs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a><span class="c1">#imp_vols = vix_opt.ivs</span>
<a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a><span class="n">logmnyns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">vix_opt</span><span class="o">.</span><span class="n">ks</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">/</span><span class="n">vix_opt</span><span class="o">.</span><span class="n">s_adj</span><span class="p">)</span>
<a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a>
<a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a><span class="c1"># set hyperparameters by guessing</span>
<a id="__codelineno-74-6" name="__codelineno-74-6" href="#__codelineno-74-6"></a><span class="n">sigma</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span>
<a id="__codelineno-74-7" name="__codelineno-74-7" href="#__codelineno-74-7"></a>
<a id="__codelineno-74-8" name="__codelineno-74-8" href="#__codelineno-74-8"></a><span class="c1"># prior mean function</span>
<a id="__codelineno-74-9" name="__codelineno-74-9" href="#__codelineno-74-9"></a><span class="c1"># set prior mean as sample mean of implied vols</span>
<a id="__codelineno-74-10" name="__codelineno-74-10" href="#__codelineno-74-10"></a><span class="n">iv_mean</span> <span class="o">=</span> <span class="n">imp_vols</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-74-11" name="__codelineno-74-11" href="#__codelineno-74-11"></a><span class="n">mpr</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">iv_mean</span>
<a id="__codelineno-74-12" name="__codelineno-74-12" href="#__codelineno-74-12"></a>
<a id="__codelineno-74-13" name="__codelineno-74-13" href="#__codelineno-74-13"></a><span class="c1"># prior kernel</span>
<a id="__codelineno-74-14" name="__codelineno-74-14" href="#__codelineno-74-14"></a><span class="n">k</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">A</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">l</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-74-15" name="__codelineno-74-15" href="#__codelineno-74-15"></a>
<a id="__codelineno-74-16" name="__codelineno-74-16" href="#__codelineno-74-16"></a><span class="c1"># indices and observations</span>
<a id="__codelineno-74-17" name="__codelineno-74-17" href="#__codelineno-74-17"></a><span class="n">x_is</span> <span class="o">=</span> <span class="n">logmnyns</span>
<a id="__codelineno-74-18" name="__codelineno-74-18" href="#__codelineno-74-18"></a><span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_is</span><span class="p">)</span>
<a id="__codelineno-74-19" name="__codelineno-74-19" href="#__codelineno-74-19"></a><span class="n">y_is</span> <span class="o">=</span> <span class="n">imp_vols</span>
<a id="__codelineno-74-20" name="__codelineno-74-20" href="#__codelineno-74-20"></a>
<a id="__codelineno-74-21" name="__codelineno-74-21" href="#__codelineno-74-21"></a><span class="c1"># posterior mean function for implied vol</span>
<a id="__codelineno-74-22" name="__codelineno-74-22" href="#__codelineno-74-22"></a><span class="n">mpo_iv</span> <span class="o">=</span> <span class="n">pos_mean</span><span class="p">(</span><span class="n">mpr</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">y_is</span><span class="p">,</span> <span class="n">x_is</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">)</span>
<a id="__codelineno-74-23" name="__codelineno-74-23" href="#__codelineno-74-23"></a><span class="n">mpo_iv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">mpo_iv</span><span class="p">)</span>
<a id="__codelineno-74-24" name="__codelineno-74-24" href="#__codelineno-74-24"></a><span class="n">mpo_iv</span><span class="p">(</span><span class="n">x_is</span><span class="p">)</span>
<a id="__codelineno-74-25" name="__codelineno-74-25" href="#__codelineno-74-25"></a>
<a id="__codelineno-74-26" name="__codelineno-74-26" href="#__codelineno-74-26"></a>
<a id="__codelineno-74-27" name="__codelineno-74-27" href="#__codelineno-74-27"></a><span class="c1"># fitted values</span>
<a id="__codelineno-74-28" name="__codelineno-74-28" href="#__codelineno-74-28"></a><span class="n">iv_hat</span> <span class="o">=</span> <span class="n">mpo_iv</span><span class="p">(</span><span class="n">x_is</span><span class="p">)</span>
<a id="__codelineno-74-29" name="__codelineno-74-29" href="#__codelineno-74-29"></a><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">y_is</span><span class="p">,</span> <span class="n">iv_hat</span><span class="p">)</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div style="overflow-x: auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0.794121</th>
      <td>0.823381</td>
    </tr>
    <tr>
      <th>0.612930</th>
      <td>0.562470</td>
    </tr>
    <tr>
      <th>0.561423</th>
      <td>0.581719</td>
    </tr>
    <tr>
      <th>0.612908</th>
      <td>0.626235</td>
    </tr>
    <tr>
      <th>0.685567</th>
      <td>0.651083</td>
    </tr>
    <tr>
      <th>0.736006</th>
      <td>0.768180</td>
    </tr>
    <tr>
      <th>0.767337</th>
      <td>0.752712</td>
    </tr>
    <tr>
      <th>0.796917</th>
      <td>0.795185</td>
    </tr>
    <tr>
      <th>0.833553</th>
      <td>0.833420</td>
    </tr>
    <tr>
      <th>0.874426</th>
      <td>0.875310</td>
    </tr>
    <tr>
      <th>0.912757</th>
      <td>0.919806</td>
    </tr>
    <tr>
      <th>0.945017</th>
      <td>0.938292</td>
    </tr>
    <tr>
      <th>1.010601</th>
      <td>1.014723</td>
    </tr>
    <tr>
      <th>1.074513</th>
      <td>1.072477</td>
    </tr>
    <tr>
      <th>1.127997</th>
      <td>1.134668</td>
    </tr>
    <tr>
      <th>1.184969</th>
      <td>1.182831</td>
    </tr>
    <tr>
      <th>1.275277</th>
      <td>1.285238</td>
    </tr>
  </tbody>
</table>
</div>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="c1"># plot </span>
<a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_is</span><span class="p">,</span> <span class="n">y_is</span><span class="p">,</span> <span class="s1">&#39;bo&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Market data&#39;</span><span class="p">)</span>
<a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;logmoneyness&#39;</span><span class="p">)</span>
<a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;implied vol&#39;</span><span class="p">)</span>
<a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_is</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">x_is</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">200</span><span class="p">)</span>
<a id="__codelineno-75-7" name="__codelineno-75-7" href="#__codelineno-75-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mpo_iv</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;GPR fit&#39;</span><span class="p">)</span>
<a id="__codelineno-75-8" name="__codelineno-75-8" href="#__codelineno-75-8"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</code></pre></div>
<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-5/volatility_109_0.png" />
​    </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="c1"># analysis on absolute errors </span>
<a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a><span class="n">abs_errs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">iv_hat</span> <span class="o">-</span> <span class="n">y_is</span><span class="p">)</span>
<a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_is</span><span class="p">,</span> <span class="n">abs_errs</span><span class="p">,</span> <span class="s1">&#39;bo&#39;</span><span class="p">)</span>
<a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;logmoneyness&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span> 
<a id="__codelineno-76-5" name="__codelineno-76-5" href="#__codelineno-76-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;errors&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-76-6" name="__codelineno-76-6" href="#__codelineno-76-6"></a><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">abs_errs</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div style="overflow-x: auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>17.0</td>
      <td>0.013887</td>
      <td>0.01462</td>
      <td>0.000133</td>
      <td>0.002138</td>
      <td>0.007049</td>
      <td>0.020297</td>
      <td>0.05046</td>
    </tr>
  </tbody>
</table>
</div>
</div>

<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-5/volatility_110_1.png" />
​    </p>
<h2 id="appendix-optional">Appendix (Optional)<a class="headerlink" href="#appendix-optional" title="Permanent link">&para;</a></h2>
<h2 id="volatility-estimation-using-high-frequency-data">Volatility estimation using high frequency data<a class="headerlink" href="#volatility-estimation-using-high-frequency-data" title="Permanent link">&para;</a></h2>
<ul>
<li>Market microstructure noise may contaminate the data in high frequency, resulting in inconsistency of estimators. </li>
</ul>
<h2 id="realized-variance">Realized variance<a class="headerlink" href="#realized-variance" title="Permanent link">&para;</a></h2>
<p>The following estimator is called the <em>Realized Variance (RV)</em> estimator
$$
\sum_{i=1}^n \, \left(Y_{t_i} - Y_{t_{i-1}} \right)^2
= \sum_{i=1}^n \, \left( \Delta Y_{t_i} \right)^2, 
$$
where <span class="arithmatex">\(Y_t = \log S_t\)</span> and <span class="arithmatex">\(S_t\)</span> is the price series of the asset under consideration.</p>
<h3 id="technical-notes">Technical notes<a class="headerlink" href="#technical-notes" title="Permanent link">&para;</a></h3>
<ul>
<li>Realized variance and realized covariance <br>
    Given a partition <span class="arithmatex">\(\Pi = \{0 = t_1 &lt; \cdots &lt; t_n=T\}\)</span> of the interval <span class="arithmatex">\([0, T]\)</span>, the realized variance <span class="arithmatex">\([X]_T^\Pi\)</span> of the process <span class="arithmatex">\(X_t\)</span> sampled at <span class="arithmatex">\(\Pi\)</span> is defined by
$$
[X]<em i="1">T^\Pi = \sum</em>|^2.
$$
Similiarly, the realized covariance between }^n |X_{t_i} - X_{t_{i-1}<span class="arithmatex">\(X_t\)</span> and <span class="arithmatex">\(Y_t\)</span> sampled at <span class="arithmatex">\(\Pi\)</span> is given by
$$
[X, Y]<em i="1">T^\Pi = \sum</em>)
$$}^n (X_{t_i} - X_{t_{i-1}})(Y_{t_i} - Y_{t_{i-1}</li>
<li>
<p>Quadratic variation (integrated variance) and covariation <br>
    The quadratic variation of <span class="arithmatex">\(X\)</span> is defined by the limit
$$
    \angl{X}<em 0="0" _124_Pi_n_124_="|\Pi_n|" _to="\to">t = \lim</em> 
$$
    provided the limit exists. } [X]_T^{\Pi_n<span class="arithmatex">\(\Pi_n\)</span> denotes a sequence of partitions of the interval <span class="arithmatex">\([0, T]\)</span> such that <span class="arithmatex">\(\|\Pi_n\| \to 0\)</span> as <span class="arithmatex">\(n \to \infty\)</span>, where <span class="arithmatex">\(\|\Pi_n\|\)</span> denotes the mesh of the partition <span class="arithmatex">\(\Pi_n\)</span>. </p>
<p>Likewise, the covariation between and <span class="arithmatex">\(X\)</span> and <span class="arithmatex">\(Y\)</span> is defined by the limit
$$
\angl{X, Y}<em 0="0" _124_Pi_n_124_="|\Pi_n|" _to="\to">t = \lim</em>.
$$} [X, Y]_T^{\Pi_n</p>
</li>
</ul>
<h3 id="assumption">Assumption<a class="headerlink" href="#assumption" title="Permanent link">&para;</a></h3>
<p>The log price <span class="arithmatex">\(X_t\)</span> follows the Ito process</p>
<div class="arithmatex">\[
dX_t = \mu_t dt + \sigma_t dW_t,
\]</div>
<p>where <span class="arithmatex">\(W_t\)</span> is a Brownian motion. Under the assumption,
<span class="arithmatex">\(\angl{X}_t = \int_0^t \sigma_\tau^2 d\tau\)</span>.</p>
<h2 id="integrated-variance-or-quadratic-variation">Integrated variance or quadratic variation<a class="headerlink" href="#integrated-variance-or-quadratic-variation" title="Permanent link">&para;</a></h2>
<p>Given a set of tick data, how can we measure the, say daily, variance? <br>
A possibility is to estimate the <em>integrated variance</em>, also known as the <em>quadratic variation</em> in the theory of semimartingale. We shall use both terms interchangeably hereafter. </p>
<p>Recall that the <em>quadratic variation</em> <span class="arithmatex">\(\angl{X}_t\)</span> of the continuous stochastic process <span class="arithmatex">\(X_t\)</span> is defined by </p>
<div class="arithmatex">\[
\angl{X}_T:= \lim_{\|\Pi_n\| \to 0} \sum_{{t_i} \in \Pi_n} |\Delta X_{t_i}|^2
\]</div>
<p>provided the limit exist (in probability). </p>
<p>Thus, the goal is to estimate the quadratic variation of the efficient log price from the transacted log price, i.e., tick data. However, the subtlety is that efficient price is not directly observable and is contaminated by market microstructure noises.</p>
<h4 id="note_3">Note<a class="headerlink" href="#note_3" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>If the process <span class="arithmatex">\(X\)</span> has jumps, the quadratic variation <span class="arithmatex">\(\angl{X}\)</span> becomes
        $$
    \begin{aligned}
    \langle X \rangle_t &amp;= \langle X^c \rangle_t + \sum_{0 &lt; s \leq t} |\Delta X_s|^2,
    \end{aligned}
    $$</p>
<p>where <span class="arithmatex">\(X^c\)</span> denotes the continuous part of <span class="arithmatex">\(X\)</span> and <span class="arithmatex">\(\Delta X_s := X_s - X_{s^-}\)</span> is the jump size at time <span class="arithmatex">\(s\)</span>. In this case, the integrated variance usually refers to <span class="arithmatex">\(\langle X^c \rangle\)</span>, i.e., the quadratic variation of the continuous part. </p>
</li>
<li>
<p>We shall always assume <span class="arithmatex">\(X\)</span> is a continuous process, thus no jumps, in the sequel. </p>
</li>
</ul>
<h3 id="microstructure-noise">Microstructure noise<a class="headerlink" href="#microstructure-noise" title="Permanent link">&para;</a></h3>
<p>In the limit of very high sampling frequency, RV picks up mainly the market
microstructure noise. To see this, suppose that the observed price <span class="arithmatex">\(Y_t\)</span>
is given by</p>
<div class="arithmatex">\[Y_t =X_t +\epsilon_t,\]</div>
<p>where <span class="arithmatex">\(X_t\)</span> is the value of the
underlying (log-)price process of interest and <span class="arithmatex">\(\epsilon_t\)</span> is a random
market microstructure-related noise term, assumed independent of <span class="arithmatex">\(X_t\)</span>. Suppose we sample the price
series <span class="arithmatex">\(n+1\)</span> times (so that there are <span class="arithmatex">\(n\)</span> price changes) at <span class="arithmatex">\(\Pi=\{0=t_0 &lt; \cdots &lt; t_n = T\}\)</span> in the time interval <span class="arithmatex">\([0, T]\)</span>. </p>
<p>Note that, conditioned on <span class="arithmatex">\(\cF_T^X\)</span>, the conditional expectation of the realized variance of transacted (log) price satisties</p>
<div class="arithmatex">\[
\begin{aligned}
\E\left([Y]_T^\Pi \mid \mathcal{F}_T^X\right) &amp;:= \sum_{i=1}^n \E\left((\Delta Y_{t_i})^2 \mid \mathcal{F}_T^X\right) \\
&amp;= \sum_{i=1}^n (\Delta X_{t_i})^2 + 2 \sum_{i=1}^n \Delta X_{t_i} \E\left(\Delta \epsilon_{t_i} \mid \mathcal{F}_T^X\right) + \sum_{i=1}^n \E\left((\Delta \epsilon_{t_i})^2 \mid \mathcal{F}_T^X\right) \\
&amp;= [X]_T + 2 n \, \text{var}[\epsilon] \\
&amp;\approx \langle X \rangle_T + 2 n \, \text{var}[\epsilon].
\end{aligned}
\]</div>
<h4 id="note_4">Note<a class="headerlink" href="#note_4" title="Permanent link">&para;</a></h4>
<p>The difference between <span class="arithmatex">\([X]_T\)</span> and <span class="arithmatex">\(\angl{X}_T\)</span> is referred to as the <em>discretization error</em>, which is usually controled by the integrated quarticity <span class="arithmatex">\(\int_0^T \sigma_t^4 dt\)</span>. </p>
<h3 id="asymptotic-result">Asymptotic result<a class="headerlink" href="#asymptotic-result" title="Permanent link">&para;</a></h3>
<p>A more detailed, but more technical, asymptotic analysis shown in [Zhang, Mykland and Aït-Sahalia]<sup id="cite_ref-ZMA" class="reference"><a href="#cite_note-ZMA">[9]</a></sup> yields that as <span class="arithmatex">\(n \to \infty\)</span></p>
<div class="arithmatex">\[
[Y]^{\Pi}_T \mathop{\approx}^{\mathcal L} \angl{X}_T + 2 \, n \, \text{var}[\epsilon] + \sqrt{ 4 n \Eof{\epsilon^4} + \frac{2T}{n} \int_0^T \sigma_t^4 dt} \; Z,
\]</div>
<p>where <span class="arithmatex">\(Z \sim N(0,1)\)</span>.</p>
<h4 id="note_5">Note<a class="headerlink" href="#note_5" title="Permanent link">&para;</a></h4>
<ul>
<li>The naive RV estimator <span class="arithmatex">\([Y]_T^\Pi\)</span> is biased by the variance of market microstructure noise <span class="arithmatex">\(\epsilon\)</span>. The biasedness increases as the sampling frequency <span class="arithmatex">\(n\)</span> increases.  </li>
<li>We see that as <span class="arithmatex">\(n\to\infty\)</span>, the naive RV estimator <span class="arithmatex">\([Y]_T^\Pi\)</span> picks up mainly the microstructure noise.</li>
</ul>
<h3 id="the-conventional-solution">The conventional solution<a class="headerlink" href="#the-conventional-solution" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>The conventional solution is to sample at most every five minutes or
    so.</p>
<ul>
<li>For high frequency data, sampling only every 5 minutes usually corresponds to throwing out more than 99% of the points!</li>
</ul>
</li>
<li>
<p>To quote [Zhang, Mykland and Aït-Sahalia]<sup id="cite_ref-ZMA" class="reference"><a href="#cite_note-ZMA">[9]</a></sup>, “It is difficult to accept
    that throwing away data, especially in such quantities, can be an
    optimal solution.”</p>
</li>
<li>
<p>From a more practical perspective, if we believe that volatility is
    time-varying, it makes sense to try and measure it from recent data
    over the last few minutes rather than from a whole day of trading.</p>
</li>
</ul>
<h3 id="subsampling">Subsampling<a class="headerlink" href="#subsampling" title="Permanent link">&para;</a></h3>
<p>Let <span class="arithmatex">\(\Pi^{(k)} = \{0 \leq t_0^{(k)} &lt; \cdots &lt; t_{n_k}^{(k)}\leq T\}\)</span>, for <span class="arithmatex">\(1 \leq k \leq K\)</span>, be a collection of nonoverlapping subsampling times in <span class="arithmatex">\(\Pi\)</span>. That is, </p>
<div class="arithmatex">\[
\bigcup_{k=1}^K \Pi^{(k)} = \Pi \quad \text{ and } \quad \Pi^{(k)} \cap \Pi^{(\ell)} = \emptyset \; \text{for } k \neq \ell.
\]</div>
<p>A typical example that we shall be using in the following is by sampling every <span class="arithmatex">\(K\)</span> ticks from the <span class="arithmatex">\(k\)</span>th tick on. That is, 
$$
\begin{aligned}
\Pi^{(1)} &amp;= {t_1 &lt; t_{1+K} &lt; t_{1 + 2K} &lt; \cdots &lt; t_{1 + n_1 K} \leq T }, \\
\Pi^{(2)} &amp;= {t_2 &lt; t_{2+K} &lt; t_{2 + 2K}&lt; \cdots &lt; t_{2 + n_2 K} \leq T }, \\
&amp;\quad \vdots \\
\Pi^{(K)} &amp;= {t_0 &lt; t_K &lt; t_{2K} &lt; \cdots &lt; t_{n_K K} \leq T }.
\end{aligned}
$$</p>
<p>We denote by <span class="arithmatex">\([Y]_T^{\Pi^{(k)}}\)</span> the RV estimate of <span class="arithmatex">\(Y\)</span> using the subsamples that are sampled from the sampling times in <span class="arithmatex">\(\Pi^{(k)}\)</span>, for <span class="arithmatex">\(1 \leq k \leq K\)</span>.</p>
<p>By the same token, we have the following asymptotics for each subsample <span class="arithmatex">\(k \in \{1, \cdots, K\}\)</span></p>
<div class="arithmatex">\[
[Y]^{\Pi^{(k)}}_T \mathop{\approx}^{\mathcal L} \angl{X}_T + 2 \, n_k \, \text{var}[\epsilon] + \sqrt{ 4 n_k \Eof{\epsilon^4} + \frac{2T}{n_k} \int_0^T \sigma_t^4 dt} \; Z_k
\]</div>
<p>where <span class="arithmatex">\(Z_k \sim N(0,1)\)</span>.</p>
<h3 id="boosting-rv-estimator">Boosting RV estimator<a class="headerlink" href="#boosting-rv-estimator" title="Permanent link">&para;</a></h3>
<p>We can boost the RV estimator by averaging over the "weak learners" <span class="arithmatex">\([Y]_T^{\Pi^{(k)}}\)</span></p>
<div class="arithmatex">\[
\begin{aligned}
[Y]_T^{\text{avg}} &amp;= \frac{1}{K} \sum_{k=1}^K [Y]_T^{\Pi^{(k)}} \\
&amp;\approx \langle X \rangle_T + 2 \, \bar{n}_K \, \text{var}[\epsilon] + \sqrt{ 4 \frac{\bar{n}_K}{K} \E[\epsilon^4] + \frac{4T}{3 \bar{n}_K} \int_0^T \sigma_t^4 \, dt} \, Z.
\end{aligned}
\]</div>
<p>where $\bar n_K := \frac1K \sum_k n_k $ is the average number of ticks in each subsample, roughly equal to <span class="arithmatex">\(\frac nK\)</span>.</p>
<h4 id="note_6">Note<a class="headerlink" href="#note_6" title="Permanent link">&para;</a></h4>
<ul>
<li>Boosting reduces biasedness and variance by a factor of <span class="arithmatex">\(K\)</span>, but is unable to completely remove the biasedness.</li>
<li>The optimal average subsample size <span class="arithmatex">\(\bar n^*\)</span> is given by
$$
\bar n^* = \sqrt[3]{\frac T{6\text{var}^2[\epsilon]} \int_0^T \sigma_t^4 dt}.
$$</li>
</ul>
<p>Thus, the whole sample set is splitted into roughly <span class="arithmatex">\(K^* \approx \frac n{\bar n^*}\)</span> sets of subsamples.</p>
<h3 id="the-zma-estimator">The ZMA estimator<a class="headerlink" href="#the-zma-estimator" title="Permanent link">&para;</a></h3>
<p>Recall that 
$$
\begin{aligned}
[Y]_T^\Pi &amp;\approx \langle X \rangle_T + n \, \text{var}[\epsilon], \
[Y]_T^{\text{avg}} &amp;\approx \langle X \rangle_T + \bar{n}_K \, \text{var}[\epsilon].
\end{aligned}
$$</p>
<p>We can eliminate bias by forming</p>
<div class="arithmatex">\[\begin{aligned}
\frac{1}{\bar{n}_K}[Y]_T^{\text{avg}} - \frac{1}{n} [Y]_T^\Pi &amp;\approx \left( \frac{1}{\bar{n}_K} - \frac{1}{n} \right) \langle X \rangle_T.
\end{aligned}\]</div>
<p>Thus we obtain the [Zhang, Mykland and Aït-Sahalia]<sup id="cite_ref-ZMA" class="reference"><a href="#cite_note-ZMA">[9]</a></sup> (ZMA) bias-corrected
estimator of <span class="arithmatex">\(\angl{X}_T\)</span>:</p>
<div class="arithmatex">\[
[Y]_T^{ZMA} := \frac{1}{n - \bar n_K} \, \left\{n \, [Y]_T^{avg} - \bar n_K \, [Y]^\Pi_T \right\}.
\]</div>
<p>Moreover, we have the asymptotic behavior for <span class="arithmatex">\([Y]_T^{ZMA}\)</span> as</p>
<div class="arithmatex">\[
[Y]_T^{ZMA} \approx \angl{X}_T + \frac1{\sqrt[6]n}\sqrt{\frac8{c^2}\text{var}^2[\epsilon] + c \frac{4T}3 \int_0^T \sigma_t^4 dt} \; Z
\]</div>
<p>where <span class="arithmatex">\(Z \sim N(0,1)\)</span>. The optimal constant <span class="arithmatex">\(c^*\)</span> is given by</p>
<div class="arithmatex">\[
c^* = \left(\frac T{12 \, \text{var}^2[\epsilon]} \int_0^T \sigma_t^4 dt \right)^{-\frac13}.
\]</div>
<h4 id="note_7">Note<a class="headerlink" href="#note_7" title="Permanent link">&para;</a></h4>
<p>In the original paper [Zhang, Mykland and Aït-Sahalia]<sup id="cite_ref-ZMA" class="reference"><a href="#cite_note-ZMA">[9]</a></sup>, the authors suggested the estimator as <span class="arithmatex">\([Y]_T^{avg} - \frac{\bar n_K}{n}[Y]_T^\Pi\)</span>, whereas the estimator <span class="arithmatex">\([Y]_T^{ZMA}\)</span> obtained above is referred to as the <em>small-sample adjustment</em> in the paper. </p>
<h3 id="the-zhou-estimator">The Zhou estimator<a class="headerlink" href="#the-zhou-estimator" title="Permanent link">&para;</a></h3>
<p>Define</p>
<div class="arithmatex">\[
\begin{aligned}
[Y]_T^{\Pi, Z} &amp;: = \sum_{i=1}^n (\Delta Y_{t_i})^2 + \sum_{i=2}^n \Delta Y_{t_i} \Delta Y_{t_{i-1}} + \sum_{i=1}^{n-1} \Delta Y_{t_i} \Delta Y_{t_{i+1}} \\
&amp;= \sum_{i=1}^n (Y_{t_i} - Y_{t_{i-1}})(Y_{t_{i+1}} - Y_{t_{i-2}}).
\end{aligned}
\]</div>
<p>Thus, under the assumption <span class="arithmatex">\(Y = X + \epsilon\)</span> of serially uncorrelated
noise independent of returns <span class="arithmatex">\(X\)</span>, we obtain
<span class="arithmatex">\(\mathbb{E}\left[[Y]^{\Pi, Z}\right] = \Eof{[X]_T}\)</span>. </p>
<p>By further assume <span class="arithmatex">\(X_t = \sigma W_{\tau(t)}\)</span> (a time-changed Brownian motion) for some Brownian motion <span class="arithmatex">\(W\)</span> and deterministic increasing function <span class="arithmatex">\(\tau(\cdot)\)</span>, since </p>
<div class="arithmatex">\[
\Eof{(\Delta X_{t_i})^2} = \sigma^2 \Eof{\left\{ W_{\tau(t_i)} - W_{\tau(t_{i-1})} \right\}^2} = \sigma^2 \{\tau(t_i) - \tau(t_{i-1})\},
\]</div>
<p>we have</p>
<div class="arithmatex">\[
\mathbb{E}\left[[Y]^{\Pi, Z}\right] = \sigma^2 \{\tau(T) - \tau(0) \} = \angl{X}_T.
\]</div>
<p>In other words, in this case <span class="arithmatex">\([Y]^{\Pi, Z}\)</span> is an unbiased estimator of <span class="arithmatex">\(\angl{X}_T\)</span>.</p>
<h2 id="realized-library">Realized library<a class="headerlink" href="#realized-library" title="Permanent link">&para;</a></h2>
<p>Realized Library at Oxford-Man Institute of Quantitative Finance publishes daily realized variances/volatilities for various indices. </p>
<p><a href="https://realized.oxford-man.ox.ac.uk/">https://realized.oxford-man.ox.ac.uk/</a></p>
<h4 id="note_8">Note<a class="headerlink" href="#note_8" title="Permanent link">&para;</a></h4>
<p><font color=blue>Unfortunately, the Realized Library has ceased providing the service.</font> </p>
<h2 id="spx-realized-variance">SPX realized variance<a class="headerlink" href="#spx-realized-variance" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span> <span class="k">as</span> <span class="n">dt</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;OxfordManRealizedVolatilityIndices.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a><span class="n">rv1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a>    <span class="k">if</span> <span class="n">col</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;.rk&#39;</span><span class="p">:</span>
<a id="__codelineno-78-5" name="__codelineno-78-5" href="#__codelineno-78-5"></a>        <span class="n">rv1</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
<a id="__codelineno-78-6" name="__codelineno-78-6" href="#__codelineno-78-6"></a>
<a id="__codelineno-78-7" name="__codelineno-78-7" href="#__codelineno-78-7"></a><span class="c1"># convert index into datetime</span>
<a id="__codelineno-78-8" name="__codelineno-78-8" href="#__codelineno-78-8"></a><span class="n">rv1</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">date</span><span class="p">),</span> <span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">rv1</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="n">df</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div style="overflow-x: auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SPX2.rv</th>
      <th>SPX2.rk</th>
      <th>SPX2.r</th>
      <th>SPX2.rv5ss</th>
      <th>SPX2.rv10</th>
      <th>SPX2.rv10ss</th>
      <th>SPX2.bv5</th>
      <th>SPX2.bv5ss</th>
      <th>SPX2.medrv</th>
      <th>SPX2.rs</th>
      <th>...</th>
      <th>FTSEMIB.rs</th>
      <th>FTSEMIB.rs5ss</th>
      <th>FTSEMIB.nobs</th>
      <th>FTSEMIB.timespan</th>
      <th>FTSEMIB.rcto</th>
      <th>FTSEMIB.open</th>
      <th>FTSEMIB.highlow</th>
      <th>FTSEMIB.highopen</th>
      <th>FTSEMIB.openprice</th>
      <th>FTSEMIB.closeprice</th>
    </tr>
    <tr>
      <th>DateID</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>20000103</th>
      <td>0.000157</td>
      <td>0.000161</td>
      <td>-0.010104</td>
      <td>0.000144</td>
      <td>0.000175</td>
      <td>0.000170</td>
      <td>0.000157</td>
      <td>0.000142</td>
      <td>0.000084</td>
      <td>0.000099</td>
      <td>...</td>
      <td>0.000323</td>
      <td>0.000314</td>
      <td>496.0</td>
      <td>29752.752</td>
      <td>NaN</td>
      <td>34152.212</td>
      <td>0.061739</td>
      <td>0.002525</td>
      <td>43900.00</td>
      <td>41477.00</td>
    </tr>
    <tr>
      <th>20000104</th>
      <td>0.000298</td>
      <td>0.000264</td>
      <td>-0.039292</td>
      <td>0.000219</td>
      <td>0.000400</td>
      <td>0.000247</td>
      <td>0.000206</td>
      <td>0.000206</td>
      <td>0.000092</td>
      <td>0.000254</td>
      <td>...</td>
      <td>0.000144</td>
      <td>0.000173</td>
      <td>471.0</td>
      <td>28319.096</td>
      <td>NaN</td>
      <td>35524.926</td>
      <td>0.020667</td>
      <td>0.001046</td>
      <td>41072.00</td>
      <td>40468.00</td>
    </tr>
    <tr>
      <th>20000105</th>
      <td>0.000307</td>
      <td>0.000305</td>
      <td>0.001749</td>
      <td>0.000298</td>
      <td>0.000258</td>
      <td>0.000307</td>
      <td>0.000292</td>
      <td>0.000279</td>
      <td>0.000111</td>
      <td>0.000138</td>
      <td>...</td>
      <td>0.000144</td>
      <td>0.000153</td>
      <td>497.0</td>
      <td>29751.621</td>
      <td>NaN</td>
      <td>34154.433</td>
      <td>-0.029584</td>
      <td>0.029584</td>
      <td>39000.00</td>
      <td>39449.00</td>
    </tr>
    <tr>
      <th>20000106</th>
      <td>0.000136</td>
      <td>0.000149</td>
      <td>0.001062</td>
      <td>0.000136</td>
      <td>0.000108</td>
      <td>0.000133</td>
      <td>0.000127</td>
      <td>0.000127</td>
      <td>0.000086</td>
      <td>0.000062</td>
      <td>...</td>
      <td>0.000196</td>
      <td>0.000216</td>
      <td>496.0</td>
      <td>29691.265</td>
      <td>NaN</td>
      <td>34154.335</td>
      <td>0.032678</td>
      <td>0.000276</td>
      <td>39834.00</td>
      <td>38736.00</td>
    </tr>
    <tr>
      <th>20000107</th>
      <td>0.000093</td>
      <td>0.000123</td>
      <td>0.026022</td>
      <td>0.000112</td>
      <td>0.000121</td>
      <td>0.000114</td>
      <td>0.000083</td>
      <td>0.000095</td>
      <td>0.000049</td>
      <td>0.000024</td>
      <td>...</td>
      <td>0.000072</td>
      <td>0.000081</td>
      <td>497.0</td>
      <td>29751.482</td>
      <td>NaN</td>
      <td>34153.093</td>
      <td>-0.027410</td>
      <td>0.026694</td>
      <td>39144.00</td>
      <td>40199.00</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>20171129</th>
      <td>0.000016</td>
      <td>0.000017</td>
      <td>-0.000693</td>
      <td>0.000017</td>
      <td>0.000016</td>
      <td>0.000016</td>
      <td>0.000012</td>
      <td>0.000013</td>
      <td>0.000019</td>
      <td>0.000009</td>
      <td>...</td>
      <td>0.000030</td>
      <td>0.000025</td>
      <td>19553.0</td>
      <td>27358.791</td>
      <td>NaN</td>
      <td>32401.219</td>
      <td>0.010438</td>
      <td>0.005222</td>
      <td>22391.37</td>
      <td>22325.94</td>
    </tr>
    <tr>
      <th>20171130</th>
      <td>0.000028</td>
      <td>0.000020</td>
      <td>0.004886</td>
      <td>0.000023</td>
      <td>0.000035</td>
      <td>0.000025</td>
      <td>0.000024</td>
      <td>0.000024</td>
      <td>0.000018</td>
      <td>0.000010</td>
      <td>...</td>
      <td>0.000021</td>
      <td>0.000024</td>
      <td>23672.0</td>
      <td>27357.591</td>
      <td>NaN</td>
      <td>32402.862</td>
      <td>0.008467</td>
      <td>0.004035</td>
      <td>22467.64</td>
      <td>22368.29</td>
    </tr>
    <tr>
      <th>20171201</th>
      <td>0.000088</td>
      <td>0.000130</td>
      <td>-0.001256</td>
      <td>0.000117</td>
      <td>0.000120</td>
      <td>0.000124</td>
      <td>0.000093</td>
      <td>0.000126</td>
      <td>0.000138</td>
      <td>0.000061</td>
      <td>...</td>
      <td>0.000047</td>
      <td>0.000054</td>
      <td>25521.0</td>
      <td>27359.230</td>
      <td>NaN</td>
      <td>32400.969</td>
      <td>-0.013862</td>
      <td>0.008983</td>
      <td>22168.37</td>
      <td>22106.10</td>
    </tr>
    <tr>
      <th>20171204</th>
      <td>0.000023</td>
      <td>0.000023</td>
      <td>-0.006854</td>
      <td>0.000021</td>
      <td>0.000022</td>
      <td>0.000020</td>
      <td>0.000024</td>
      <td>0.000022</td>
      <td>0.000020</td>
      <td>0.000014</td>
      <td>...</td>
      <td>0.000015</td>
      <td>0.000015</td>
      <td>21585.0</td>
      <td>27359.204</td>
      <td>NaN</td>
      <td>32400.856</td>
      <td>0.006576</td>
      <td>0.003166</td>
      <td>22350.63</td>
      <td>22362.11</td>
    </tr>
    <tr>
      <th>20171205</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>4683 rows × 399 columns</p>
</div>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="n">rv1</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div style="overflow-x: auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SPX2.rk</th>
      <th>FTSE2.rk</th>
      <th>N2252.rk</th>
      <th>GDAXI2.rk</th>
      <th>RUT2.rk</th>
      <th>AORD2.rk</th>
      <th>DJI2.rk</th>
      <th>IXIC2.rk</th>
      <th>FCHI2.rk</th>
      <th>HSI2.rk</th>
      <th>...</th>
      <th>AEX.rk</th>
      <th>SSMI.rk</th>
      <th>IBEX2.rk</th>
      <th>NSEI.rk</th>
      <th>MXX.rk</th>
      <th>BVSP.rk</th>
      <th>GSPTSE.rk</th>
      <th>STOXX50E.rk</th>
      <th>FTSTI.rk</th>
      <th>FTSEMIB.rk</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-01-03</th>
      <td>0.000161</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.000702</td>
      <td>0.000264</td>
      <td>NaN</td>
      <td>0.000135</td>
      <td>0.000574</td>
      <td>0.000262</td>
      <td>0.000261</td>
      <td>...</td>
      <td>0.000124</td>
      <td>NaN</td>
      <td>0.000168</td>
      <td>NaN</td>
      <td>0.000088</td>
      <td>0.000404</td>
      <td>NaN</td>
      <td>0.000272</td>
      <td>0.000158</td>
      <td>0.000520</td>
    </tr>
    <tr>
      <th>2000-01-04</th>
      <td>0.000264</td>
      <td>0.000249</td>
      <td>0.000162</td>
      <td>0.000591</td>
      <td>0.000232</td>
      <td>0.000045</td>
      <td>0.000159</td>
      <td>0.000575</td>
      <td>0.000372</td>
      <td>0.000207</td>
      <td>...</td>
      <td>0.000233</td>
      <td>0.000102</td>
      <td>0.000215</td>
      <td>NaN</td>
      <td>0.000214</td>
      <td>0.000617</td>
      <td>NaN</td>
      <td>0.000252</td>
      <td>0.000123</td>
      <td>0.000336</td>
    </tr>
    <tr>
      <th>2000-01-05</th>
      <td>0.000305</td>
      <td>0.000198</td>
      <td>0.000245</td>
      <td>0.001081</td>
      <td>0.000145</td>
      <td>0.000256</td>
      <td>0.000196</td>
      <td>0.000941</td>
      <td>0.000334</td>
      <td>0.001597</td>
      <td>...</td>
      <td>0.000448</td>
      <td>0.000123</td>
      <td>0.000292</td>
      <td>NaN</td>
      <td>0.000173</td>
      <td>0.000982</td>
      <td>NaN</td>
      <td>0.000506</td>
      <td>0.000394</td>
      <td>0.000422</td>
    </tr>
    <tr>
      <th>2000-01-06</th>
      <td>0.000149</td>
      <td>0.000148</td>
      <td>0.000198</td>
      <td>0.000306</td>
      <td>0.000056</td>
      <td>0.000031</td>
      <td>0.000124</td>
      <td>0.000580</td>
      <td>0.000248</td>
      <td>0.000870</td>
      <td>...</td>
      <td>0.000224</td>
      <td>0.000087</td>
      <td>NaN</td>
      <td>0.000030</td>
      <td>0.000056</td>
      <td>0.000501</td>
      <td>NaN</td>
      <td>0.000110</td>
      <td>0.000586</td>
      <td>0.000339</td>
    </tr>
    <tr>
      <th>2000-01-07</th>
      <td>0.000123</td>
      <td>0.000126</td>
      <td>0.000157</td>
      <td>0.000301</td>
      <td>0.000031</td>
      <td>0.000043</td>
      <td>0.000096</td>
      <td>0.000396</td>
      <td>0.000257</td>
      <td>0.000508</td>
      <td>...</td>
      <td>0.000107</td>
      <td>0.000066</td>
      <td>0.000155</td>
      <td>0.000039</td>
      <td>0.000082</td>
      <td>0.000258</td>
      <td>NaN</td>
      <td>0.000149</td>
      <td>0.000159</td>
      <td>0.000160</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2017-11-29</th>
      <td>0.000017</td>
      <td>0.000018</td>
      <td>0.000025</td>
      <td>0.000047</td>
      <td>0.000037</td>
      <td>0.000016</td>
      <td>0.000012</td>
      <td>0.000066</td>
      <td>0.000030</td>
      <td>0.000039</td>
      <td>...</td>
      <td>0.000034</td>
      <td>0.000021</td>
      <td>0.000056</td>
      <td>0.000009</td>
      <td>0.000035</td>
      <td>0.000123</td>
      <td>0.000019</td>
      <td>0.000040</td>
      <td>NaN</td>
      <td>0.000029</td>
    </tr>
    <tr>
      <th>2017-11-30</th>
      <td>0.000020</td>
      <td>0.000020</td>
      <td>0.000038</td>
      <td>0.000058</td>
      <td>0.000035</td>
      <td>0.000031</td>
      <td>0.000026</td>
      <td>0.000039</td>
      <td>0.000040</td>
      <td>0.000040</td>
      <td>...</td>
      <td>0.000036</td>
      <td>0.000033</td>
      <td>0.000066</td>
      <td>0.000025</td>
      <td>0.000042</td>
      <td>0.000114</td>
      <td>0.000016</td>
      <td>0.000044</td>
      <td>NaN</td>
      <td>0.000033</td>
    </tr>
    <tr>
      <th>2017-12-01</th>
      <td>0.000130</td>
      <td>0.000041</td>
      <td>0.000066</td>
      <td>0.000142</td>
      <td>0.000208</td>
      <td>0.000017</td>
      <td>0.000153</td>
      <td>0.000126</td>
      <td>0.000110</td>
      <td>0.000066</td>
      <td>...</td>
      <td>0.000092</td>
      <td>0.000056</td>
      <td>0.000090</td>
      <td>0.000026</td>
      <td>0.000061</td>
      <td>0.000151</td>
      <td>0.000034</td>
      <td>0.000117</td>
      <td>NaN</td>
      <td>0.000073</td>
    </tr>
    <tr>
      <th>2017-12-04</th>
      <td>0.000023</td>
      <td>0.000027</td>
      <td>0.000039</td>
      <td>0.000050</td>
      <td>0.000104</td>
      <td>0.000009</td>
      <td>0.000024</td>
      <td>0.000060</td>
      <td>0.000028</td>
      <td>0.000082</td>
      <td>...</td>
      <td>0.000028</td>
      <td>0.000026</td>
      <td>0.000048</td>
      <td>0.000031</td>
      <td>0.000050</td>
      <td>0.000092</td>
      <td>0.000012</td>
      <td>0.000064</td>
      <td>NaN</td>
      <td>0.000029</td>
    </tr>
    <tr>
      <th>2017-12-05</th>
      <td>NaN</td>
      <td>0.000019</td>
      <td>0.000027</td>
      <td>0.000059</td>
      <td>0.000025</td>
      <td>0.000018</td>
      <td>0.000023</td>
      <td>0.000046</td>
      <td>0.000037</td>
      <td>0.000044</td>
      <td>...</td>
      <td>0.000026</td>
      <td>0.000028</td>
      <td>0.000043</td>
      <td>0.000026</td>
      <td>0.000045</td>
      <td>0.000139</td>
      <td>0.000009</td>
      <td>0.000039</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>4683 rows × 21 columns</p>
</div>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="c1"># plot spx realized variance</span>
<a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a><span class="c1"># spx2.rk contains the rv calcuated by the realized kernel within 5-min bins</span>
<a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a><span class="n">spx_rv</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rv1</span><span class="p">[</span><span class="s1">&#39;SPX2.rk&#39;</span><span class="p">])</span>
<a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a><span class="n">spx_rv</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;SPX realized variance&#39;</span><span class="p">,</span>
<a id="__codelineno-81-5" name="__codelineno-81-5" href="#__codelineno-81-5"></a>         <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.003</span><span class="p">));</span>
</code></pre></div>
<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-5/volatility_129_0.png" />
​    </p>
<h2 id="the-corsi-har-rv-forecast">The Corsi HAR-RV forecast<a class="headerlink" href="#the-corsi-har-rv-forecast" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>The Corsi HAR-RV model implements a regression to fit the parameters.</p>
</li>
<li>
<p>This model can be regarded as a poor man’s version of a long memory
    model such as ARFIMA.</p>
<ul>
<li>True long-memory models such as ARFIMA are notoriously hard to
    fit.</li>
</ul>
</li>
<li>
<p>HAR-RV can also be considered an intelligent alternative to GARCH.</p>
</li>
<li>
<p>The model boils down to the regression</p>
<div class="arithmatex">\[RV_{t,t+h} = \beta_0 + \beta_D\,RV_t + \beta_W\,RV_{t-5,t} + \beta_M\,RV_{t-22,t} + \epsilon_{t,t+h}.\]</div>
<p>In words, the RV forecast for <span class="arithmatex">\(h\)</span> days from now is a linear
combination of the current realized variance and (aggregate) RV
estimates for the last week and the last month.</p>
</li>
</ul>
<h3 id="note_9">Note<a class="headerlink" href="#note_9" title="Permanent link">&para;</a></h3>
<ul>
<li><span class="arithmatex">\(RV\)</span> denotes the logarithm of realized variance.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">statsmodels.formula.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sm</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="c1"># take h = 1 in the HAR-RV model</span>
<a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a><span class="c1"># y = RV_{t+h}</span>
<a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a><span class="c1"># rv1 = RV_t</span>
<a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a><span class="c1"># rv5 = RV_{t-5}</span>
<a id="__codelineno-83-5" name="__codelineno-83-5" href="#__codelineno-83-5"></a><span class="c1"># rv22 = RV_{t-22}</span>
<a id="__codelineno-83-6" name="__codelineno-83-6" href="#__codelineno-83-6"></a><span class="n">spx_rv</span> <span class="o">=</span> <span class="n">spx_rv</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<a id="__codelineno-83-7" name="__codelineno-83-7" href="#__codelineno-83-7"></a><span class="n">spx1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">spx_rv</span><span class="p">)</span>
<a id="__codelineno-83-8" name="__codelineno-83-8" href="#__codelineno-83-8"></a><span class="n">y</span> <span class="o">=</span> <span class="n">spx1</span><span class="p">[</span><span class="mi">22</span><span class="p">:]</span>
<a id="__codelineno-83-9" name="__codelineno-83-9" href="#__codelineno-83-9"></a><span class="n">rv1</span> <span class="o">=</span> <span class="n">spx1</span><span class="p">[</span><span class="mi">21</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-83-10" name="__codelineno-83-10" href="#__codelineno-83-10"></a><span class="n">rv5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">spx1</span><span class="p">[</span><span class="mi">17</span><span class="p">:])</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()[</span><span class="mi">5</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-83-11" name="__codelineno-83-11" href="#__codelineno-83-11"></a><span class="n">rv22</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">spx1</span><span class="p">[:])</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">22</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()[</span><span class="mi">22</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="c1"># regress y over rv1 + rv5 + rv22</span>
<a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;rv1&#39;</span><span class="p">:</span> <span class="n">rv1</span><span class="p">,</span> <span class="s1">&#39;rv5&#39;</span><span class="p">:</span> <span class="n">rv5</span><span class="p">,</span> <span class="s1">&#39;rv22&#39;</span><span class="p">:</span> <span class="n">rv22</span><span class="p">}</span>
<a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a><span class="n">fit_har</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="s1">&#39;y ~ rv1 + rv5 + rv22&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="nb">print</span><span class="p">(</span><span class="n">fit_har</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       0.506
Model:                            OLS   Adj. R-squared:                  0.506
Method:                 Least Squares   F-statistic:                     1523.
Date:                Sun, 28 Jul 2024   Prob (F-statistic):               0.00
Time:                        21:43:25   Log-Likelihood:                 32207.
No. Observations:                4459   AIC:                        -6.441e+04
Df Residuals:                    4455   BIC:                        -6.438e+04
Df Model:                           3                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept   1.046e-05   3.07e-06      3.403      0.001    4.43e-06    1.65e-05
rv1            0.2250      0.018     12.458      0.000       0.190       0.260
rv5            0.4543      0.031     14.870      0.000       0.394       0.514
rv22           0.2221      0.027      8.078      0.000       0.168       0.276
==============================================================================
Omnibus:                    10266.653   Durbin-Watson:                   2.045
Prob(Omnibus):                  0.000   Jarque-Bera (JB):        167121903.379
Skew:                          21.714   Prob(JB):                         0.00
Kurtosis:                     950.431   Cond. No.                     1.47e+04
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The condition number is large, 1.47e+04. This might indicate that there are
strong multicollinearity or other numerical problems.
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="n">fit_har</span><span class="o">.</span><span class="n">params</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Intercept    0.000010
rv1          0.225020
rv5          0.454300
rv22         0.222093
dtype: float64
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a><span class="c1"># convert fitted values into pd.DataFrame</span>
<a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a><span class="n">fitted</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;fitted&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fit_har</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">)},</span> <span class="n">index</span><span class="o">=</span><span class="n">spx_rv</span><span class="p">[</span><span class="mi">22</span><span class="p">:]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a><span class="n">fitted</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div style="overflow-x: auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fitted</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-02-03</th>
      <td>0.000159</td>
    </tr>
    <tr>
      <th>2000-02-04</th>
      <td>0.000166</td>
    </tr>
    <tr>
      <th>2000-02-07</th>
      <td>0.000124</td>
    </tr>
    <tr>
      <th>2000-02-08</th>
      <td>0.000105</td>
    </tr>
    <tr>
      <th>2000-02-09</th>
      <td>0.000108</td>
    </tr>
  </tbody>
</table>
</div>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="c1"># log plot</span>
<a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spx_rv</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observed RV&#39;</span><span class="p">)</span>
<a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fitted</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Forecasted RV&#39;</span><span class="p">)</span>
<a id="__codelineno-88-5" name="__codelineno-88-5" href="#__codelineno-88-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Observed and forecasted RV based on HAR model&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<a id="__codelineno-88-6" name="__codelineno-88-6" href="#__codelineno-88-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<a id="__codelineno-88-7" name="__codelineno-88-7" href="#__codelineno-88-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</code></pre></div>
<p>​  <br />
<img alt="png" src="../../../assets/img/topics-quantitative-finance/lecture-5/volatility_137_0.png" />
​    </p>
<h3 id="references">References<a class="headerlink" href="#references" title="Permanent link">&para;</a></h3>
<p><br /></p>
<div class="reflist" style="list-style-type: decimal;">

<ol>

  <li id="cite_note-Corsi"><span class="mw-cite-backlink"><b><a href="#cite_ref-Corsi">^</a></b></span>Fulvio Corsi, A simple approximate long-memory model of realized
volatility, <span><i>Journal of Financial Econometrics</i></span>
<span><b>7</b></span>(2) 174–196 (2009). </li>

  <li id="cite_note-ZMA"><span class="mw-cite-backlink"><b><a href="#cite_ref-ZMA">^</a></b></span>Lan Zhang, Per A. Mykland and Yacine Aït-Sahalia, A tale of two time scales: Determining intergrated volatility with noise high-frequency data, <span><i>Journal of the American Statistical Association</i></span>,
<span><b>100</b></span>(472), 1394–1411 (2005).
  </li>

  <li id="cite_note-Zhou"><span class="mw-cite-backlink"><b><a href="#cite_ref-Zhou">^</a></b></span>Bin Zhou, High-frequency data and volatility in foreign-exchange rates, <span><i>Journal of Business & Economic Statistics</i></span>, 
<span><b>14</b></span>(1), 45–52 (1996).
  </li>
</ol>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="最后更新">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="2025年3月21日 10:33:48 CST">2025年3月21日</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="创建日期">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="2025年3月20日 12:58:20 CST">2025年3月20日</span>
  </span>

    
    
    
  </aside>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2024 - 2025 <a href="https://github.com/Shocked-Pikachu" target="_blank" rel="noopener"> Haoyu Mo</a>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://github.com/Shocked-Pikachu" target="_blank" rel="noopener" title="My Github" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:<mohy@stu.pku.edu.cn>" target="_blank" rel="noopener" title="Send Me An Email" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M64 112c-8.8 0-16 7.2-16 16v22.1l172.5 141.6c20.7 17 50.4 17 71.1 0L464 150.1V128c0-8.8-7.2-16-16-16zM48 212.2V384c0 8.8 7.2 16 16 16h384c8.8 0 16-7.2 16-16V212.2L322 328.8c-38.4 31.5-93.7 31.5-132 0zM0 128c0-35.3 28.7-64 64-64h384c35.3 0 64 28.7 64 64v256c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.indexes", "navigation.tabs", "navigation.top", "toc.follow", "search.suggest", "search.highlight", "search.share", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>